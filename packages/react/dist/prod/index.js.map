{"version":3,"sources":["../../src/index.tsx"],"names":["React","useEffect","useState","exportModule","baseExportModule","renderApp","baseRenderApp","renderSSR","baseRenderSSR","getView","isPromiseView","isServer","viewWillMount","viewWillUnmount","Provider","render","moduleGetter","appModuleName","storeOptions","store","appModel","appViews","ssrInitStoreKey","ReduxProvider","props","children","Main","data","getState","html","autoID","loadView","moduleName","viewName","Loading","loader","onFocus","onBlur","moduleViewResult","Object","keys","forEach","key","Component","view","aid","then","setView","subscriptions","didFocus","didBlur","navigation","addListener","remove"],"mappings":"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","sourcesContent":["import {ExportModule, LoadView, ModuleGetter, StoreOptions} from '@medux/core/types/export';\nimport React, {ComponentType, FunctionComponent, ReactNode, useEffect, useState} from 'react';\nimport {exportModule as baseExportModule, renderApp as baseRenderApp, renderSSR as baseRenderSSR, getView, isPromiseView, isServer, viewWillMount, viewWillUnmount} from '@medux/core';\n\nimport {Provider} from 'react-redux';\n\nexport function renderApp<M extends ModuleGetter, A extends Extract<keyof M, string>>(\n  render: (Provider: ComponentType<{children: ReactNode}>, AppMainView: ComponentType<any>, ssrInitStoreKey: string) => void,\n  moduleGetter: M,\n  appModuleName: A,\n  storeOptions: StoreOptions\n): Promise<void> {\n  return baseRenderApp(\n    (\n      store,\n      appModel,\n      appViews: {\n        [key: string]: ComponentType<any>;\n      },\n      ssrInitStoreKey\n    ) => {\n      const ReduxProvider: ComponentType<{children: ReactNode}> = props => {\n        // eslint-disable-next-line react/prop-types\n        return <Provider store={store}>{props.children}</Provider>;\n      };\n      render(ReduxProvider, appViews.Main, ssrInitStoreKey);\n    },\n    moduleGetter,\n    appModuleName,\n    storeOptions\n  );\n}\n\nexport function renderSSR<M extends ModuleGetter, A extends Extract<keyof M, string>>(\n  render: (Provider: ComponentType<{children: ReactNode}>, AppMainView: ComponentType<any>) => any,\n  moduleGetter: M,\n  appModuleName: A,\n  storeOptions: StoreOptions = {}\n) {\n  return baseRenderSSR(\n    (\n      store,\n      appModel,\n      appViews: {\n        [key: string]: React.ComponentType;\n      },\n      ssrInitStoreKey\n    ) => {\n      const data = store.getState();\n      const ReduxProvider: ComponentType<{children: ReactNode}> = props => {\n        // eslint-disable-next-line react/prop-types\n        return <Provider store={store}>{props.children}</Provider>;\n      };\n      return {\n        ssrInitStoreKey,\n        data,\n        html: render(ReduxProvider, appViews.Main),\n      };\n    },\n    moduleGetter,\n    appModuleName,\n    storeOptions\n  );\n}\nlet autoID = 0;\nexport const loadView: LoadView = (moduleGetter, moduleName, viewName, Loading?: ComponentType<any>) => {\n  let loader: FunctionComponent<any> = null as any;\n  if (isServer()) {\n    const onFocus = () => void 0;\n    const onBlur = () => void 0;\n    loader = function Loader(props: any) {\n      const [view] = useState<{Component: ComponentType} | null>(() => {\n        const moduleViewResult = getView<ComponentType>(moduleGetter, moduleName, viewName);\n        if (isPromiseView<ComponentType>(moduleViewResult)) {\n          return null;\n        } else {\n          Object.keys(loader).forEach(key => (moduleViewResult[key] = loader[key]));\n          Object.keys(moduleViewResult).forEach(key => (loader[key] = moduleViewResult[key]));\n          return {Component: moduleViewResult};\n        }\n      });\n      return view ? <view.Component {...props} onFocus={onFocus} onBlur={onBlur} /> : Loading ? <Loading {...props} /> : null;\n    };\n  } else {\n    const aid = autoID++;\n    const onFocus = () => viewWillMount(moduleName, viewName, aid + '');\n    const onBlur = () => viewWillUnmount(moduleName, viewName, aid + '');\n    loader = function Loader(props: any) {\n      const [view, setView] = useState<{Component: ComponentType} | null>(() => {\n        const moduleViewResult = getView<ComponentType>(moduleGetter, moduleName, viewName);\n        if (isPromiseView<ComponentType>(moduleViewResult)) {\n          moduleViewResult.then(Component => {\n            Object.keys(loader).forEach(key => (Component[key] = loader[key]));\n            Object.keys(Component).forEach(key => (loader[key] = Component[key]));\n            setView({Component});\n          });\n          return null;\n        } else {\n          Object.keys(loader).forEach(key => (moduleViewResult[key] = loader[key]));\n          Object.keys(moduleViewResult).forEach(key => (loader[key] = moduleViewResult[key]));\n          return {Component: moduleViewResult};\n        }\n      });\n      useEffect(() => {\n        if (view) {\n          let subscriptions: {didFocus: null | {remove: Function}; didBlur: null | {remove: Function}} = {didFocus: null, didBlur: null};\n          if (props.navigation) {\n            subscriptions.didFocus = props.navigation.addListener('didFocus', onFocus);\n            subscriptions.didBlur = props.navigation.addListener('didBlur', onBlur);\n          }\n          viewWillMount(moduleName, viewName, aid + '');\n\n          return () => {\n            subscriptions.didFocus && subscriptions.didFocus.remove();\n            subscriptions.didBlur && subscriptions.didBlur.remove();\n            viewWillUnmount(moduleName, viewName, aid + '');\n          };\n        } else {\n          return void 0;\n        }\n      }, [view]);\n      return view ? <view.Component {...props} onFocus={onFocus} onBlur={onBlur} /> : Loading ? <Loading {...props} /> : null;\n    };\n  }\n  return loader as any;\n};\n\nexport const exportModule: ExportModule<ComponentType<any>> = baseExportModule;\n"],"file":"index.js"}