"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("@babel/runtime/helpers/extends")),r=e(require("@babel/runtime/helpers/objectWithoutPropertiesLoose")),n=e(require("@babel/runtime/helpers/esm/assertThisInitialized"));require("@babel/runtime/helpers/esm/possibleConstructorReturn"),require("@babel/runtime/helpers/esm/getPrototypeOf");var o,i=e(require("@babel/runtime/helpers/esm/inheritsLoose")),a=e(require("@babel/runtime/helpers/esm/defineProperty")),u=require("redux"),s=e(require("@babel/runtime/regenerator")),c=e(require("@babel/runtime/helpers/esm/asyncToGenerator")),f=e(require("@babel/runtime/helpers/esm/decorate")),l=require("history"),d=require("react"),p=e(d),h=e(require("@babel/runtime/helpers/esm/extends")),v=e(require("@babel/runtime/helpers/esm/objectWithoutPropertiesLoose")),m=require("react-dom/server"),y=require("react-redux"),g=e(require("react-dom"));(o=exports.LoadingState||(exports.LoadingState={})).Start="Start",o.Stop="Stop",o.Depth="Depth";var _=function(){function e(e,t,r){void 0===r&&(r=!1),this.name=e,this.data=t,this.bubbling=r,a(this,"target",null),a(this,"currentTarget",null)}var t=e.prototype;return t.setTarget=function(e){this.target=e},t.setCurrentTarget=function(e){this.currentTarget=e},e}(),b=function(e){function t(t){var r;return(r=e.call(this)||this).deferSecond=t,a(n(r),"list",[]),a(n(r),"ctimer",null),r}i(t,e);var r=t.prototype;return r.addItem=function(e,t){var r=this;return void 0===t&&(t=""),this.list.some((function(t){return t.promise===e}))||(this.list.push({promise:e,note:t}),e.then((function(){return r.completeItem(e)}),(function(){return r.completeItem(e)})),1===this.list.length&&(this.dispatch(new _("TaskCountEvent",exports.LoadingState.Start)),this.ctimer=setTimeout((function(){r.ctimer=null,r.list.length>0&&r.dispatch(new _("TaskCountEvent",exports.LoadingState.Depth))}),1e3*this.deferSecond))),e},r.completeItem=function(e){var t=this.list.findIndex((function(t){return t.promise===e}));return t>-1&&(this.list.splice(t,1),0===this.list.length&&(this.ctimer&&(clearTimeout(this.ctimer),this.ctimer=null),this.dispatch(new _("TaskCountEvent",exports.LoadingState.Stop)))),this},t}(function(){function e(e){this.parent=e,a(this,"storeHandlers",{})}var t=e.prototype;return t.addListener=function(e,t){var r=this.storeHandlers[e];return r||(this.storeHandlers[e]=r=[]),r.push(t),this},t.removeListener=function(e,t){var r=this;if(e){var n=this.storeHandlers;if(n.propertyIsEnumerable(e)){var o=n[e];if(t){var i=o.indexOf(t);i>-1&&o.splice(i,1),0===o.length&&delete n[e]}else delete n[e]}}else Object.keys(this.storeHandlers).forEach((function(e){delete r.storeHandlers[e]}));return this},t.dispatch=function(e){e.target||e.setTarget(this),e.setCurrentTarget(this);var t=this.storeHandlers[e.name];if(t)for(var r=0,n=t.length;r<n;r++)t[r](e);return this.parent&&e.bubbling&&this.parent.dispatch(e),this},t.setParent=function(e){return this.parent=e,this},e}()),S={};var x={NSP:"/",VSP:".",MSP:","},E={isServer:"undefined"!=typeof global&&"undefined"==typeof window,isDev:"production"!==process.env.NODE_ENV,actionCreatorMap:null,clientStore:null,appModuleName:null,moduleGetter:null},w={MLoading:"Loading",MInit:"Init",MRouteParams:"RouteParams",Error:"medux"+x.NSP+"Error",RouteChange:"medux"+x.NSP+"RouteChange"},R=E.isServer?void 0:"undefined"==typeof window?global:window;function k(e){return"object"==typeof e&&"function"==typeof e.then}function P(e,t,r){t||r||(t=e.key,r=e.descriptor);var n=r.value;return n.__actionName__=t,n.__isReducer__=!0,r.enumerable=!0,e.descriptor===r?e:r}function O(e){return"object"!=typeof e||void 0===e.meduxProcessed?void 0:!!e.meduxProcessed}function j(e,t,r,n){if(n[e]||(n[e]={}),n[e][r])throw new Error("Action duplicate or conflict : "+e+".");n[e][r]=t}function T(e,t){var r=E.actionCreatorMap[e];r[t]||(r[t]=function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return{type:e+x.NSP+t,payload:n}})}function A(e){return{type:w.Error,payload:[e]}}function M(e,t,r){if(!t._medux_.injectedModules[e]){var n=E.moduleGetter,o=n[e]();return"function"==typeof o.then?o.then((function(o){return n[e]=function(){return o},o.default.model(t,r)})):o.default.model(t,r)}}function N(e){return Array.isArray(e.payload)?e.payload:[]}function C(e,t){var r=!1,n=function(n){if(r)r=!1;else{var o=e.getState().route;if(o&&t.equal(o.location,n))return;var i=t.locationToRouteData(n);e.dispatch(function(e){return{type:w.RouteChange,payload:[e]}}({location:n,data:i}))}};t.subscribe(n),e.subscribe((function(){if(t.initialized){var n=e.getState().route;t.equal(n.location,t.getLocation())||(r=!0,t.patch(n.location,n.data))}})),t.initialized&&n(t.getLocation())}function D(e,t,r,n,o){if(void 0===t&&(t={}),void 0===r&&(r={}),void 0===n&&(n=[]),void 0===o&&(o=[]),r.route)throw new Error("the reducer name 'route' is not allowed");r.route=function(e,t){if(t.type===w.RouteChange){var r=N(t)[0];return e?Object.assign({},e,{},r):r}return e};var i=u.applyMiddleware.apply(void 0,[function(){return function(e){return function(t){var r=t.type.split(x.NSP),n=r[0],o=r[1];if(n&&o&&E.moduleGetter[n]){var i=M(n,s,void 0);if(k(i))return i.then((function(){return e(t)}))}return e(t)}}}].concat(n,[function(e){var t=e.dispatch;return function(e){return function(r){if(E.isServer&&r.type.split(x.NSP)[1]===w.MLoading)return r;var n=s._medux_;n.beforeState=n.prevState;var o=e(r);if(o.type===w.RouteChange){var i=n.prevState.route.data.params;Object.keys(i).forEach((function(e){var r=i[e];r&&Object.keys(r).length>0&&n.injectedModules[e]&&t(function(e,t){return{type:""+e+x.NSP+w.MRouteParams,payload:[t]}}(e,r))}))}var a=n.effectMap[o.type]||{},u=n.effectMap[o.type.replace(new RegExp("[^"+x.NSP+"]+"),"*")]||{},c=Object.assign({},a,{},u),f=Object.keys(c);if(f.length>0){var l=[],d=o.priority?[].concat(o.priority):[];f.forEach((function(e){var t=c[e];e===E.appModuleName?l.unshift(e):l.push(e),t.__isHandler__||d.unshift(e)})),l.unshift.apply(l,d);var p={},h=[];if(l.forEach((function(e){if(!p[e]){p[e]=!0;var r=c[e],n=r.apply(void 0,N(o)),i=r.__decorators__;if(i){var a=[];i.forEach((function(t,r){a[r]=t[0](o,e,n)})),r.__decoratorResults__=a}var u=n.then((function(e){if(i){var t=r.__decoratorResults__||[];i.forEach((function(r,n){r[1]&&r[1]("Resolved",t[n],e)})),r.__decoratorResults__=void 0}return e}),(function(e){if(i){var n=r.__decoratorResults__||[];i.forEach((function(t,r){t[1]&&t[1]("Rejected",n[r],e)})),r.__decoratorResults__=void 0}if(o.type===w.Error)throw void 0===O(e)&&(e=function(e,t){return"object"==typeof e?(e.meduxProcessed=t,e):{meduxProcessed:t,error:e}}(e,!0)),e;if(O(e))throw e;return t(A(e))}));h.push(u)}})),h.length)return Promise.all(h)}return o}}}])),a=[].concat(o,[i,function(e){return function(){var t=e.apply(void 0,arguments),r=t;return r._medux_={beforeState:{},prevState:{},currentState:{},reducerMap:{},effectMap:{},injectedModules:{},currentViews:{}},t}}]);E.isDev&&R&&R.__REDUX_DEVTOOLS_EXTENSION__&&a.push(R.__REDUX_DEVTOOLS_EXTENSION__(R.__REDUX_DEVTOOLS_EXTENSION__OPTIONS));var s=u.createStore((function(e,t){if(!s)return e;var n=s._medux_;n.prevState=e;var o=Object.assign({},e);n.currentState=o,Object.keys(r).forEach((function(e){o[e]=r[e](o[e],t)}));var i=n.reducerMap[t.type]||{},a=n.reducerMap[t.type.replace(new RegExp("[^"+x.NSP+"]+"),"*")]||{},u=Object.assign({},i,{},a),c=Object.keys(u);if(c.length>0){var f=[],l=t.priority?[].concat(t.priority):[];c.forEach((function(e){var t=u[e];e===E.appModuleName?f.unshift(e):f.push(e),t.__isHandler__||l.unshift(e)})),f.unshift.apply(f,l);var d={};f.forEach((function(e){if(!d[e]){d[e]=!0;var r=u[e];o[e]=r.apply(void 0,N(t))}}))}var p=Object.keys(e).length!==Object.keys(o).length||Object.keys(e).some((function(t){return e[t]!==o[t]}));return n.prevState=p?o:e,n.prevState}),t,u.compose.apply(void 0,a));return C(s,e),E.clientStore=s,s}var I=f(null,(function(e){return{F:function(t,r){this.moduleName=t,this.store=r,e(this)},d:[{kind:"field",key:"actions",value:function(){return null}},{kind:"get",key:"state",value:function(){return this.getState()}},{kind:"method",key:"getState",value:function(){return this.store._medux_.prevState[this.moduleName]}},{kind:"get",key:"rootState",value:function(){return this.getRootState()}},{kind:"method",key:"getRootState",value:function(){return this.store._medux_.prevState}},{kind:"get",key:"currentState",value:function(){return this.getCurrentState()}},{kind:"method",key:"getCurrentState",value:function(){return this.store._medux_.currentState[this.moduleName]}},{kind:"get",key:"currentRootState",value:function(){return this.getCurrentRootState()}},{kind:"method",key:"getCurrentRootState",value:function(){return this.store._medux_.currentState}},{kind:"get",key:"beforeState",value:function(){return this.getBeforeState()}},{kind:"method",key:"getBeforeState",value:function(){return this.store._medux_.beforeState[this.moduleName]}},{kind:"get",key:"beforeRootState",value:function(){return this.getBeforeRootState()}},{kind:"method",key:"getBeforeRootState",value:function(){return this.store._medux_.beforeState}},{kind:"method",key:"dispatch",value:function(e){return this.store.dispatch(e)}},{kind:"method",key:"callThisAction",value:function(e){for(var t=E.actionCreatorMap[this.moduleName],r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return t[e.__actionName__].apply(t,n)}},{kind:"method",key:"updateState",value:function(e){this.dispatch(this.callThisAction(this.Update,Object.assign({},this.getState(),{},e)))}},{kind:"method",key:"loadModel",value:function(e,t){return M(e,this.store,t)}},{kind:"method",decorators:[P],key:"Init",value:function(e,t,r){return Object.assign({},e,{routeParams:t||e.routeParams},r)}},{kind:"method",decorators:[P],key:"Update",value:function(e){return e}},{kind:"method",decorators:[P],key:"RouteParams",value:function(e){var t=this.getState();return Object.assign({},t,{routeParams:e})}},{kind:"method",decorators:[P],key:"Loading",value:function(e){var t=this.getState();return Object.assign({},t,{loading:Object.assign({},t.loading,{},e)})}}]}}));function L(e){return"function"==typeof e.then}function q(e,t){var r=e.map((function(e){var r=function(e,t){var r=t[e]();return L(r)?r.then((function(r){return t[e]=function(){return r},r})):r}(e,t);return L(r)?r:Promise.resolve(r)}));return Promise.all(r)}function B(){return(B=c(s.mark((function e(t,r,n,o,i,a){var u,c,f,l,d,p,h,v,m,y,g,_;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0===i&&(i={}),E.appModuleName=n,u=i.ssrInitStoreKey||"meduxInitStore",c=D(o,i.initData,i.reducers,i.middlewares,i.enhancers),f=a?a(c):c,l=f.getState(),0===(d=l.route.data.paths).length&&d.push(n),p=void 0,h={},v=0,m=d.length;case 11:if(!(v<m)){e.next=22;break}if(y=d[v].split(x.VSP),g=y[0],h[g]){e.next=19;break}return h[g]=!0,_=r[g](),e.next=18,_.default.model(f,void 0);case 18:0===v&&(p=_);case 19:v++,e.next=11;break;case 22:return e.abrupt("return",t(f,p.default.model,p.default.views,u));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return K(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return K(e,t)}(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function U(e,t){void 0===t&&(t={});for(var r=function(e){for(var t=[],r=0;r<e.length;){var n=e[r];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)t.push({type:"CHAR",index:r,value:e[r++]});else{var o=1,i="",a=r+1;if("?"===e[a])throw new TypeError('Pattern cannot start with "?" at '+a);for(;a<e.length;)if("\\"!==e[a]){if(")"===e[a]){if(0===--o){a++;break}}else if("("===e[a]&&(o++,"?"!==e[a+1]))throw new TypeError("Capturing groups are not allowed at "+a);i+=e[a++]}else i+=e[a++]+e[a++];if(o)throw new TypeError("Unbalanced pattern at "+r);if(!i)throw new TypeError("Missing pattern at "+r);t.push({type:"PATTERN",index:r,value:i}),r=a}else{for(var u="",s=r+1;s<e.length;){var c=e.charCodeAt(s);if(!(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||95===c||46===c))break;u+=e[s++]}if(!u)throw new TypeError("Missing parameter name at "+r);t.push({type:"NAME",index:r,value:u}),r=s}else t.push({type:"CLOSE",index:r,value:e[r++]});else t.push({type:"OPEN",index:r,value:e[r++]});else t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});else t.push({type:"MODIFIER",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}(e),n=t.prefixes,o=void 0===n?"./":n,i="[^"+$(t.delimiter||"/#?")+"]+?",a=[],u=0,s=0,c="",f=function(e){if(s<r.length&&r[s].type===e)return r[s++].value},l=function(e){var t=f(e);if(void 0!==t)return t;var n=r[s],o=n.type,i=n.index;throw new TypeError("Unexpected "+o+" at "+i+", expected "+e)},d=function(){for(var e,t="";e=f("CHAR")||f("ESCAPED_CHAR");)t+=e;return t};s<r.length;){var p=f("CHAR"),h=f("NAME"),v=f("PATTERN");if(h||v){var m=p||"";-1===o.indexOf(m)&&(c+=m,m=""),c&&(a.push(c),c=""),a.push({name:h||u++,prefix:m,suffix:"",pattern:v||i,modifier:f("MODIFIER")||""})}else{var y=p||f("ESCAPED_CHAR");if(y)c+=y;else if(c&&(a.push(c),c=""),f("OPEN")){var g=d(),_=f("NAME")||"",b=f("PATTERN")||"",S=d();l("CLOSE"),a.push({name:_||(b?u++:""),pattern:_&&!b?i:b,prefix:g,suffix:S,modifier:f("MODIFIER")||""})}else l("END")}}return a}function V(e,t){return function(e,t){void 0===t&&(t={});var r=F(t),n=t,o=n.encode,i=void 0===o?function(e){return e}:o,a=n.validate,u=void 0===a||a,s=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",r)}));return function(t){for(var r="",n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o){var a=t?t[o.name]:void 0,c="?"===o.modifier||"*"===o.modifier,f="*"===o.modifier||"+"===o.modifier;if(Array.isArray(a)){if(!f)throw new TypeError('Expected "'+o.name+'" to not repeat, but got an array');if(0===a.length){if(c)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var l=0;l<a.length;l++){var d=i(a[l],o);if(u&&!s[n].test(d))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but got "'+d+'"');r+=o.prefix+d+o.suffix}}else if("string"!=typeof a&&"number"!=typeof a){if(!c){var p=f?"an array":"a string";throw new TypeError('Expected "'+o.name+'" to be '+p)}}else{var h=i(String(a),o);if(u&&!s[n].test(h))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+h+'"');r+=o.prefix+h+o.suffix}}else r+=o}return r}}(U(e,t),t)}function $(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function F(e){return e&&e.sensitive?"":"i"}function G(e,t,r){return function(e,t,r){void 0===r&&(r={});for(var n,o=r,i=o.strict,a=void 0!==i&&i,u=o.start,s=void 0===u||u,c=o.end,f=void 0===c||c,l=o.encode,d=void 0===l?function(e){return e}:l,p="["+$(r.endsWith||"")+"]|$",h="["+$(r.delimiter||"/#?")+"]",v=s?"^":"",m=H(e);!(n=m()).done;){var y=n.value;if("string"==typeof y)v+=$(d(y));else{var g=$(d(y.prefix)),_=$(d(y.suffix));if(y.pattern)if(t&&t.push(y),g||_)if("+"===y.modifier||"*"===y.modifier){var b="*"===y.modifier?"?":"";v+="(?:"+g+"((?:"+y.pattern+")(?:"+_+g+"(?:"+y.pattern+"))*)"+_+")"+b}else v+="(?:"+g+"("+y.pattern+")"+_+")"+y.modifier;else v+="("+y.pattern+")"+y.modifier;else v+="(?:"+g+_+")"+y.modifier}}if(f)a||(v+=h+"?"),v+=r.endsWith?"(?="+p+")":"$";else{var S=e[e.length-1],x="string"==typeof S?h.indexOf(S[S.length-1])>-1:void 0===S;a||(v+="(?:"+h+"(?="+p+"))?"),x||(v+="(?="+h+"|"+p+")")}return new RegExp(v,F(r))}(U(e,r),t,r)}function X(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,t):Array.isArray(e)?function(e,t,r){var n=e.map((function(e){return X(e,t,r).source}));return new RegExp("(?:"+n.join("|")+")",F(r))}(e,t,r):G(e,t,r)}var W={},z=0;function J(e,t){void 0===t&&(t={end:!1,strict:!1,sensitive:!1});var r=""+t.end+t.strict+t.sensitive,n=W[r]||(W[r]={});if(n[e])return n[e];var o=[],i={regexp:X(e,o,t),keys:o};return z<1e4&&(n[e]=i,z++),i}function Z(e,t){void 0===t&&(t={}),("string"==typeof t||Array.isArray(t))&&(t={path:t});var r=t,n=r.path,o=r.exact,i=void 0!==o&&o,a=r.strict,u=void 0!==a&&a,s=r.sensitive,c=void 0!==s&&s;return[].concat(n).reduce((function(t,r){if(!r)return null;if(t)return t;if("*"===r)return{path:r,url:e,isExact:!0,params:{}};var n=J(r,{end:i,strict:u,sensitive:c}),o=n.regexp,a=n.keys,s=o.exec(e);if(!s)return null;var f=s[0],l=s.slice(1),d=e===f;return i&&!d?null:{path:r,url:"/"===r&&""===f?"/":f,isExact:d,params:a.reduce((function(e,t,r){return e[t.name]=l[r],e}),{})}}),null)}var Q=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){function t(e){return e instanceof Buffer||e instanceof Date||e instanceof RegExp}function r(e){if(e instanceof Buffer){var t=Buffer.alloc?Buffer.alloc(e.length):new Buffer(e.length);return e.copy(t),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);throw new Error("Unexpected situation")}function n(e){var o=[];return e.forEach((function(e,a){"object"==typeof e&&null!==e?Array.isArray(e)?o[a]=n(e):t(e)?o[a]=r(e):o[a]=i({},e):o[a]=e})),o}function o(e,t){return"__proto__"===t?void 0:e[t]}var i=e.exports=function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];var e,a,u=arguments[0],s=Array.prototype.slice.call(arguments,1);return s.forEach((function(s){"object"!=typeof s||null===s||Array.isArray(s)||Object.keys(s).forEach((function(c){return a=o(u,c),(e=o(s,c))===u?void 0:"object"!=typeof e||null===e?void(u[c]=e):Array.isArray(e)?void(u[c]=n(e)):t(e)?void(u[c]=r(e)):"object"!=typeof a||null===a||Array.isArray(a)?void(u[c]=i({},e)):void(u[c]=i(a,e))}))})),u}})),Y=Q,ee={escape:!0,dateParse:!0,splitKey:"q",defaultRouteParams:{}};function te(e){void 0!==e.escape&&(ee.escape=e.escape),void 0!==e.dateParse&&(ee.dateParse=e.dateParse),e.splitKey&&(ee.splitKey=e.splitKey),e.defaultRouteParams&&(ee.defaultRouteParams=e.defaultRouteParams)}var re=/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d(\.\d+)?(Z|[+-][01]\d:[0-5]\d)$/;function ne(e,t){return"string"==typeof t&&re.test(t)?new Date(t):t}function oe(e){for(var t=[""],r=0,n=e.length;r<n;r++)t.push(e[r]||"");return t.join("&"+ee.splitKey+"=")}function ie(e){if("object"!=typeof e)return"";var t=JSON.stringify(e);return"{}"===t?"":ee.escape?escape(t):t}function ae(e){var t=new RegExp("[&?#]"+ee.splitKey+"=[^&]*","g"),r=e.match(t),n=[];return r&&(n=r.map((function(e){return function(e){if(!e)return{};ee.escape&&(e=unescape(e));try{return JSON.parse(e,ee.dateParse?ne:void 0)}catch(e){return{}}}(e.split("=")[1])}))),n}function ue(e){var t={};for(var r in e)e.hasOwnProperty(r)&&function(){var n=e[r],o=r.split(".");o.length>1?o.reduce((function(e,t,r,o){return r===o.length-1?e[t]=n:e[t]={},e[t]}),t):t[r]=n}();return t}function se(e,t,r){t[0]||(t[0]={}),r&&(t[0]=Q({},r,t[0]));var n=t[0],o=e.reduce((function(e,t){var r=t.split(x.VSP),o=r[0],i=r[1];return i&&(e[o]||(e[o]={}),e[o][i]=!0,n[o]||(n[o]={})),e}),{});Object.keys(n).forEach((function(e){n[e]=Q({},ee.defaultRouteParams[e],n[e])}));var i=Q.apply(void 0,[{}].concat(t));return Object.keys(i).forEach((function(e){n[e]||(i[e]=Q({},ee.defaultRouteParams[e],i[e]))})),{views:o,paths:e,params:i,stackParams:t}}function ce(e){var t=function e(t,r,n,o){for(var i in void 0===r&&(r=""),void 0===n&&(n={}),void 0===o&&(o={}),t)if(t.hasOwnProperty(i)){if(!o[i]){var a=J(i,{end:!0,strict:!1,sensitive:!1}).keys;o[i]=a.reduce((function(e,t){return e.push(t.name),e}),[])}var u=t[i],s="string"==typeof u?[u,null]:u,c=s[0],f=s[1],l=r+"/"+c;n[l]=i,f&&e(f,l,n,o)}return{viewToRule:n,ruleToKeys:o}}(e),r=t.viewToRule,n=t.ruleToKeys;return{locationToRoute:function(t){var r=[],n={};!function e(t,r,n,o){for(var i in r)if(r.hasOwnProperty(i)){var a=r[i],u="string"==typeof a?[a,null]:a,s=u[0],c=u[1],f=Z(t,{path:i.replace(/\$$/,""),exact:!c});if(f){n.push(s);var l=s.split(x.VSP)[0],d=f.params;return d&&Object.keys(d).length>0&&(o[l]=Object.assign({},o[l],{},ue(d))),void(c&&e(t,c,n,o))}}}(t.pathname,e,r,n);var o=ae(t.search);return ae(t.hash).forEach((function(e,t){e&&(o[t]||(o[t]={}),Q(o[t],e))})),se(r,o,n)},routeToLocation:function(e){var t,o=e.views,i=e.paths,a=e.params,u=e.stackParams,s=u[0],c="";i.length>0?(t=Q({},s),i.reduce((function(e,o,u){var s=e+"/"+o,f=r[s],l=o.split(x.VSP)[0];if(u===i.length-1){var d=function(e){if(W[e])return W[e];var t=V(e);return z<1e4&&(W[e]=t,z++),t}(f),p=(n[f]||[]).reduce((function(e,t){if("string"==typeof t){var r=t.split(".");if(r.length)return e[t]=r.reduce((function(e,t){return e[t]}),a[l]),e}return e[t]=a[l][t],e}),{});c=d(p)}return(n[f]||[]).forEach((function(e){if("string"==typeof e){var r=e.split(".");if(r.length)return void r.reduce((function(e,t,n){return n===r.length-1&&delete e[t],e[t]||{}}),t[l]||{})}t[l]&&delete t[l][e]})),s}),"")):t=s;var f=[].concat(u);f[0]=function e(t,r,n,o){var i={};if(Object.keys(t).forEach((function(n){var a=t[n],u=r[n];a!==u&&(typeof a!=typeof u||"object"!=typeof a||Array.isArray(a)||(a=e(a,u,!!o&&!o[n])),void 0!==a&&(i[n]=a))})),0!==Object.keys(i).length||n)return i}(t,ee.defaultRouteParams,!1,o);var l=[],d=[];return f.forEach((function(e,t){var r=function(e){var t={},r={},n=function(n){if(e[n]&&e.hasOwnProperty(n)){var o=e[n],i=Object.keys(o);i.length>0?i.forEach((function(e){e.startsWith("_")?(r[n]||(r[n]={}),r[n][e]=o[e]):(t[n]||(t[n]={}),t[n][e]=o[e])})):t[n]={}}};for(var o in e)n(o);return{search:ie(t),hash:ie(r)}}(e),n=r.search,o=r.hash;n&&(l[t]=n),o&&(d[t]=o)})),{pathname:c,search:"?"+oe(l).substr(1),hash:"#"+oe(d).substr(1)}}}}function fe(e,t,r,n,o,i){return void 0===o&&(o="root"),function(e,t,r,n,o,i){void 0===o&&(o={}),E.appModuleName=r;var a=o.ssrInitStoreKey||"meduxInitStore",u={};(o.initData||R[a])&&(u=Object.assign({},R[a],{},o.initData));var s=D(n,u,o.reducers,o.middlewares,o.enhancers),c=i?i(s):s,f=[r];return u&&f.push.apply(f,Object.keys(u).filter((function(e){return e!==r&&u[e].isModule}))),q(f,t).then((function(t){var r=t[0],n=r.default.model(c,void 0);return e(c,r.default.model,r.default.views,a),n}))}((function(e,t,r,n){var i=p.createElement(y.Provider,{store:e},p.createElement(r.Main,null));"function"==typeof o?o(i):(window[n]?g.hydrate:g.render)(i,"string"==typeof o?document.getElementById(o):o)}),e,t,r,n,i)}function le(e,t,r,n,o,i){return void 0===n&&(n={}),void 0===o&&(o=!1),function(e,t,r,n,o,i){return B.apply(this,arguments)}((function(e,t,r,n){var i=e.getState(),a=p.createElement(y.Provider,{store:e},p.createElement(r.Main,null));return{store:e,ssrInitStoreKey:n,data:i,html:(o?m.renderToNodeStream:m.renderToString)(a)}}),e,t,r,n,i)}var de=function(e,t,r,n){var o=function(n,o){if(!n._medux_.injectedModules[e]){n._medux_.injectedModules[e]=!0;var i=n.getState()[e],a=new r(e,n),u=function(e,t,r){for(var n in r)"function"==typeof r[n]&&function(){var o,i,a,u=r[n];(u.__isReducer__||u.__isEffect__)&&(i=r,a=(o=u).bind(i),Object.keys(o).forEach((function(e){a[e]=o[e]})),u=a,n.split(x.MSP).forEach((function(r){(r=r.trim().replace(new RegExp("^this["+x.NSP+"]"),""+t+x.NSP)).split(x.NSP)[1]?(u.__isHandler__=!0,j(r,u,t,u.__isEffect__?e._medux_.effectMap:e._medux_.reducerMap)):(u.__isHandler__=!1,j(t+x.NSP+r,u,t,u.__isEffect__?e._medux_.effectMap:e._medux_.reducerMap),T(t,r))})))}();return E.actionCreatorMap[t]}(n,e,a);if(a.actions=u,!i){var s=n._medux_.prevState.route.data.params;t.isModule=!0;var c=u.Init(t,s[e],o);return n.dispatch(c)}}};o.moduleName=e,o.initState=t;return{moduleName:e,model:o,views:n,actions:{}}};function pe(e){var t=e.extend||{views:{},paths:[],stackParams:[],params:{}},r=[].concat(t.stackParams);return e.params&&(r[0]=Y({},r[0],e.params)),se(e.paths||t.paths,r)}function he(e){return!e.pathname}var ve=function(){function e(e,t){this.history=e,this.locationToRoute=t,a(this,"initialized",!0)}var t=e.prototype;return t.getLocation=function(){return this.history.location},t.subscribe=function(e){this.history.listen(e)},t.locationToRouteData=function(e){return e.state||this.locationToRoute(e)},t.equal=function(e,t){return e.pathname===t.pathname&&e.search===t.search&&e.hash===t.hash},t.patch=function(e,t){this.history.push(Object.assign({},e,{state:t}))},e}();function me(e,t){var r,n=ce(t),o=(r=n.routeToLocation,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(1===t.length){var o=r(pe(t[0]));t=[o.pathname,o.search,o.hash]}var i=t,a=i[0],u=i[1],s=i[2],c=a;return u&&(c+=u),s&&(c+=s),c}),i=new ve(e,n.locationToRoute),a={listen:function(t){return e.listen(t)},getLocation:function(){return e.location},getRouteData:function(){return e.location.state||n.locationToRoute(e.location)},push:function(t){if("string"==typeof t)e.push(t);else if(he(t)){var r=pe(t),o=n.routeToLocation(r);e.push(Object.assign({},o,{state:r}))}else e.push(Object.assign({},t,{state:void 0}))},replace:function(t){if("string"==typeof t)e.replace(t);else if(he(t)){var r=pe(t),o=n.routeToLocation(r);e.replace(Object.assign({},o,{state:r}))}else e.replace(Object.assign({},t,{state:void 0}))},go:function(t){e.go(t)},goBack:function(){e.goBack()},goForward:function(){e.goForward()}};return{transformRoute:n,historyProxy:i,historyActions:a,toBrowserUrl:o}}var ye=void 0,ge=void 0,_e=void 0;var be=p.forwardRef((function(e,n){var o=e.onClick,i=e.replace,a=r(e,["onClick","replace"]),u=a.target,s=Object.assign({},a,{onClick:function(e){try{o&&o(e)}catch(t){throw e.preventDefault(),t}e.defaultPrevented||0!==e.button||u&&"_self"!==u||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)||(e.preventDefault(),i?ye.replace(a.href):ye.push(a.href))}});return p.createElement("a",t({},s,{ref:n}))}));exports.ActionTypes=w,exports.BaseModelHandlers=I,exports.Link=be,exports.Switch=function(e){var t=e.children,r=e.elseView;return!t||Array.isArray(t)&&t.every((function(e){return!e}))?p.createElement(p.Fragment,null,r):p.createElement(p.Fragment,null,t)},exports.buildApp=function(e){var t=e.moduleGetter,r=e.appModuleName,n=e.history,o=e.routeConfig,i=void 0===o?{}:o,a=e.defaultRouteParams,u=e.storeOptions,s=void 0===u?{}:u,c=e.container,f=void 0===c?"root":c,l=e.beforeRender;te({defaultRouteParams:a});var d=me(n,i);return ye=d.historyActions,_e=d.toBrowserUrl,ge=d.transformRoute,fe(t,r,d.historyProxy,s,f,(function(e){var t=e.getState().route.data.views;if(t["@"]){var r=Object.keys(t["@"])[0];ye.replace(r)}return l?l({store:e,history:n,historyActions:ye,toBrowserUrl:_e,transformRoute:ge}):e}))},exports.buildSSR=function(e){var t=e.moduleGetter,r=e.appModuleName,n=e.location,o=e.routeConfig,i=void 0===o?{}:o,a=e.defaultRouteParams,u=e.storeOptions,s=void 0===u?{}:u,c=e.renderToStream,f=void 0!==c&&c,d=e.beforeRender;te({defaultRouteParams:a});var p={listen:function(){},location:l.createLocation(n)},h=me(p,i);return ye=h.historyActions,_e=h.toBrowserUrl,ge=h.transformRoute,le(t,r,h.historyProxy,s,f,(function(e){var t=e.getState().route.data.views;if(t["@"]){var r=Object.keys(t["@"])[0];throw{code:"301",message:r,detail:r}}return d?d({store:e,history:p,historyActions:ye,toBrowserUrl:_e,transformRoute:ge}):e}))},exports.delayPromise=function(e){return function(t,r,n){r||n||(r=t.key,n=t.descriptor);var o=n.value;n.value=function(){for(var r=new Promise((function(t){setTimeout((function(){t(!0)}),1e3*e)})),n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return Promise.all([r,o.apply(t,i)]).then((function(e){return e[1]}))}}},exports.effect=function(e,t){return void 0===e&&(e="global",t=E.appModuleName),function(r,n,o){n||o||(n=r.key,o=r.descriptor);var i=o.value;if(i.__actionName__=n,i.__isEffect__=!0,o.enumerable=!0,e){i.__decorators__||(i.__decorators__=[]),i.__decorators__.push([function(r,n,o){E.isServer||(t||(t=n),function(e,t,r){if(void 0===t&&(t=E.appModuleName),void 0===r&&(r="global"),E.isServer)return e;var n=t+x.NSP+r;S[n]||(S[n]=new b(2),S[n].addListener("TaskCountEvent",(function(e){var n=E.clientStore;if(n){var o,i=(0,E.actionCreatorMap[t][w.MLoading])(((o={})[r]=e.data,o));n.dispatch(i)}}))),S[n].addItem(e)}(o,t,e))},null])}return r.descriptor===o?r:o}},exports.errorAction=A,exports.exportActions=function(e){return E.moduleGetter=e,E.actionCreatorMap=Object.keys(e).reduce((function(e,t){return e[t]="undefined"==typeof Proxy?{}:new Proxy({},{get:function(e,r){return function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return{type:t+x.NSP+r,payload:n}}},set:function(){return!0}}),e}),{}),E.actionCreatorMap},exports.exportModule=de,exports.loadView=function(e,t,r,n){var o=r||{},i=o.forwardRef,a=v(o,["forwardRef"]),u=function(r){var o=d.useState((function(){var r=function(e,t,r){var n=E.moduleGetter,o=n[e]();if(L(o))return o.then((function(o){n[e]=function(){return o};var i=o.default.views[t];if(E.isServer)return i;var a=o.default.model(E.clientStore,r);return k(a)?a.then((function(){return i})):i}));var i=o.default.views[t];if(E.isServer)return i;var a=o.default.model(E.clientStore,r);return k(a)?a.then((function(){return i})):i}(e,t,a);return"function"==typeof r.then?(r.then((function(e){u({Component:e})})),null):{Component:r}})),i=o[0],u=o[1],s=r.forwardRef,c=v(r,["forwardRef"]),f=s?{ref:s}:{};return i?p.createElement(i.Component,h({},c,f)):n?p.createElement(n,r):null};return i?p.forwardRef((function(e,t){return p.createElement(u,h({},e,{forwardRef:t}))})):u},exports.reducer=P,exports.setRouteConfig=te;
//# sourceMappingURL=index.min.js.map
