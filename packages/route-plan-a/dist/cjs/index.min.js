"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,r=(e=require("deep-extend"))&&"object"==typeof e&&"default"in e?e.default:e,t=require("@medux/core");function n(e,r){void 0===r&&(r={});for(var t=function(e){for(var r=[],t=0;t<e.length;){var n=e[t];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)r.push({type:"CHAR",index:t,value:e[t++]});else{var a=1,i="",o=t+1;if("?"===e[o])throw new TypeError('Pattern cannot start with "?" at '+o);for(;o<e.length;)if("\\"!==e[o]){if(")"===e[o]){if(0===--a){o++;break}}else if("("===e[o]&&(a++,"?"!==e[o+1]))throw new TypeError("Capturing groups are not allowed at "+o);i+=e[o++]}else i+=e[o++]+e[o++];if(a)throw new TypeError("Unbalanced pattern at "+t);if(!i)throw new TypeError("Missing pattern at "+t);r.push({type:"PATTERN",index:t,value:i}),t=o}else{for(var u="",f=t+1;f<e.length;){var s=e.charCodeAt(f);if(!(s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||95===s||46===s))break;u+=e[f++]}if(!u)throw new TypeError("Missing parameter name at "+t);r.push({type:"NAME",index:t,value:u}),t=f}else r.push({type:"CLOSE",index:t,value:e[t++]});else r.push({type:"OPEN",index:t,value:e[t++]});else r.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});else r.push({type:"MODIFIER",index:t,value:e[t++]})}return r.push({type:"END",index:t,value:""}),r}(e),n=r.prefixes,a=void 0===n?"./":n,o="[^"+i(r.delimiter||"/#?")+"]+?",u=[],f=0,s=0,c="",p=function(e){if(s<t.length&&t[s].type===e)return t[s++].value},v=function(e){var r=p(e);if(void 0!==r)return r;var n=t[s],a=n.type,i=n.index;throw new TypeError("Unexpected "+a+" at "+i+", expected "+e)},l=function(){for(var e,r="";e=p("CHAR")||p("ESCAPED_CHAR");)r+=e;return r};s<t.length;){var d=p("CHAR"),h=p("NAME"),y=p("PATTERN");if(h||y){var g=d||"";-1===a.indexOf(g)&&(c+=g,g=""),c&&(u.push(c),c=""),u.push({name:h||f++,prefix:g,suffix:"",pattern:y||o,modifier:p("MODIFIER")||""})}else{var m=d||p("ESCAPED_CHAR");if(m)c+=m;else if(c&&(u.push(c),c=""),p("OPEN")){var x=l(),E=p("NAME")||"",w=p("PATTERN")||"",P=l();v("CLOSE"),u.push({name:E||(w?f++:""),pattern:E&&!w?o:w,prefix:x,suffix:P,modifier:p("MODIFIER")||""})}else v("END")}}return u}function a(e,r){return function(e,r){void 0===r&&(r={});var t=o(r),n=r,a=n.encode,i=void 0===a?function(e){return e}:a,u=n.validate,f=void 0===u||u,s=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",t)}));return function(r){for(var t="",n=0;n<e.length;n++){var a=e[n];if("string"!=typeof a){var o=r?r[a.name]:void 0,u="?"===a.modifier||"*"===a.modifier,c="*"===a.modifier||"+"===a.modifier;if(Array.isArray(o)){if(!c)throw new TypeError('Expected "'+a.name+'" to not repeat, but got an array');if(0===o.length){if(u)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var p=0;p<o.length;p++){var v=i(o[p],a);if(f&&!s[n].test(v))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'", but got "'+v+'"');t+=a.prefix+v+a.suffix}}else if("string"!=typeof o&&"number"!=typeof o){if(!u){var l=c?"an array":"a string";throw new TypeError('Expected "'+a.name+'" to be '+l)}}else{var d=i(String(o),a);if(f&&!s[n].test(d))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+d+'"');t+=a.prefix+d+a.suffix}}else t+=a}return t}}(n(e,r),r)}function i(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function o(e){return e&&e.sensitive?"":"i"}function u(e,r,t){return function(e,r,t){void 0===t&&(t={});var n=t,a=n.strict,u=void 0!==a&&a,f=n.start,s=void 0===f||f,c=n.end,p=void 0===c||c,v=n.encode,l=void 0===v?function(e){return e}:v,d="["+i(t.endsWith||"")+"]|$",h="["+i(t.delimiter||"/#?")+"]",y=s?"^":"",g=e,m=Array.isArray(g),x=0;for(g=m?g:g[Symbol.iterator]();;){var E;if(m){if(x>=g.length)break;E=g[x++]}else{if((x=g.next()).done)break;E=x.value}var w=E;if("string"==typeof w)y+=i(l(w));else{var P=i(l(w.prefix)),R=i(l(w.suffix));if(w.pattern)if(r&&r.push(w),P||R)if("+"===w.modifier||"*"===w.modifier){var b="*"===w.modifier?"?":"";y+="(?:"+P+"((?:"+w.pattern+")(?:"+R+P+"(?:"+w.pattern+"))*)"+R+")"+b}else y+="(?:"+P+"("+w.pattern+")"+R+")"+w.modifier;else y+="("+w.pattern+")"+w.modifier;else y+="(?:"+P+R+")"+w.modifier}}if(p)u||(y+=h+"?"),y+=t.endsWith?"(?="+d+")":"$";else{var A=e[e.length-1],T="string"==typeof A?h.indexOf(A[A.length-1])>-1:void 0===A;u||(y+="(?:"+h+"(?="+d+"))?"),T||(y+="(?="+h+"|"+d+")")}return new RegExp(y,o(t))}(n(e,t),r,t)}function f(e,r,t){return e instanceof RegExp?function(e,r){if(!r)return e;var t=e.source.match(/\((?!\?)/g);if(t)for(var n=0;n<t.length;n++)r.push({name:n,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,r):Array.isArray(e)?function(e,r,t){var n=e.map((function(e){return f(e,r,t).source}));return new RegExp("(?:"+n.join("|")+")",o(t))}(e,r,t):u(e,r,t)}var s={},c=0;function p(e,r){void 0===r&&(r={end:!1,strict:!1,sensitive:!1});var t=""+r.end+r.strict+r.sensitive,n=s[t]||(s[t]={});if(n[e])return n[e];var a=[],i={regexp:f(e,a,r),keys:a};return c<1e4&&(n[e]=i,c++),i}function v(e,r){void 0===r&&(r={}),("string"==typeof r||Array.isArray(r))&&(r={path:r});var t=r,n=t.path,a=t.exact,i=void 0!==a&&a,o=t.strict,u=void 0!==o&&o,f=t.sensitive,s=void 0!==f&&f;return[].concat(n).reduce((function(r,t){if(!t)return null;if(r)return r;if("*"===t)return{path:t,url:e,isExact:!0,params:{}};var n=p(t,{end:i,strict:u,sensitive:s}),a=n.regexp,o=n.keys,f=a.exec(e);if(!f)return null;var c=f[0],v=f.slice(1),l=e===c;return i&&!l?null:{path:t,url:"/"===t&&""===c?"/":c,isExact:l,params:o.reduce((function(e,r,t){return e[r.name]=v[t],e}),{})}}),null)}var l={escape:!0,dateParse:!0,splitKey:"q",defaultRouteParams:{}};var d=/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d(\.\d+)?(Z|[+-][01]\d:[0-5]\d)$/;function h(e,r){return"string"==typeof r&&d.test(r)?new Date(r):r}function y(e){for(var r=[""],t=0,n=e.length;t<n;t++)r.push(e[t]||"");return r.join("&"+l.splitKey+"=")}function g(e){if("object"!=typeof e)return"";var r=JSON.stringify(e);return"{}"===r?"":l.escape?escape(r):r}function m(e){var r=new RegExp("[&?#]"+l.splitKey+"=[^&]*","g"),t=e.match(r),n=[];return t&&(n=t.map((function(e){return function(e){if(!e)return{};l.escape&&(e=unescape(e));try{return JSON.parse(e,l.dateParse?h:void 0)}catch(e){return{}}}(e.split("=")[1])}))),n}function x(e){var r={};for(var t in e)e.hasOwnProperty(t)&&function(){var n=e[t],a=t.split(".");a.length>1?a.reduce((function(e,r,t,a){return t===a.length-1?e[r]=n:e[r]={},e[r]}),r):r[t]=n}();return r}function E(e,n,a){n[0]||(n[0]={}),a&&(n[0]=r({},a,n[0]));var i=n[0],o=e.reduce((function(e,r){var n=r.split(t.config.VSP),a=n[0],o=n[1];return o&&(e[a]||(e[a]={}),e[a][o]=!0,i[a]||(i[a]={})),e}),{});Object.keys(i).forEach((function(e){i[e]=r({},l.defaultRouteParams[e],i[e])}));var u=r.apply(void 0,[{}].concat(n));return Object.keys(u).forEach((function(e){i[e]||(u[e]=r({},l.defaultRouteParams[e],u[e]))})),{views:o,paths:e,params:u,stackParams:n}}function w(e){var t=e.extend||{views:{},paths:[],stackParams:[],params:{}},n=[].concat(t.stackParams);return e.params&&(n[0]=r({},n[0],e.params)),E(e.paths||t.paths,n)}function P(e){return"string"!=typeof e&&!e.pathname}exports.buildToBrowserUrl=function(e){return function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];if(1===t.length){var a=e().routeToLocation(w(t[0]));t=[a.pathname,a.search,a.hash]}var i=t,o=i[0],u=i[1],f=i[2],s=o;return u&&(s+=u),f&&(s+=f),s}},exports.buildTransformRoute=function(e){var n=function e(r,t,n,a){for(var i in void 0===t&&(t=""),void 0===n&&(n={}),void 0===a&&(a={}),r)if(r.hasOwnProperty(i)){if(!a[i]){var o=p(i,{end:!0,strict:!1,sensitive:!1}).keys;a[i]=o.reduce((function(e,r){return e.push(r.name),e}),[])}var u=r[i],f="string"==typeof u?[u,null]:u,s=f[0],c=f[1],v=t+"/"+s;n[v]=i,c&&e(c,v,n,a)}return{viewToRule:n,ruleToKeys:a}}(e),i=n.viewToRule,o=n.ruleToKeys;return{locationToRoute:function(n){var a=[],i={};!function e(r,n,a,i){for(var o in n)if(n.hasOwnProperty(o)){var u=n[o],f="string"==typeof u?[u,null]:u,s=f[0],c=f[1],p=v(r,{path:o,exact:!c});if(p){a.push(s);var l=s.split(t.config.VSP)[0],d=p.params;return d&&Object.keys(d).length>0&&(i[l]=Object.assign({},i[l],{},x(d))),void(c&&e(r,c,a,i))}}}(n.pathname,e,a,i);var o=m(n.search);return m(n.hash).forEach((function(e,t){e&&(o[t]||(o[t]={}),r(o[t],e))})),E(a,o,i)},routeToLocation:function(e){var n,u=e.views,f=e.paths,p=e.params,v=e.stackParams,d=v[0],h="";f.length>0?(n=r({},d),f.reduce((function(e,r,u){var v=e+"/"+r,l=i[v],d=r.split(t.config.VSP)[0];if(u===f.length-1){var y=function(e){if(s[e])return s[e];var r=a(e);return c<1e4&&(s[e]=r,c++),r}(l),g=(o[l]||[]).reduce((function(e,r){if("string"==typeof r){var t=r.split(".");if(t.length)return e[r]=t.reduce((function(e,r){return e[r]}),p[d]),e}return e[r]=p[d][r],e}),{});h=y(g)}return(o[l]||[]).forEach((function(e){if("string"==typeof e){var r=e.split(".");if(r.length)return void r.reduce((function(e,t,n){return n===r.length-1&&delete e[t],e[t]||{}}),n[d]||{})}n[d]&&delete n[d][e]})),v}),"")):n=d;var m=[].concat(v);m[0]=function e(r,t,n,a){var i={};if(Object.keys(r).forEach((function(n){var o=r[n],u=t[n];o!==u&&(typeof o!=typeof u||"object"!=typeof o||Array.isArray(o)||(o=e(o,u,!!a&&!a[n])),void 0!==o&&(i[n]=o))})),0!==Object.keys(i).length||n)return i}(n,l.defaultRouteParams,!1,u);var x=[],E=[];return m.forEach((function(e,r){var t=function(e){var r={},t={},n=function(n){if(e[n]&&e.hasOwnProperty(n)){var a=e[n],i=Object.keys(a);i.length>0?i.forEach((function(e){e.startsWith("_")?(t[n]||(t[n]={}),t[n][e]=a[e]):(r[n]||(r[n]={}),r[n][e]=a[e])})):r[n]={}}};for(var a in e)n(a);return{search:g(r),hash:g(t)}}(e),n=t.search,a=t.hash;n&&(x[r]=n),a&&(E[r]=a)})),{pathname:h,search:"?"+y(x).substr(1),hash:"#"+y(E).substr(1)}}}},exports.fillBrowserRouteData=w,exports.fillRouteData=function(e){var t=e.extend||{views:{},paths:[],stackParams:[],params:{}},n=[].concat(t.stackParams);return e.stackParams&&e.stackParams.forEach((function(e,t){e&&(n[t]=r({},n[t],e))})),E(e.paths||t.paths,n)},exports.getBrowserRouteActions=function(e){return{push:function(r){var t=r;P(r)&&(t=w(r)),e().push(t)},replace:function(r){var t=r;P(r)&&(t=w(r)),e().replace(t)},go:function(r){e().go(r)},goBack:function(){e().goBack()},goForward:function(){e().goForward()}}},exports.setRouteConfig=function(e){void 0!==e.escape&&(l.escape=e.escape),void 0!==e.dateParse&&(l.dateParse=e.dateParse),e.splitKey&&(l.splitKey=e.splitKey),e.defaultRouteParams&&(l.defaultRouteParams=e.defaultRouteParams)};
//# sourceMappingURL=index.min.js.map
