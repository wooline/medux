"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,r=require("@medux/core"),t=(e=require("deep-extend"))&&"object"==typeof e&&"default"in e?e.default:e;function n(e){var r=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,r){if(!e)return;if("string"==typeof e)return a(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return a(e,r)}(e)))return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function a(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function i(e,r){void 0===r&&(r={});for(var t=function(e){for(var r=[],t=0;t<e.length;){var n=e[t];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)r.push({type:"CHAR",index:t,value:e[t++]});else{var a=1,i="",o=t+1;if("?"===e[o])throw new TypeError('Pattern cannot start with "?" at '+o);for(;o<e.length;)if("\\"!==e[o]){if(")"===e[o]){if(0===--a){o++;break}}else if("("===e[o]&&(a++,"?"!==e[o+1]))throw new TypeError("Capturing groups are not allowed at "+o);i+=e[o++]}else i+=e[o++]+e[o++];if(a)throw new TypeError("Unbalanced pattern at "+t);if(!i)throw new TypeError("Missing pattern at "+t);r.push({type:"PATTERN",index:t,value:i}),t=o}else{for(var u="",f=t+1;f<e.length;){var s=e.charCodeAt(f);if(!(s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||95===s||46===s))break;u+=e[f++]}if(!u)throw new TypeError("Missing parameter name at "+t);r.push({type:"NAME",index:t,value:u}),t=f}else r.push({type:"CLOSE",index:t,value:e[t++]});else r.push({type:"OPEN",index:t,value:e[t++]});else r.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});else r.push({type:"MODIFIER",index:t,value:e[t++]})}return r.push({type:"END",index:t,value:""}),r}(e),n=r.prefixes,a=void 0===n?"./":n,i="[^"+u(r.delimiter||"/#?")+"]+?",o=[],f=0,s=0,c="",p=function(e){if(s<t.length&&t[s].type===e)return t[s++].value},l=function(e){var r=p(e);if(void 0!==r)return r;var n=t[s],a=n.type,i=n.index;throw new TypeError("Unexpected "+a+" at "+i+", expected "+e)},v=function(){for(var e,r="";e=p("CHAR")||p("ESCAPED_CHAR");)r+=e;return r};s<t.length;){var d=p("CHAR"),h=p("NAME"),y=p("PATTERN");if(h||y){var m=d||"";-1===a.indexOf(m)&&(c+=m,m=""),c&&(o.push(c),c=""),o.push({name:h||f++,prefix:m,suffix:"",pattern:y||i,modifier:p("MODIFIER")||""})}else{var g=d||p("ESCAPED_CHAR");if(g)c+=g;else if(c&&(o.push(c),c=""),p("OPEN")){var x=v(),E=p("NAME")||"",w=p("PATTERN")||"",P=v();l("CLOSE"),o.push({name:E||(w?f++:""),pattern:E&&!w?i:w,prefix:x,suffix:P,modifier:p("MODIFIER")||""})}else l("END")}}return o}function o(e,r){return function(e,r){void 0===r&&(r={});var t=f(r),n=r,a=n.encode,i=void 0===a?function(e){return e}:a,o=n.validate,u=void 0===o||o,s=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",t)}));return function(r){for(var t="",n=0;n<e.length;n++){var a=e[n];if("string"!=typeof a){var o=r?r[a.name]:void 0,f="?"===a.modifier||"*"===a.modifier,c="*"===a.modifier||"+"===a.modifier;if(Array.isArray(o)){if(!c)throw new TypeError('Expected "'+a.name+'" to not repeat, but got an array');if(0===o.length){if(f)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var p=0;p<o.length;p++){var l=i(o[p],a);if(u&&!s[n].test(l))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'", but got "'+l+'"');t+=a.prefix+l+a.suffix}}else if("string"!=typeof o&&"number"!=typeof o){if(!f){var v=c?"an array":"a string";throw new TypeError('Expected "'+a.name+'" to be '+v)}}else{var d=i(String(o),a);if(u&&!s[n].test(d))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+d+'"');t+=a.prefix+d+a.suffix}}else t+=a}return t}}(i(e,r),r)}function u(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function f(e){return e&&e.sensitive?"":"i"}function s(e,r,t){return function(e,r,t){void 0===t&&(t={});for(var a,i=t,o=i.strict,s=void 0!==o&&o,c=i.start,p=void 0===c||c,l=i.end,v=void 0===l||l,d=i.encode,h=void 0===d?function(e){return e}:d,y="["+u(t.endsWith||"")+"]|$",m="["+u(t.delimiter||"/#?")+"]",g=p?"^":"",x=n(e);!(a=x()).done;){var E=a.value;if("string"==typeof E)g+=u(h(E));else{var w=u(h(E.prefix)),P=u(h(E.suffix));if(E.pattern)if(r&&r.push(E),w||P)if("+"===E.modifier||"*"===E.modifier){var b="*"===E.modifier?"?":"";g+="(?:"+w+"((?:"+E.pattern+")(?:"+P+w+"(?:"+E.pattern+"))*)"+P+")"+b}else g+="(?:"+w+"("+E.pattern+")"+P+")"+E.modifier;else g+="("+E.pattern+")"+E.modifier;else g+="(?:"+w+P+")"+E.modifier}}if(v)s||(g+=m+"?"),g+=t.endsWith?"(?="+y+")":"$";else{var A=e[e.length-1],R="string"==typeof A?m.indexOf(A[A.length-1])>-1:void 0===A;s||(g+="(?:"+m+"(?="+y+"))?"),R||(g+="(?="+m+"|"+y+")")}return new RegExp(g,f(t))}(i(e,t),r,t)}function c(e,r,t){return e instanceof RegExp?function(e,r){if(!r)return e;var t=e.source.match(/\((?!\?)/g);if(t)for(var n=0;n<t.length;n++)r.push({name:n,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,r):Array.isArray(e)?function(e,r,t){var n=e.map((function(e){return c(e,r,t).source}));return new RegExp("(?:"+n.join("|")+")",f(t))}(e,r,t):s(e,r,t)}var p={},l=0;function v(e,r){void 0===r&&(r={end:!1,strict:!1,sensitive:!1});var t=""+r.end+r.strict+r.sensitive,n=p[t]||(p[t]={});if(n[e])return n[e];var a=[],i={regexp:c(e,a,r),keys:a};return l<1e4&&(n[e]=i,l++),i}function d(e,r){void 0===r&&(r={}),("string"==typeof r||Array.isArray(r))&&(r={path:r});var t=r,n=t.path,a=t.exact,i=void 0!==a&&a,o=t.strict,u=void 0!==o&&o,f=t.sensitive,s=void 0!==f&&f;return[].concat(n).reduce((function(r,t){if(!t)return null;if(r)return r;if("*"===t)return{path:t,url:e,isExact:!0,params:{}};var n=v(t,{end:i,strict:u,sensitive:s}),a=n.regexp,o=n.keys,f=a.exec(e);if(!f)return null;var c=f[0],p=f.slice(1),l=e===c;return i&&!l?null:{path:t,url:"/"===t&&""===c?"/":c,isExact:l,params:o.reduce((function(e,r,t){return e[r.name]=p[t],e}),{})}}),null)}var h={escape:!0,dateParse:!0,splitKey:"q",defaultRouteParams:{}};var y=/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d(\.\d+)?(Z|[+-][01]\d:[0-5]\d)$/;function m(e,r){return"string"==typeof r&&y.test(r)?new Date(r):r}function g(e){for(var r=[""],t=0,n=e.length;t<n;t++)r.push(e[t]||"");return r.join("&"+h.splitKey+"=")}function x(e){if("object"!=typeof e)return"";var r=JSON.stringify(e);return"{}"===r?"":h.escape?escape(r):r}function E(e){var r=new RegExp("[&?#]"+h.splitKey+"=[^&]*","g"),t=e.match(r),n=[];return t&&(n=t.map((function(e){return function(e){if(!e)return{};h.escape&&(e=unescape(e));try{return JSON.parse(e,h.dateParse?m:void 0)}catch(e){return{}}}(e.split("=")[1])}))),n}function w(e){var r={};for(var t in e)e.hasOwnProperty(t)&&function(){var n=e[t],a=t.split(".");a.length>1?a.reduce((function(e,r,t,a){return t===a.length-1?e[r]=n:e[r]={},e[r]}),r):r[t]=n}();return r}function P(e,n,a){n[0]||(n[0]={}),a&&(n[0]=t({},a,n[0]));var i=n[0],o=e.reduce((function(e,t){var n=t.split(r.config.VSP),a=n[0],o=n[1];return o&&(e[a]||(e[a]={}),e[a][o]=!0,i[a]||(i[a]={})),e}),{});Object.keys(i).forEach((function(e){i[e]=t({},h.defaultRouteParams[e],i[e])}));var u=t.apply(void 0,[{}].concat(n));return Object.keys(u).forEach((function(e){i[e]||(u[e]=t({},h.defaultRouteParams[e],u[e]))})),{views:o,paths:e,params:u,stackParams:n}}function b(e){var r=e.extend||{views:{},paths:[],stackParams:[],params:{}},n=[].concat(r.stackParams);return e.params&&(n[0]=t({},n[0],e.params)),P(e.paths||r.paths,n)}function A(e){return"string"!=typeof e&&!e.pathname}exports.buildToBrowserUrl=function(e){return function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];if(1===t.length){var a=e().routeToLocation(b(t[0]));t=[a.pathname,a.search,a.hash]}var i=t,o=i[0],u=i[1],f=i[2],s=o;return u&&(s+=u),f&&(s+=f),s}},exports.buildTransformRoute=function(e){var n=function e(r,t,n,a){for(var i in void 0===t&&(t=""),void 0===n&&(n={}),void 0===a&&(a={}),r)if(r.hasOwnProperty(i)){if(!a[i]){var o=v(i,{end:!0,strict:!1,sensitive:!1}).keys;a[i]=o.reduce((function(e,r){return e.push(r.name),e}),[])}var u=r[i],f="string"==typeof u?[u,null]:u,s=f[0],c=f[1],p=t+"/"+s;n[p]=i,c&&e(c,p,n,a)}return{viewToRule:n,ruleToKeys:a}}(e),a=n.viewToRule,i=n.ruleToKeys;return{locationToRoute:function(n){var a=[],i={};!function e(t,n,a,i){for(var o in n)if(n.hasOwnProperty(o)){var u=n[o],f="string"==typeof u?[u,null]:u,s=f[0],c=f[1],p=d(t,{path:o,exact:!c});if(p){a.push(s);var l=s.split(r.config.VSP)[0],v=p.params;return v&&Object.keys(v).length>0&&(i[l]=Object.assign({},i[l],{},w(v))),void(c&&e(t,c,a,i))}}}(n.pathname,e,a,i);var o=E(n.search);return E(n.hash).forEach((function(e,r){e&&(o[r]||(o[r]={}),t(o[r],e))})),P(a,o,i)},routeToLocation:function(e){var n,u=e.views,f=e.paths,s=e.params,c=e.stackParams,v=c[0],d="";f.length>0?(n=t({},v),f.reduce((function(e,t,u){var c=e+"/"+t,v=a[c],h=t.split(r.config.VSP)[0];if(u===f.length-1){var y=function(e){if(p[e])return p[e];var r=o(e);return l<1e4&&(p[e]=r,l++),r}(v),m=(i[v]||[]).reduce((function(e,r){if("string"==typeof r){var t=r.split(".");if(t.length)return e[r]=t.reduce((function(e,r){return e[r]}),s[h]),e}return e[r]=s[h][r],e}),{});d=y(m)}return(i[v]||[]).forEach((function(e){if("string"==typeof e){var r=e.split(".");if(r.length)return void r.reduce((function(e,t,n){return n===r.length-1&&delete e[t],e[t]||{}}),n[h]||{})}n[h]&&delete n[h][e]})),c}),"")):n=v;var y=[].concat(c);y[0]=function e(r,t,n,a){var i={};if(Object.keys(r).forEach((function(n){var o=r[n],u=t[n];o!==u&&(typeof o!=typeof u||"object"!=typeof o||Array.isArray(o)||(o=e(o,u,!!a&&!a[n])),void 0!==o&&(i[n]=o))})),0!==Object.keys(i).length||n)return i}(n,h.defaultRouteParams,!1,u);var m=[],E=[];return y.forEach((function(e,r){var t=function(e){var r={},t={},n=function(n){if(e[n]&&e.hasOwnProperty(n)){var a=e[n],i=Object.keys(a);i.length>0?i.forEach((function(e){e.startsWith("_")?(t[n]||(t[n]={}),t[n][e]=a[e]):(r[n]||(r[n]={}),r[n][e]=a[e])})):r[n]={}}};for(var a in e)n(a);return{search:x(r),hash:x(t)}}(e),n=t.search,a=t.hash;n&&(m[r]=n),a&&(E[r]=a)})),{pathname:d,search:"?"+g(m).substr(1),hash:"#"+g(E).substr(1)}}}},exports.fillBrowserRouteData=b,exports.fillRouteData=function(e){var r=e.extend||{views:{},paths:[],stackParams:[],params:{}},n=[].concat(r.stackParams);return e.stackParams&&e.stackParams.forEach((function(e,r){e&&(n[r]=t({},n[r],e))})),P(e.paths||r.paths,n)},exports.getBrowserRouteActions=function(e){return{push:function(r){var t=r;A(r)&&(t=b(r)),e().push(t)},replace:function(r){var t=r;A(r)&&(t=b(r)),e().replace(t)},go:function(r){e().go(r)},goBack:function(){e().goBack()},goForward:function(){e().goForward()}}},exports.setRouteConfig=function(e){void 0!==e.escape&&(h.escape=e.escape),void 0!==e.dateParse&&(h.dateParse=e.dateParse),e.splitKey&&(h.splitKey=e.splitKey),e.defaultRouteParams&&(h.defaultRouteParams=e.defaultRouteParams)};
//# sourceMappingURL=index.min.js.map
