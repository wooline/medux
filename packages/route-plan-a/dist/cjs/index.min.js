"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,r=require("@medux/core"),t=(e=require("deep-extend"))&&"object"==typeof e&&"default"in e?e.default:e;function n(e){var r=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,r){if(!e)return;if("string"==typeof e)return i(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i(e,r)}(e)))return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function i(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function a(e,r){void 0===r&&(r={});for(var t=function(e){for(var r=[],t=0;t<e.length;){var n=e[t];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)r.push({type:"CHAR",index:t,value:e[t++]});else{var i=1,a="",o=t+1;if("?"===e[o])throw new TypeError('Pattern cannot start with "?" at '+o);for(;o<e.length;)if("\\"!==e[o]){if(")"===e[o]){if(0===--i){o++;break}}else if("("===e[o]&&(i++,"?"!==e[o+1]))throw new TypeError("Capturing groups are not allowed at "+o);a+=e[o++]}else a+=e[o++]+e[o++];if(i)throw new TypeError("Unbalanced pattern at "+t);if(!a)throw new TypeError("Missing pattern at "+t);r.push({type:"PATTERN",index:t,value:a}),t=o}else{for(var u="",f=t+1;f<e.length;){var s=e.charCodeAt(f);if(!(s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||95===s||46===s))break;u+=e[f++]}if(!u)throw new TypeError("Missing parameter name at "+t);r.push({type:"NAME",index:t,value:u}),t=f}else r.push({type:"CLOSE",index:t,value:e[t++]});else r.push({type:"OPEN",index:t,value:e[t++]});else r.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});else r.push({type:"MODIFIER",index:t,value:e[t++]})}return r.push({type:"END",index:t,value:""}),r}(e),n=r.prefixes,i=void 0===n?"./":n,a="[^"+u(r.delimiter||"/#?")+"]+?",o=[],f=0,s=0,c="",p=function(e){if(s<t.length&&t[s].type===e)return t[s++].value},l=function(e){var r=p(e);if(void 0!==r)return r;var n=t[s],i=n.type,a=n.index;throw new TypeError("Unexpected "+i+" at "+a+", expected "+e)},v=function(){for(var e,r="";e=p("CHAR")||p("ESCAPED_CHAR");)r+=e;return r};s<t.length;){var d=p("CHAR"),h=p("NAME"),y=p("PATTERN");if(h||y){var m=d||"";-1===i.indexOf(m)&&(c+=m,m=""),c&&(o.push(c),c=""),o.push({name:h||f++,prefix:m,suffix:"",pattern:y||a,modifier:p("MODIFIER")||""})}else{var g=d||p("ESCAPED_CHAR");if(g)c+=g;else if(c&&(o.push(c),c=""),p("OPEN")){var x=v(),E=p("NAME")||"",w=p("PATTERN")||"",b=v();l("CLOSE"),o.push({name:E||(w?f++:""),pattern:E&&!w?a:w,prefix:x,suffix:b,modifier:p("MODIFIER")||""})}else l("END")}}return o}function o(e,r){return function(e,r){void 0===r&&(r={});var t=f(r),n=r,i=n.encode,a=void 0===i?function(e){return e}:i,o=n.validate,u=void 0===o||o,s=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",t)}));return function(r){for(var t="",n=0;n<e.length;n++){var i=e[n];if("string"!=typeof i){var o=r?r[i.name]:void 0,f="?"===i.modifier||"*"===i.modifier,c="*"===i.modifier||"+"===i.modifier;if(Array.isArray(o)){if(!c)throw new TypeError('Expected "'+i.name+'" to not repeat, but got an array');if(0===o.length){if(f)continue;throw new TypeError('Expected "'+i.name+'" to not be empty')}for(var p=0;p<o.length;p++){var l=a(o[p],i);if(u&&!s[n].test(l))throw new TypeError('Expected all "'+i.name+'" to match "'+i.pattern+'", but got "'+l+'"');t+=i.prefix+l+i.suffix}}else if("string"!=typeof o&&"number"!=typeof o){if(!f){var v=c?"an array":"a string";throw new TypeError('Expected "'+i.name+'" to be '+v)}}else{var d=a(String(o),i);if(u&&!s[n].test(d))throw new TypeError('Expected "'+i.name+'" to match "'+i.pattern+'", but got "'+d+'"');t+=i.prefix+d+i.suffix}}else t+=i}return t}}(a(e,r),r)}function u(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function f(e){return e&&e.sensitive?"":"i"}function s(e,r,t){return function(e,r,t){void 0===t&&(t={});for(var i,a=t,o=a.strict,s=void 0!==o&&o,c=a.start,p=void 0===c||c,l=a.end,v=void 0===l||l,d=a.encode,h=void 0===d?function(e){return e}:d,y="["+u(t.endsWith||"")+"]|$",m="["+u(t.delimiter||"/#?")+"]",g=p?"^":"",x=n(e);!(i=x()).done;){var E=i.value;if("string"==typeof E)g+=u(h(E));else{var w=u(h(E.prefix)),b=u(h(E.suffix));if(E.pattern)if(r&&r.push(E),w||b)if("+"===E.modifier||"*"===E.modifier){var P="*"===E.modifier?"?":"";g+="(?:"+w+"((?:"+E.pattern+")(?:"+b+w+"(?:"+E.pattern+"))*)"+b+")"+P}else g+="(?:"+w+"("+E.pattern+")"+b+")"+E.modifier;else g+="("+E.pattern+")"+E.modifier;else g+="(?:"+w+b+")"+E.modifier}}if(v)s||(g+=m+"?"),g+=t.endsWith?"(?="+y+")":"$";else{var A=e[e.length-1],R="string"==typeof A?m.indexOf(A[A.length-1])>-1:void 0===A;s||(g+="(?:"+m+"(?="+y+"))?"),R||(g+="(?="+m+"|"+y+")")}return new RegExp(g,f(t))}(a(e,t),r,t)}function c(e,r,t){return e instanceof RegExp?function(e,r){if(!r)return e;var t=e.source.match(/\((?!\?)/g);if(t)for(var n=0;n<t.length;n++)r.push({name:n,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,r):Array.isArray(e)?function(e,r,t){var n=e.map((function(e){return c(e,r,t).source}));return new RegExp("(?:"+n.join("|")+")",f(t))}(e,r,t):s(e,r,t)}var p={},l=0;function v(e,r){void 0===r&&(r={end:!1,strict:!1,sensitive:!1});var t=""+r.end+r.strict+r.sensitive,n=p[t]||(p[t]={});if(n[e])return n[e];var i=[],a={regexp:c(e,i,r),keys:i};return l<1e4&&(n[e]=a,l++),a}function d(e,r){void 0===r&&(r={}),("string"==typeof r||Array.isArray(r))&&(r={path:r});var t=r,n=t.path,i=t.exact,a=void 0!==i&&i,o=t.strict,u=void 0!==o&&o,f=t.sensitive,s=void 0!==f&&f;return[].concat(n).reduce((function(r,t){if(!t)return null;if(r)return r;if("*"===t)return{path:t,url:e,isExact:!0,params:{}};var n=v(t,{end:a,strict:u,sensitive:s}),i=n.regexp,o=n.keys,f=i.exec(e);if(!f)return null;var c=f[0],p=f.slice(1),l=e===c;return a&&!l?null:{path:t,url:"/"===t&&""===c?"/":c,isExact:l,params:o.reduce((function(e,r,t){return e[r.name]=p[t],e}),{})}}),null)}var h=t,y={escape:!0,dateParse:!0,splitKey:"q",defaultRouteParams:{}};var m=/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d(\.\d+)?(Z|[+-][01]\d:[0-5]\d)$/;function g(e,r){return"string"==typeof r&&m.test(r)?new Date(r):r}function x(e){for(var r=[""],t=0,n=e.length;t<n;t++)r.push(e[t]||"");return r.join("&"+y.splitKey+"=")}function E(e){if("object"!=typeof e)return"";var r=JSON.stringify(e);return"{}"===r?"":y.escape?escape(r):r}function w(e){var r=new RegExp("[&?#]"+y.splitKey+"=[^&]*","g"),t=e.match(r),n=[];return t&&(n=t.map((function(e){return function(e){if(!e)return{};y.escape&&(e=unescape(e));try{return JSON.parse(e,y.dateParse?g:void 0)}catch(e){return{}}}(e.split("=")[1])}))),n}function b(e){var r={};for(var t in e)e.hasOwnProperty(t)&&function(){var n=e[t],i=t.split(".");i.length>1?i.reduce((function(e,r,t,i){return t===i.length-1?e[r]=n:e[r]={},e[r]}),r):r[t]=n}();return r}function P(e,n,i){n[0]||(n[0]={}),i&&(n[0]=t({},i,n[0]));var a=n[0],o=e.reduce((function(e,t){var n=t.split(r.config.VSP),i=n[0],o=n[1];return o&&(e[i]||(e[i]={}),e[i][o]=!0,a[i]||(a[i]={})),e}),{});Object.keys(a).forEach((function(e){a[e]=t({},y.defaultRouteParams[e],a[e])}));var u=t.apply(void 0,[{}].concat(n));return Object.keys(u).forEach((function(e){a[e]||(u[e]=t({},y.defaultRouteParams[e],u[e]))})),{views:o,paths:e,params:u,stackParams:n}}exports.assignRouteData=P,exports.buildTransformRoute=function(e){var n=function e(r,t,n,i){for(var a in void 0===t&&(t=""),void 0===n&&(n={}),void 0===i&&(i={}),r)if(r.hasOwnProperty(a)){if(!i[a]){var o=v(a,{end:!0,strict:!1,sensitive:!1}).keys;i[a]=o.reduce((function(e,r){return e.push(r.name),e}),[])}var u=r[a],f="string"==typeof u?[u,null]:u,s=f[0],c=f[1],p=t+"/"+s;n[p]=a,c&&e(c,p,n,i)}return{viewToRule:n,ruleToKeys:i}}(e),i=n.viewToRule,a=n.ruleToKeys;return{locationToRoute:function(n){var i=[],a={};!function e(t,n,i,a){for(var o in n)if(n.hasOwnProperty(o)){var u=n[o],f="string"==typeof u?[u,null]:u,s=f[0],c=f[1],p=d(t,{path:o.replace(/\$$/,""),exact:!c});if(p){i.push(s);var l=s.split(r.config.VSP)[0],v=p.params;return v&&Object.keys(v).length>0&&(a[l]=Object.assign({},a[l],{},b(v))),void(c&&e(t,c,i,a))}}}(n.pathname,e,i,a);var o=w(n.search);return w(n.hash).forEach((function(e,r){e&&(o[r]||(o[r]={}),t(o[r],e))})),P(i,o,a)},routeToLocation:function(e){var n,u=e.views,f=e.paths,s=e.params,c=e.stackParams,v=c[0],d="";f.length>0?(n=t({},v),f.reduce((function(e,t,u){var c=e+"/"+t,v=i[c],h=t.split(r.config.VSP)[0];if(u===f.length-1){var y=function(e){if(p[e])return p[e];var r=o(e);return l<1e4&&(p[e]=r,l++),r}(v),m=(a[v]||[]).reduce((function(e,r){if("string"==typeof r){var t=r.split(".");if(t.length)return e[r]=t.reduce((function(e,r){return e[r]}),s[h]),e}return e[r]=s[h][r],e}),{});d=y(m)}return(a[v]||[]).forEach((function(e){if("string"==typeof e){var r=e.split(".");if(r.length)return void r.reduce((function(e,t,n){return n===r.length-1&&delete e[t],e[t]||{}}),n[h]||{})}n[h]&&delete n[h][e]})),c}),"")):n=v;var h=[].concat(c);h[0]=function e(r,t,n,i){var a={};if(Object.keys(r).forEach((function(n){var o=r[n],u=t[n];o!==u&&(typeof o!=typeof u||"object"!=typeof o||Array.isArray(o)||(o=e(o,u,!!i&&!i[n])),void 0!==o&&(a[n]=o))})),0!==Object.keys(a).length||n)return a}(n,y.defaultRouteParams,!1,u);var m=[],g=[];return h.forEach((function(e,r){var t=function(e){var r={},t={},n=function(n){if(e[n]&&e.hasOwnProperty(n)){var i=e[n],a=Object.keys(i);a.length>0?a.forEach((function(e){e.startsWith("_")?(t[n]||(t[n]={}),t[n][e]=i[e]):(r[n]||(r[n]={}),r[n][e]=i[e])})):r[n]={}}};for(var i in e)n(i);return{search:E(r),hash:E(t)}}(e),n=t.search,i=t.hash;n&&(m[r]=n),i&&(g[r]=i)})),{pathname:d,search:"?"+x(m).substr(1),hash:"#"+x(g).substr(1)}}}},exports.deepAssign=h,exports.fillRouteData=function(e){var r=e.extend||{views:{},paths:[],stackParams:[],params:{}},n=[].concat(r.stackParams);return e.stackParams&&e.stackParams.forEach((function(e,r){e&&(n[r]=t({},n[r],e))})),P(e.paths||r.paths,n)},exports.setRouteConfig=function(e){void 0!==e.escape&&(y.escape=e.escape),void 0!==e.dateParse&&(y.dateParse=e.dateParse),e.splitKey&&(y.splitKey=e.splitKey),e.defaultRouteParams&&(y.defaultRouteParams=e.defaultRouteParams)};
//# sourceMappingURL=index.min.js.map
