{"version":3,"sources":["../../src/index.ts"],"names":["config","escape","dateParse","splitKey","defaultRouteParams","setRouteConfig","conf","undefined","excludeDefaultData","data","def","holde","views","result","Object","keys","forEach","moduleName","value","defaultValue","Array","isArray","length","ISO_DATE_FORMAT","prop","test","Date","searchParse","search","unescape","JSON","parse","error","joinSearchString","arr","strs","i","k","push","join","searchStringify","searchData","str","stringify","splitSearch","reg","RegExp","match","stackParams","map","split","checkPathArgs","params","obj","key","hasOwnProperty","val","props","reduce","prev","cur","index","pathnameParse","pathname","routeConfig","paths","args","rule","item","viewName","pathConfig","path","exact","coreConfig","VSP","compileConfig","parentAbsoluteViewName","viewToRule","ruleToKeys","end","strict","sensitive","name","absoluteViewName","assignRouteData","firstStackParams","assignDeep","fillRouteData","routePayload","extend","extractHashData","searchParams","hashParams","startsWith","hash","buildTransformRoute","locationToRoute","location","pathsArgs","hashStackParams","routeToLocation","routeData","firstStackParamsFilter","toPath","p","c","searchStrings","hashStrings","substr","fillBrowserRouteData","isBrowserRoutePayload","getBrowserRouteActions","getBrowserHistoryActions","replace","go","n","goBack","goForward","buildToBrowserUrl","getTransformRoute","toUrl","url"],"mappings":"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AAqB;AAAA;;AACrC,QAAIA,IAAI,CAAC5C,MAAL,KAAgB,CAApB,EAAuB;AACrB,UAAM2E,SAAQ,GAAGsB,iBAAiB,GAAGnB,eAApB,CAAoCS,oBAAoB,CAAC3C,IAAI,CAAC,CAAD,CAAL,CAAxD,CAAjB;;AACAA,MAAAA,IAAI,GAAG,CAAC+B,SAAQ,CAAClC,QAAV,EAAoBkC,SAAQ,CAACrE,MAA7B,EAAqCqE,SAAQ,CAACH,IAA9C,CAAP;AACD;;AAJoC,gBAKJ5B,IALI;AAAA,QAK9BH,QAL8B;AAAA,QAKpBnC,MALoB;AAAA,QAKZkE,IALY;AAMrC,QAAI2B,GAAG,GAAG1D,QAAV;;AACA,QAAInC,MAAJ,EAAY;AACV6F,MAAAA,GAAG,IAAI7F,MAAP;AACD;;AACD,QAAIkE,IAAJ,EAAU;AACR2B,MAAAA,GAAG,IAAI3B,IAAP;AACD;;AACD,WAAO2B,GAAP;AACD;;AACD,SAAOD,KAAP;AACD,C,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","sourcesContent":["import {DisplayViews, RouteData} from '@medux/core/types/export';\nimport {compilePath, compileToPath, matchPath} from './matchPath';\n\nimport assignDeep from 'deep-extend';\nimport {config as coreConfig} from '@medux/core';\n\nconst config = {\n  escape: true,\n  dateParse: true,\n  splitKey: 'q',\n  defaultRouteParams: {},\n};\nexport function setRouteConfig(conf: {escape?: boolean; dateParse?: boolean; splitKey?: string; defaultRouteParams?: {[moduleName: string]: any}}) {\n  conf.escape !== undefined && (config.escape = conf.escape);\n  conf.dateParse !== undefined && (config.dateParse = conf.dateParse);\n  conf.splitKey && (config.splitKey = conf.splitKey);\n  conf.defaultRouteParams && (config.defaultRouteParams = conf.defaultRouteParams);\n}\n\nexport interface Location {\n  pathname: string;\n  search: string;\n  hash: string;\n}\n\nexport type RouteToLocation = (routeData: RouteData) => Location;\nexport type LocationToRoute = (location: Location) => RouteData;\n\nexport interface TransformRoute {\n  locationToRoute: LocationToRoute;\n  routeToLocation: RouteToLocation;\n}\n\n// 排除默认路由参数，路由中如果参数值与默认参数相同可省去\nfunction excludeDefaultData(data: {[moduleName: string]: any}, def: {[moduleName: string]: any}, holde: boolean, views?: {[moduleName: string]: any}) {\n  const result: any = {};\n  Object.keys(data).forEach(moduleName => {\n    let value = data[moduleName];\n    const defaultValue = def[moduleName];\n    if (value !== defaultValue) {\n      if (typeof value === typeof defaultValue && typeof value === 'object' && !Array.isArray(value)) {\n        value = excludeDefaultData(value, defaultValue, !!views && !views[moduleName]);\n      }\n      if (value !== undefined) {\n        result[moduleName] = value;\n      }\n    }\n  });\n\n  if (Object.keys(result).length === 0 && !holde) {\n    return undefined;\n  }\n  return result;\n}\n\n// 合并默认路由参数，如果路由中某参数没传，将用默认值替代，与上面方法互逆\n// function mergeDefaultData(data: {[moduleName: string]: any}, views: {[moduleName: string]: any}) {\n//   Object.keys(views).forEach(moduleName => {\n//     if (!data[moduleName]) {\n//       data[moduleName] = {};\n//     }\n//   });\n//   Object.keys(data).forEach(moduleName => {\n//     data[moduleName] = assignDeep({}, defaultRouteParams[moduleName], data[moduleName]);\n//   });\n// }\n\n// export const mergeDefaultParamsMiddleware: Middleware = () => (next: Function) => (action: any) => {\n//   if (action.type === ActionTypes.F_ROUTE_CHANGE) {\n//     const payload = getActionData<RouteState>(action);\n//     const params = mergeDefaultData(payload.data.views, payload.data.params, defaultRouteParams);\n//     action = {...action, payload: {...payload, data: {...payload.data, params}}};\n//   }\n//   return next(action);\n// };\n\nexport interface RouteConfig {\n  [path: string]: string | [string, RouteConfig];\n}\n\nconst ISO_DATE_FORMAT = /^\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d(\\.\\d+)?(Z|[+-][01]\\d:[0-5]\\d)$/;\n\nfunction dateParse(prop: any, value: any) {\n  if (typeof value === 'string' && ISO_DATE_FORMAT.test(value)) {\n    return new Date(value);\n  }\n  return value;\n}\n// function getSearch(searchOrHash: string, key: string): string {\n//   if (searchOrHash.length < 4) {\n//     return '';\n//   }\n//   const reg = new RegExp(`[&?#]${key}=`);\n//   const str = searchOrHash.split(reg)[1];\n//   if (!str) {\n//     return '';\n//   }\n//   return str.split('&')[0];\n// }\n\n/*\n  将字符串变成 Data，因为 JSON 中没有 Date 类型，所以用正则表达式匹配自动转换\n*/\nfunction searchParse(search: string): {[moduleName: string]: {[key: string]: any} | undefined} {\n  if (!search) {\n    return {};\n  }\n  if (config.escape) {\n    search = unescape(search);\n  }\n  try {\n    return JSON.parse(search, config.dateParse ? dateParse : undefined);\n  } catch (error) {\n    return {};\n  }\n}\nfunction joinSearchString(arr: string[]): string {\n  const strs = [''];\n  for (let i = 0, k = arr.length; i < k; i++) {\n    strs.push(arr[i] || '');\n  }\n  return strs.join(`&${config.splitKey}=`);\n}\nfunction searchStringify(searchData: any): string {\n  if (typeof searchData !== 'object') {\n    return '';\n  }\n  const str = JSON.stringify(searchData);\n  if (str === '{}') {\n    return '';\n  }\n  if (config.escape) {\n    return escape(str);\n  } else {\n    return str;\n  }\n}\n\nfunction splitSearch(search: string) {\n  const reg = new RegExp(`[&?#]${config.splitKey}=[^&]*`, 'g');\n  const arr = search.match(reg);\n  let stackParams: {[moduleName: string]: {[key: string]: any} | undefined}[] = [];\n  if (arr) {\n    stackParams = arr.map(str => {\n      return searchParse(str.split('=')[1]);\n    });\n  }\n  return stackParams;\n}\nfunction checkPathArgs(params: {[key: string]: string}): {[key: string]: any} {\n  const obj = {};\n  for (const key in params) {\n    if (params.hasOwnProperty(key)) {\n      const val = params[key];\n      const props = key.split('.');\n      if (props.length > 1) {\n        props.reduce((prev, cur, index, arr) => {\n          if (index === arr.length - 1) {\n            prev[cur] = val;\n          } else {\n            prev[cur] = {};\n          }\n          return prev[cur];\n        }, obj);\n      } else {\n        obj[key] = val;\n      }\n    }\n  }\n  return obj;\n}\nfunction pathnameParse(pathname: string, routeConfig: RouteConfig, paths: string[], args: {[moduleName: string]: {[key: string]: any} | undefined}) {\n  for (const rule in routeConfig) {\n    if (routeConfig.hasOwnProperty(rule)) {\n      const item = routeConfig[rule];\n      const [viewName, pathConfig] = typeof item === 'string' ? [item, null] : item;\n      const match = matchPath(pathname, {path: rule, exact: !pathConfig});\n      // const match = matchPath(pathname, {path: rule.replace(/\\$$/, ''), exact: rule.endsWith('$')});\n      if (match) {\n        paths.push(viewName);\n        const moduleName = viewName.split(coreConfig.VSP)[0];\n        const {params} = match;\n        if (params && Object.keys(params).length > 0) {\n          args[moduleName] = {...args[moduleName], ...checkPathArgs(params)};\n        }\n        if (pathConfig) {\n          pathnameParse(pathname, pathConfig, paths, args);\n        }\n        return;\n      }\n    }\n  }\n}\n\nfunction compileConfig(routeConfig: RouteConfig, parentAbsoluteViewName: string = '', viewToRule: {[viewName: string]: string} = {}, ruleToKeys: {[rule: string]: (string | number)[]} = {}) {\n  // ruleToKeys将每条rule中的params key解析出来\n  for (const rule in routeConfig) {\n    if (routeConfig.hasOwnProperty(rule)) {\n      if (!ruleToKeys[rule]) {\n        const {keys} = compilePath(rule, {end: true, strict: false, sensitive: false});\n        ruleToKeys[rule] = keys.reduce((prev: (string | number)[], cur) => {\n          prev.push(cur.name);\n          return prev;\n        }, []);\n      }\n      const item = routeConfig[rule];\n      const [viewName, pathConfig] = typeof item === 'string' ? [item, null] : item;\n      const absoluteViewName = parentAbsoluteViewName + '/' + viewName;\n      viewToRule[absoluteViewName] = rule;\n      if (pathConfig) {\n        compileConfig(pathConfig, absoluteViewName, viewToRule, ruleToKeys);\n      }\n    }\n  }\n  return {viewToRule, ruleToKeys};\n}\ntype DeepPartial<T> = {[P in keyof T]?: DeepPartial<T[P]>};\n\n// type Params = RouteData['params'];\n\nexport interface RoutePayload<P> {\n  extend?: RouteData;\n  stackParams?: DeepPartial<P>[];\n  paths?: string[];\n}\n\nfunction assignRouteData(paths: string[], stackParams: {[moduleName: string]: any}[], args?: {[moduleName: string]: any}): RouteData {\n  if (!stackParams[0]) {\n    stackParams[0] = {};\n  }\n  if (args) {\n    stackParams[0] = assignDeep({}, args, stackParams[0]);\n  }\n  const firstStackParams = stackParams[0];\n  const views: DisplayViews = paths.reduce((prev: DisplayViews, cur) => {\n    const [moduleName, viewName] = cur.split(coreConfig.VSP);\n    if (viewName) {\n      if (!prev[moduleName]) {\n        prev[moduleName] = {};\n      }\n      prev[moduleName]![viewName] = true;\n      if (!firstStackParams[moduleName]) {\n        firstStackParams[moduleName] = {};\n      }\n    }\n    return prev;\n  }, {});\n  Object.keys(firstStackParams).forEach(moduleName => {\n    firstStackParams[moduleName] = assignDeep({}, config.defaultRouteParams[moduleName], firstStackParams[moduleName]);\n  });\n  const params = assignDeep({}, ...stackParams);\n  Object.keys(params).forEach(moduleName => {\n    if (!firstStackParams[moduleName]) {\n      params[moduleName] = assignDeep({}, config.defaultRouteParams[moduleName], params[moduleName]);\n    }\n  });\n  return {views, paths, params, stackParams};\n}\n\nexport function fillRouteData<R>(routePayload: RoutePayload<R>): RouteData {\n  const extend: RouteData = routePayload.extend || {views: {}, paths: [], stackParams: [], params: {}};\n  const stackParams = [...extend.stackParams];\n  if (routePayload.stackParams) {\n    routePayload.stackParams.forEach((item, index) => {\n      if (item) {\n        stackParams[index] = assignDeep({}, stackParams[index], item);\n      }\n    });\n  }\n  return assignRouteData(routePayload.paths || extend.paths, stackParams);\n}\nfunction extractHashData(params: {[moduleName: string]: any}) {\n  const searchParams: {[moduleName: string]: any} = {};\n  const hashParams: {[moduleName: string]: any} = {};\n  for (const moduleName in params) {\n    if (params[moduleName] && params.hasOwnProperty(moduleName)) {\n      const data = params[moduleName]!;\n      const keys = Object.keys(data);\n      if (keys.length > 0) {\n        keys.forEach(key => {\n          if (key.startsWith('_')) {\n            if (!hashParams[moduleName]) {\n              hashParams[moduleName] = {};\n            }\n            hashParams[moduleName][key] = data[key];\n          } else {\n            if (!searchParams[moduleName]) {\n              searchParams[moduleName] = {};\n            }\n            searchParams[moduleName][key] = data[key];\n          }\n        });\n      } else {\n        searchParams[moduleName] = {};\n      }\n    }\n  }\n  return {\n    search: searchStringify(searchParams),\n    hash: searchStringify(hashParams),\n  };\n}\nexport function buildTransformRoute(routeConfig: RouteConfig): TransformRoute {\n  const {viewToRule, ruleToKeys} = compileConfig(routeConfig);\n\n  const locationToRoute: LocationToRoute = location => {\n    const paths: string[] = [];\n    const pathsArgs: {[moduleName: string]: {[key: string]: any}} = {};\n    pathnameParse(location.pathname, routeConfig, paths, pathsArgs);\n    const stackParams = splitSearch(location.search);\n    const hashStackParams = splitSearch(location.hash);\n    hashStackParams.forEach((item, index) => {\n      if (item) {\n        if (!stackParams[index]) {\n          stackParams[index] = {};\n        }\n        assignDeep(stackParams[index], item);\n      }\n    });\n    return assignRouteData(paths, stackParams, pathsArgs);\n  };\n  const routeToLocation: RouteToLocation = routeData => {\n    const {views, paths, params, stackParams} = routeData;\n    const firstStackParams = stackParams[0];\n    let pathname = '';\n    let firstStackParamsFilter: {[moduleName: string]: {[key: string]: any} | undefined};\n    if (paths.length > 0) {\n      // 将args深克隆，因为后面可能会删除path中使用到的变量\n      firstStackParamsFilter = assignDeep({}, firstStackParams);\n      paths.reduce((parentAbsoluteViewName, viewName, index) => {\n        const absoluteViewName = parentAbsoluteViewName + '/' + viewName;\n        const rule = viewToRule[absoluteViewName];\n        const moduleName = viewName.split(coreConfig.VSP)[0];\n        //最深的一个view可以决定pathname\n        if (index === paths.length - 1) {\n          // const toPath = compileToPath(rule.replace(/\\$$/, ''));\n          const toPath = compileToPath(rule);\n          const keys = ruleToKeys[rule] || [];\n          const args = keys.reduce((prev, cur) => {\n            if (typeof cur === 'string') {\n              const props = cur.split('.');\n              if (props.length) {\n                prev[cur] = props.reduce((p, c) => {\n                  return p[c];\n                }, params[moduleName]!);\n                return prev;\n              }\n            }\n            prev[cur] = params[moduleName]![cur];\n            return prev;\n          }, {});\n          pathname = toPath(args);\n        }\n        //pathname中传递的值可以不在params中重复传递\n        const keys = ruleToKeys[rule] || [];\n        keys.forEach(key => {\n          if (typeof key === 'string') {\n            const props = key.split('.');\n            if (props.length) {\n              props.reduce((p, c, i) => {\n                if (i === props.length - 1) {\n                  delete p[c];\n                }\n                return p[c] || {};\n              }, firstStackParamsFilter[moduleName] || {});\n              return;\n            }\n          }\n          if (firstStackParamsFilter[moduleName]) {\n            delete firstStackParamsFilter[moduleName]![key];\n          }\n        });\n        return absoluteViewName;\n      }, '');\n    } else {\n      firstStackParamsFilter = firstStackParams;\n    }\n    //将带_前缀的变量放到hashData中\n    const arr = [...stackParams];\n    arr[0] = excludeDefaultData(firstStackParamsFilter, config.defaultRouteParams, false, views);\n    const searchStrings: string[] = [];\n    const hashStrings: string[] = [];\n    arr.forEach((params, index) => {\n      const {search, hash} = extractHashData(params);\n      search && (searchStrings[index] = search);\n      hash && (hashStrings[index] = hash);\n    });\n\n    return {\n      pathname,\n      search: '?' + joinSearchString(searchStrings).substr(1),\n      hash: '#' + joinSearchString(hashStrings).substr(1),\n    };\n  };\n  return {\n    locationToRoute,\n    routeToLocation,\n  };\n}\n\nexport interface BrowserRoutePayload<P> {\n  extend?: RouteData;\n  params?: DeepPartial<P>;\n  paths?: string[];\n}\nexport function fillBrowserRouteData<R>(routePayload: BrowserRoutePayload<R>): RouteData {\n  const extend: RouteData = routePayload.extend || {views: {}, paths: [], stackParams: [], params: {}};\n  const stackParams = [...extend.stackParams];\n  if (routePayload.params) {\n    stackParams[0] = assignDeep({}, stackParams[0], routePayload.params);\n  }\n  return assignRouteData(routePayload.paths || extend.paths, stackParams);\n}\n\nexport interface BrowserHistoryActions<P = RouteData> {\n  push(data: P | Location | string): void;\n  replace(data: P | Location | string): void;\n  go(n: number): void;\n  goBack(): void;\n  goForward(): void;\n}\nfunction isBrowserRoutePayload(data: string | Location | BrowserRoutePayload<any>): data is BrowserRoutePayload<any> {\n  return typeof data !== 'string' && !data['pathname'];\n}\nexport function getBrowserRouteActions<T>(getBrowserHistoryActions: () => BrowserHistoryActions<RouteData>): BrowserHistoryActions<BrowserRoutePayload<T>> {\n  return {\n    push(data) {\n      let args = data as any;\n      if (isBrowserRoutePayload(data)) {\n        args = fillBrowserRouteData(data);\n      }\n      getBrowserHistoryActions().push(args);\n    },\n    replace(data) {\n      let args = data as any;\n      if (isBrowserRoutePayload(data)) {\n        args = fillBrowserRouteData(data);\n      }\n      getBrowserHistoryActions().replace(args);\n    },\n    go(n) {\n      getBrowserHistoryActions().go(n);\n    },\n    goBack() {\n      getBrowserHistoryActions().goBack();\n    },\n    goForward() {\n      getBrowserHistoryActions().goForward();\n    },\n  };\n}\nexport interface ToBrowserUrl<T> {\n  (routeOptions: BrowserRoutePayload<T>): string;\n  (pathname: string, search: string, hash: string): string;\n}\nexport function buildToBrowserUrl(getTransformRoute: () => TransformRoute): ToBrowserUrl<any> {\n  function toUrl(routeOptions: BrowserRoutePayload<any>): string;\n  function toUrl(pathname: string, search: string, hash: string): string;\n  function toUrl(...args: any[]): string {\n    if (args.length === 1) {\n      const location = getTransformRoute().routeToLocation(fillBrowserRouteData(args[0]));\n      args = [location.pathname, location.search, location.hash];\n    }\n    const [pathname, search, hash] = args as [string, string, string];\n    let url = pathname;\n    if (search) {\n      url += search;\n    }\n    if (hash) {\n      url += hash;\n    }\n    return url;\n  }\n  return toUrl;\n}\n\n// export function buildTransformRoute(routeConfig: RouteConfig): TransformRoute {\n//   const {viewToRule, ruleToKeys} = compileConfig(routeConfig);\n//   const locationToRoute: LocationToRoute = location => {\n//     const paths: string[] = [];\n//     const {stackParams, params} = splitSearch(location.search);\n//     //算出paths，并将path参数提取出来并入searchParams中\n//     pathnameParse(location.pathname, routeConfig, paths, params);\n//     const views: DisplayViews = paths.reduce((prev: DisplayViews, cur) => {\n//       const [moduleName, viewName] = cur.split(coreConfig.VSP);\n//       if (viewName) {\n//         if (!prev[moduleName]) {\n//           prev[moduleName] = {};\n//         }\n//         prev[moduleName]![viewName] = true;\n//       }\n//       return prev;\n//     }, {});\n//     const {stackParams: hashStackParams, params: hashParams} = splitSearch(location.hash);\n//     //将hash参数并入params中\n//     assignDeep(params, hashParams);\n//     hashStackParams.forEach((item, index) => {\n//       item && assignDeep(stackParams[index], item);\n//     });\n//     mergeDefaultData(params, views);\n//     return {paths, params, views, stackParams};\n//   };\n//   const routeToLocation: RouteToLocation = routeData => {\n//     const {paths, params, stackParams} = routeData;\n//     const mainStackParams = stackParams[0] || {};\n//     let pathname = '';\n//     let args: {[moduleName: string]: {[key: string]: any} | undefined};\n//     if (paths.length > 0) {\n//       args = {};\n//       // 将args二层克隆params，因为后面可能会删除path中使用到的变量\n//       for (const moduleName in mainStackParams) {\n//         if (mainStackParams[moduleName] && mainStackParams.hasOwnProperty(moduleName)) {\n//           args[moduleName] = {...mainStackParams[moduleName]};\n//         }\n//       }\n//       paths.reduce((parentAbsoluteViewName, viewName, index) => {\n//         const absoluteViewName = parentAbsoluteViewName + '/' + viewName;\n//         const rule = viewToRule[absoluteViewName];\n//         const moduleName = viewName.split(coreConfig.VSP)[0];\n//         //最深的一个view可以决定pathname\n//         if (index === paths.length - 1) {\n//           // const toPath = compileToPath(rule.replace(/\\$$/, ''));\n//           const toPath = compileToPath(rule);\n//           pathname = toPath(params[moduleName]);\n//         }\n//         //pathname中传递的值可以不在params中重复传递\n//         const keys = ruleToKeys[rule] || [];\n//         keys.forEach(key => {\n//           if (args[moduleName]) {\n//             delete args[moduleName]![key];\n//           }\n//         });\n//         return absoluteViewName;\n//       }, '');\n//     } else {\n//       args = mainStackParams;\n//     }\n//     //将带_前缀的变量放到hashData中\n//     const searchData = {};\n//     const hashData = {};\n//     for (const moduleName in args) {\n//       if (args[moduleName] && args.hasOwnProperty(moduleName)) {\n//         const data = args[moduleName]!;\n//         const keys = Object.keys(data);\n//         if (keys.length > 0) {\n//           keys.forEach(key => {\n//             if (key.startsWith('_')) {\n//               if (!hashData[moduleName]) {\n//                 hashData[moduleName] = {};\n//               }\n//               hashData[moduleName][key] = data[key];\n//             } else {\n//               if (!searchData[moduleName]) {\n//                 searchData[moduleName] = {};\n//               }\n//               searchData[moduleName][key] = data[key];\n//             }\n//           });\n//         }\n//       }\n//     }\n//     return {\n//       pathname,\n//       search: searchStringify(excludeDefaultData(searchData, defaultRouteParams)),\n//       hash: searchStringify(excludeDefaultData(hashData, defaultRouteParams)),\n//     };\n//   };\n//   return {\n//     locationToRoute,\n//     routeToLocation,\n//   };\n// }\n\n/**\n '/:articleType/:articleId/comments/:itemId'\n www.aa.com/photos/1/comments/23?p={}&p=\n\n paths:[\"app.Main\", \"photos.detail\", \"comments.detail\"]\n params:{app:{},photos:{itemid:1,searchList:{page:1,pageSize:10},_listkey:222222},comments:{articleType:photos,articleId:1,itemid:23,searchList:{page:2,pageSize:10},_listkey:222222}}\n stackParams:[{app:{}}, {photos:{itemid:1,searchList:{page:1,pageSize:10},_listkey:222222}}, {comments:{articleType:photos,articleId:1,itemid:23,searchList:{page:2,pageSize:10},_listkey:222222}}]\n stackParams:[{app:{},photos:{itemid:1,searchList:{page:1,pageSize:10},_listkey:222222},comments:{articleType:photos,articleId:1,itemid:23,searchList:{page:2,pageSize:10},_listkey:222222}}]\n\n web: www.aa.com/photos/1/comments/23?p={comments:{searchList:{page:2}}}#p={photos:{_listkey:222222}, comments:{_listkey:222222}}\n\n rn: www.aa.com/photos/1/comments/23?p={app:{}}&p={photos:{}}&p={comments:{searchList:{page:2}}}#p={}&p={photos:{_listkey:222222}}&p={comments:{_listkey:222222}}\n\n routeData -> location\n1.根据paths得到匹配表达式：'/:articleType/:articleId/comments/:itemId'\n2.根据params填充表达式得到：www.aa.com/photos/1/comments/23\n3.将params中带_的提取为hash\n不作缩减将得到：\nwww.aa.com/photos/1/comments/23?\np={app:{}}&\np={photos:{itemid:1,searchList:{page:1,pageSize:10}}}&\np={comments:{articleType:photos,articleId:1,itemid:23,searchList:{page:2,pageSize:10}}}\n#\np={}&\np={photos:{_listkey:222222}}\np={comments:{_listkey:222222}}\n4.缩\b减默认值：\nwww.aa.com/photos/1/comments/23?\np={app:{}}&\np={photos:{itemid:1}}&\np={comments:{articleType:photos,articleId:1,itemid:23,searchList:{page:2}}}\n#\np={}&\np={photos:{_listkey:222222}}\np={comments:{_listkey:222222}}\n5.缩减路径传参\nwww.aa.com/photos/1/comments/23?\np={app:{}}&\np={photos:{}}&\np={comments:{searchList:{page:2}}}\n#\np={}&\np={photos:{_listkey:222222}}\np={comments:{_listkey:222222}}\n\n\n\n location->routeData\n1.解析出paths、views、pathArgs\n2.\n\n */\n"],"file":"index.js"}