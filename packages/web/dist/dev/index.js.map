{"version":3,"sources":["../../src/index.ts"],"names":["createBrowserHistory","createMemoryHistory","isServer","isLocation","data","BrowserHistoryProxy","history","locationToRoute","getLocation","location","subscribe","listener","listen","locationToRouteData","state","equal","a","b","pathname","search","hash","patch","routeData","push","BrowserHistoryActions","routeToLocation","views","paths","reduce","prev","cur","split","moduleName","viewName","replace","go","n","goBack","goForward","createHistory","options","historyProxy","historyActions"],"mappings":"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","sourcesContent":["import {BrowserHistoryBuildOptions, History, MemoryHistoryBuildOptions, createBrowserHistory, createMemoryHistory} from 'history';\nimport {DisplayViews, HistoryProxy, RouteData} from '@medux/core/types/export';\n\nimport {isServer} from '@medux/core';\n\ninterface Location {\n  pathname: string;\n  search: string;\n  hash: string;\n  state: RouteData;\n}\n\nexport interface BrowserLocation {\n  pathname: string;\n  search: string;\n  hash: string;\n}\n\nexport interface RoutePayload {\n  params: {[moduleName: string]: {[key: string]: any}};\n  paths: string[];\n}\nexport type RouteToLocation = (routeData: RoutePayload) => BrowserLocation;\nexport type LocationToRoute = (location: BrowserLocation) => RouteData;\n\nexport interface TransformRoute {\n  locationToRoute: LocationToRoute;\n  routeToLocation: RouteToLocation;\n}\n\nexport type BrowserHistoryOptions = BrowserHistoryBuildOptions & TransformRoute;\nexport type MemoryHistoryOptions = MemoryHistoryBuildOptions & TransformRoute;\nfunction isLocation(data: RoutePayload | BrowserLocation): data is Location {\n  return !data['params'] && !data['paths'];\n}\n\nexport interface HistoryActions {\n  push(data: RoutePayload | BrowserLocation | string): void;\n  replace(data: RoutePayload | BrowserLocation | string): void;\n  go(n: number): void;\n  goBack(): void;\n  goForward(): void;\n}\nclass BrowserHistoryProxy implements HistoryProxy<Location> {\n  public constructor(protected history: History, protected locationToRoute: LocationToRoute) {}\n  public getLocation() {\n    return this.history.location;\n  }\n  public subscribe(listener: (location: Location) => void) {\n    this.history.listen(listener);\n  }\n  public locationToRouteData(location: Location) {\n    return location.state || this.locationToRoute(location);\n  }\n  public equal(a: Location, b: Location) {\n    return a.pathname === b.pathname && a.search === b.search && a.hash === b.hash;\n  }\n  public patch(location: Location, routeData: RouteData): void {\n    this.history.push({...location, state: routeData});\n  }\n}\n\nclass BrowserHistoryActions implements HistoryActions {\n  public constructor(protected history: History, protected routeToLocation: RouteToLocation) {}\n  public push(data: RoutePayload | BrowserLocation | string): void {\n    if (typeof data === 'string') {\n      this.history.push(data);\n    } else if (isLocation(data)) {\n      this.history.push(data);\n    } else {\n      const routeData = data as RoutePayload;\n      const location = this.routeToLocation(routeData);\n      const views: DisplayViews = routeData.paths.reduce((prev: DisplayViews, cur) => {\n        const [moduleName, viewName] = cur.split('.');\n        if (viewName) {\n          if (!prev[moduleName]) {\n            prev[moduleName] = {};\n          }\n          prev[moduleName][viewName] = true;\n        }\n        return prev;\n      }, {});\n      this.history.push({...location, state: {...routeData, views}});\n    }\n  }\n  public replace(data: RoutePayload | BrowserLocation | string): void {\n    if (typeof data === 'string') {\n      this.history.replace(data);\n    } else if (isLocation(data)) {\n      this.history.push(data);\n    } else {\n      const location = this.routeToLocation(data as RoutePayload);\n      this.history.replace({...location, state: data});\n    }\n  }\n  public go(n: number) {\n    this.history.go(n);\n  }\n  public goBack() {\n    this.history.goBack();\n  }\n  public goForward() {\n    this.history.goForward();\n  }\n}\n\nexport function createHistory(options: BrowserHistoryOptions | MemoryHistoryOptions) {\n  const history = isServer() ? createMemoryHistory(options) : createBrowserHistory(options);\n  const historyProxy: HistoryProxy<Location> = new BrowserHistoryProxy(history, options.locationToRoute);\n  const historyActions: HistoryActions = new BrowserHistoryActions(history, options.routeToLocation);\n  return {\n    history,\n    historyProxy,\n    historyActions,\n  };\n}\n"],"file":"index.js"}