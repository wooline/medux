{"version":3,"sources":["../../src/index.ts"],"names":["ActionTypes","defaultRouteParams","getActionData","compilePath","compileToPath","matchPath","assignDeep","excludeDefaultData","data","def","result","Object","keys","forEach","key","value","defaultValue","Array","isArray","undefined","length","mergeDefaultData","views","newData","moduleName","mergeDefaultParamsMiddleware","next","action","type","F_ROUTE_CHANGE","payload","params","getSearch","searchOrHash","reg","RegExp","str","split","ISO_DATE_FORMAT","searchParse","search","JSON","parse","unescape","prop","test","Date","searchStringify","searchData","stringify","escape","pathnameParse","pathname","routeConfig","paths","args","rule","hasOwnProperty","item","viewName","pathConfig","match","path","exact","push","compileConfig","parentAbsoluteViewName","viewToRule","ruleToKeys","end","strict","sensitive","reduce","prev","cur","name","absoluteViewName","fillRouteData","routePayload","getRouteActions","getHistoryActions","replace","go","n","goBack","goForward","buildTransformRoute","locationToRoute","location","hashParams","hash","moduleParams","routeToLocation","routeData","index","toPath","hashData","startsWith"],"mappings":"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","sourcesContent":["import {ActionTypes, defaultRouteParams, getActionData} from '@medux/core';\nimport {DisplayViews, RouteData, RouteState} from '@medux/core/types/export';\nimport {HistoryActions, LocationToRoute, RouteToLocation, TransformRoute} from '@medux/web';\nimport {compilePath, compileToPath, matchPath} from './matchPath';\n\nimport {Middleware} from 'redux';\nimport assignDeep from 'deep-extend';\n\n// 排除默认路由参数，路由中如果参数值与默认参数相同可省去\nfunction excludeDefaultData(data: any, def: any) {\n  const result: any = {};\n  Object.keys(data).forEach(key => {\n    let value = data[key];\n    const defaultValue = def[key];\n    if (value !== defaultValue) {\n      if (typeof value === typeof defaultValue && typeof value === 'object' && !Array.isArray(value)) {\n        value = excludeDefaultData(value, defaultValue);\n      }\n      if (value !== undefined) {\n        result[key] = value;\n      }\n    }\n  });\n\n  if (Object.keys(result).length === 0) {\n    return undefined;\n  }\n  return result;\n}\n\n// 合并默认路由参数，如果路由中某参数没传，将用默认值替代，与上面方法互逆\nfunction mergeDefaultData(views: {[moduleName: string]: any}, data: any, def: any) {\n  const newData = {...data};\n  Object.keys(views).forEach(moduleName => {\n    if (!newData[moduleName] && def[moduleName]) {\n      newData[moduleName] = {};\n    }\n  });\n  Object.keys(newData).forEach(moduleName => {\n    if (def[moduleName]) {\n      newData[moduleName] = assignDeep({}, def[moduleName], newData[moduleName]);\n    }\n  });\n  return newData;\n}\n\nexport const mergeDefaultParamsMiddleware: Middleware = () => (next: Function) => (action: any) => {\n  if (action.type === ActionTypes.F_ROUTE_CHANGE) {\n    const payload = getActionData<RouteState>(action);\n    const params = mergeDefaultData(payload.data.views, payload.data.params, defaultRouteParams);\n    action = {...action, payload: {...payload, data: {...payload.data, params}}};\n  }\n  return next(action);\n};\nexport interface RouteConfig {\n  [path: string]: string | [string, RouteConfig];\n}\n\nfunction getSearch(searchOrHash: string, key: string): string {\n  if (searchOrHash.length < 4) {\n    return '';\n  }\n  const reg = new RegExp(`[&?]${key}=`);\n  const str = ('#' + searchOrHash).split(reg)[1];\n  if (!str) {\n    return '';\n  }\n  return str.split('&')[0];\n}\n\nconst ISO_DATE_FORMAT = /^\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d(\\.\\d+)?(Z|[+-][01]\\d:[0-5]\\d)$/;\n\n/*\n  将字符串变成 Data，因为 JSON 中没有 Date 类型，所以用正则表达式匹配自动转换\n*/\nfunction searchParse(search: string, key: string = 'q'): undefined | {[moduleName: string]: {[key: string]: any}} {\n  search = getSearch(search, key);\n  if (!search) {\n    return undefined;\n  }\n  return JSON.parse(unescape(search), (prop: any, value: any) => {\n    if (typeof value === 'string' && ISO_DATE_FORMAT.test(value)) {\n      return new Date(value);\n    }\n    return value;\n  });\n}\n\nfunction searchStringify(searchData: any, key: string = 'q'): string {\n  if (!searchData) {\n    return '';\n  }\n  const str = JSON.stringify(searchData);\n  if (!str || str === '{}') {\n    return '';\n  }\n  return `${key}=${escape(str)}`;\n}\nfunction pathnameParse(pathname: string, routeConfig: RouteConfig, paths: string[], args: {[moduleName: string]: {[key: string]: any}}) {\n  for (const rule in routeConfig) {\n    if (routeConfig.hasOwnProperty(rule)) {\n      const item = routeConfig[rule];\n      const [viewName, pathConfig] = typeof item === 'string' ? [item, null] : item;\n      const match = matchPath(pathname, {path: rule, exact: !pathConfig});\n      // const match = matchPath(pathname, {path: rule.replace(/\\$$/, ''), exact: rule.endsWith('$')});\n      if (match) {\n        paths.push(viewName);\n        const moduleName = viewName.split('.')[0];\n        const {params} = match;\n        if (params && Object.keys(params).length > 0) {\n          args[moduleName] = {...args[moduleName], ...params};\n        }\n        if (pathConfig) {\n          pathnameParse(pathname, pathConfig, paths, args);\n        }\n        return;\n      }\n    }\n  }\n}\n\nfunction compileConfig(routeConfig: RouteConfig, parentAbsoluteViewName: string = '', viewToRule: {[viewName: string]: string} = {}, ruleToKeys: {[rule: string]: (string | number)[]} = {}) {\n  // ruleToKeys将每条rule中的params key解析出来\n  for (const rule in routeConfig) {\n    if (routeConfig.hasOwnProperty(rule)) {\n      if (!ruleToKeys[rule]) {\n        const {keys} = compilePath(rule, {end: true, strict: false, sensitive: false});\n        ruleToKeys[rule] = keys.reduce((prev: (string | number)[], cur) => {\n          prev.push(cur.name);\n          return prev;\n        }, []);\n      }\n      const item = routeConfig[rule];\n      const [viewName, pathConfig] = typeof item === 'string' ? [item, null] : item;\n      const absoluteViewName = parentAbsoluteViewName + '/' + viewName;\n      viewToRule[absoluteViewName] = rule;\n      if (pathConfig) {\n        compileConfig(pathConfig, absoluteViewName, viewToRule, ruleToKeys);\n      }\n    }\n  }\n  return {viewToRule, ruleToKeys};\n}\n\ntype DeepPartial<T> = {[P in keyof T]?: DeepPartial<T[P]>};\n\ntype Params = RouteData['params'];\nexport interface RoutePayload<P extends Params = Params> {\n  params: DeepPartial<P>;\n  paths: string[];\n}\nexport function fillRouteData(routePayload: RoutePayload): RouteData {\n  const {paths} = routePayload;\n  const views: DisplayViews = routePayload.paths.reduce((prev: DisplayViews, cur) => {\n    const [moduleName, viewName] = cur.split('.');\n    if (viewName) {\n      if (!prev[moduleName]) {\n        prev[moduleName] = {};\n      }\n      prev[moduleName]![viewName] = true;\n    }\n    return prev;\n  }, {});\n  const params = mergeDefaultData(views, routePayload.params, defaultRouteParams);\n  return {views, paths, params};\n}\n\nexport function getRouteActions<T extends Params>(getHistoryActions: () => HistoryActions<RouteData>): HistoryActions<RoutePayload<T>> {\n  return {\n    push(data) {\n      let args = data as any;\n      if (typeof data !== 'string' && !data['pathname']) {\n        args = fillRouteData(data as RoutePayload);\n      }\n      getHistoryActions().push(args);\n    },\n    replace(data) {\n      let args = data as any;\n      if (typeof data !== 'string' && !data['pathname']) {\n        args = fillRouteData(data as RoutePayload);\n      }\n      getHistoryActions().replace(args);\n    },\n    go(n) {\n      getHistoryActions().go(n);\n    },\n    goBack() {\n      getHistoryActions().goBack();\n    },\n    goForward() {\n      getHistoryActions().goForward();\n    },\n  };\n}\n\nexport function buildTransformRoute(routeConfig: RouteConfig): TransformRoute {\n  const {viewToRule, ruleToKeys} = compileConfig(routeConfig);\n  const locationToRoute: LocationToRoute = location => {\n    const paths: string[] = [];\n    const params: {[moduleName: string]: {[key: string]: any}} = searchParse(location.search) || {};\n    pathnameParse(location.pathname, routeConfig, paths, params);\n    const views: DisplayViews = paths.reduce((prev: DisplayViews, cur) => {\n      const [moduleName, viewName] = cur.split('.');\n      if (viewName) {\n        if (!prev[moduleName]) {\n          prev[moduleName] = {};\n        }\n        prev[moduleName]![viewName] = true;\n      }\n      return prev;\n    }, {});\n    const hashParams: {[moduleName: string]: {[key: string]: any}} = searchParse(location.hash) || {};\n    for (const moduleName in hashParams) {\n      if (hashParams.hasOwnProperty(moduleName)) {\n        const moduleParams = hashParams[moduleName];\n        Object.keys(moduleParams).forEach(key => {\n          params[moduleName][key] = moduleParams[key];\n        });\n      }\n    }\n    return {paths, params, views};\n  };\n  const routeToLocation: RouteToLocation = routeData => {\n    const {paths, params} = routeData;\n    let pathname = '';\n    let args: {[moduleName: string]: {[key: string]: any} | undefined};\n    if (paths.length > 0) {\n      args = {};\n      // 将args二层克隆params，因为后面可能会删除path中使用到的变量\n      for (const moduleName in params) {\n        if (params[moduleName] && params.hasOwnProperty(moduleName)) {\n          args[moduleName] = {...params[moduleName]};\n        }\n      }\n      paths.reduce((parentAbsoluteViewName, viewName, index) => {\n        const absoluteViewName = parentAbsoluteViewName + '/' + viewName;\n        const rule = viewToRule[absoluteViewName];\n        const moduleName = viewName.split('.')[0];\n        //最深的一个view可以决定pathname\n        if (index === paths.length - 1) {\n          // const toPath = compileToPath(rule.replace(/\\$$/, ''));\n          const toPath = compileToPath(rule);\n          pathname = toPath(params[moduleName]);\n        }\n        //pathname中传递的值可以不在params中重复传递\n        const keys = ruleToKeys[rule] || [];\n        keys.forEach(key => {\n          if (args[moduleName]) {\n            delete args[moduleName]![key];\n          }\n        });\n        return absoluteViewName;\n      }, '');\n    } else {\n      args = params;\n    }\n    //将带_前缀的变量放到hashData中\n    const searchData = {};\n    const hashData = {};\n    for (const moduleName in args) {\n      if (args[moduleName] && args.hasOwnProperty(moduleName)) {\n        const data = args[moduleName]!;\n        const keys = Object.keys(data);\n        if (keys.length > 0) {\n          keys.forEach(key => {\n            if (key.startsWith('_')) {\n              if (!hashData[moduleName]) {\n                hashData[moduleName] = {};\n              }\n              hashData[moduleName][key] = data[key];\n            } else {\n              if (!searchData[moduleName]) {\n                searchData[moduleName] = {};\n              }\n              searchData[moduleName][key] = data[key];\n            }\n          });\n        }\n      }\n    }\n    return {\n      pathname,\n      search: searchStringify(excludeDefaultData(searchData, defaultRouteParams)),\n      hash: searchStringify(excludeDefaultData(hashData, defaultRouteParams)),\n    };\n  };\n  return {\n    locationToRoute,\n    routeToLocation,\n  };\n}\n"],"file":"index.js"}