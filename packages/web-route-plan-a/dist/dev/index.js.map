{"version":3,"sources":["../../src/index.ts"],"names":["ActionTypes","defaultRouteParams","compilePath","compileToPath","matchPath","assignDeep","excludeDefaultData","data","def","result","key","hasOwnProperty","value","defaultValue","Array","isArray","Object","keys","length","undefined","mergeDefaultData","views","newData","forEach","moduleName","getSearch","searchOrHash","reg","RegExp","str","split","ISO_DATE_FORMAT","searchParse","search","JSON","parse","unescape","prop","test","Date","searchStringify","searchData","stringify","escape","pathnameParse","pathname","routeConfig","path","args","rule","match","replace","exact","endsWith","item","viewName","pathConfig","push","params","compileConfig","viewToRule","ruleToKeys","end","strict","sensitive","reduce","prev","cur","name","buildLocationToRoute","locationToRoute","location","paths","hashParams","hash","moduleParams","routeToLocation","routeData","urls","toPath","url","hashData","startsWith","join","mergeDefaultParamsMiddleware","next","action","type","F_ROUTE_CHANGE","payload"],"mappings":"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","sourcesContent":["import {ActionTypes, defaultRouteParams} from '@medux/core';\nimport {BrowserLocation, TransformRoute} from '@medux/web';\nimport {DisplayViews, RouteData, RouteState} from '@medux/core/types/export';\nimport {compilePath, compileToPath, matchPath} from './matchPath';\n\nimport {Middleware} from 'redux';\nimport assignDeep from 'deep-extend';\n\n// 排除默认路由参数，路由中如果参数值与默认参数相同可省去\nfunction excludeDefaultData(data: any, def: any) {\n  const result: any = {};\n  for (const key in data) {\n    if (data.hasOwnProperty(key)) {\n      const value = data[key];\n      const defaultValue = def[key];\n      if (value !== defaultValue) {\n        if (typeof value === typeof defaultValue && typeof value === 'object' && !Array.isArray(value)) {\n          result[key] = excludeDefaultData(value, defaultValue);\n        } else {\n          result[key] = value;\n        }\n      }\n    }\n  }\n  if (Object.keys(result).length === 0) {\n    return undefined;\n  }\n  return result;\n}\n\n// 合并默认路由参数，如果路由中某参数没传，将用默认值替代，与上面方法互逆\nfunction mergeDefaultData(views: {[moduleName: string]: any}, data: any, def: any) {\n  const newData = {...data};\n  Object.keys(views).forEach(moduleName => {\n    if (!newData[moduleName]) {\n      newData[moduleName] = {};\n    }\n  });\n  Object.keys(newData).forEach(moduleName => {\n    if (def[moduleName]) {\n      newData[moduleName] = assignDeep({}, def[moduleName], data[moduleName]);\n    }\n  });\n  return newData;\n}\n\nexport interface RouteConfig {\n  [path: string]: string | [string, RouteConfig];\n}\n\nfunction getSearch(searchOrHash: string, key: string): string {\n  if (searchOrHash.length < 4) {\n    return '';\n  }\n  const reg = new RegExp(`[&?]${key}=`);\n  const str = ('#' + searchOrHash).split(reg)[1];\n  if (!str) {\n    return '';\n  }\n  return str.split('&')[0];\n}\n\nconst ISO_DATE_FORMAT = /^\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d(\\.\\d+)?(Z|[+-][01]\\d:[0-5]\\d)$/;\n\n/*\n  将字符串变成 Data，因为 JSON 中没有 Date 类型，所以用正则表达式匹配自动转换\n*/\nfunction searchParse(search: string, key: string = 'q'): undefined | {[moduleName: string]: {[key: string]: any}} {\n  search = getSearch(search, key);\n  if (!search) {\n    return undefined;\n  }\n  return JSON.parse(unescape(search), (prop: any, value: any) => {\n    if (typeof value === 'string' && ISO_DATE_FORMAT.test(value)) {\n      return new Date(value);\n    }\n    return value;\n  });\n}\n\nfunction searchStringify(searchData: any, key: string = 'q'): string {\n  if (!searchData) {\n    return '';\n  }\n  const str = JSON.stringify(searchData);\n  if (!str || str === '{}') {\n    return '';\n  }\n  return `${key}=${escape(str)}`;\n}\nfunction pathnameParse(pathname: string, routeConfig: RouteConfig, path: string[], args: {[moduleName: string]: {[key: string]: any}}) {\n  for (const rule in routeConfig) {\n    if (routeConfig.hasOwnProperty(rule)) {\n      const match = matchPath(pathname, {path: rule.replace(/\\$$/, ''), exact: rule.endsWith('$')});\n      if (match) {\n        const item = routeConfig[rule];\n        const [viewName, pathConfig] = typeof item === 'string' ? [item, null] : item;\n        path.push(viewName);\n        const moduleName = viewName.split('.')[0];\n        const {params} = match;\n        if (params && Object.keys(params).length > 0) {\n          args[moduleName] = {...args[moduleName], ...params};\n        }\n        if (pathConfig) {\n          pathnameParse(pathname, pathConfig, path, args);\n        }\n        return;\n      }\n    }\n  }\n}\n\nfunction compileConfig(routeConfig: RouteConfig, viewToRule: {[viewName: string]: string} = {}, ruleToKeys: {[rule: string]: (string | number)[]} = {}) {\n  for (const rule in routeConfig) {\n    if (routeConfig.hasOwnProperty(rule)) {\n      if (!ruleToKeys[rule]) {\n        const {keys} = compilePath(rule.replace(/\\$$/, ''), {end: rule.endsWith('$'), strict: false, sensitive: false});\n        ruleToKeys[rule] = keys.reduce((prev: (string | number)[], cur) => {\n          prev.push(cur.name);\n          return prev;\n        }, []);\n      }\n      const item = routeConfig[rule];\n      const [viewName, pathConfig] = typeof item === 'string' ? [item, null] : item;\n      viewToRule[viewName] = rule;\n      if (pathConfig) {\n        compileConfig(pathConfig, viewToRule, ruleToKeys);\n      }\n    }\n  }\n  return {viewToRule, ruleToKeys};\n}\n\nexport function buildLocationToRoute(routeConfig: RouteConfig): TransformRoute {\n  const {viewToRule, ruleToKeys} = compileConfig(routeConfig);\n  const locationToRoute: (location: BrowserLocation) => RouteData = location => {\n    const paths: string[] = [];\n    const params: {[moduleName: string]: {[key: string]: any}} = searchParse(location.search) || {};\n    pathnameParse(location.pathname, routeConfig, paths, params);\n    const views: DisplayViews = paths.reduce((prev: DisplayViews, cur) => {\n      const [moduleName, viewName] = cur.split('.');\n      if (viewName) {\n        if (!prev[moduleName]) {\n          prev[moduleName] = {};\n        }\n        prev[moduleName][viewName] = true;\n      }\n      return prev;\n    }, {});\n    const hashParams: {[moduleName: string]: {[key: string]: any}} = searchParse(location.hash) || {};\n    for (const moduleName in hashParams) {\n      if (hashParams.hasOwnProperty(moduleName)) {\n        const moduleParams = hashParams[moduleName];\n        Object.keys(moduleParams).forEach(key => {\n          params[moduleName][key] = moduleParams[key];\n        });\n      }\n    }\n    return {paths, params, views};\n  };\n  const routeToLocation: (routeData: RouteData) => BrowserLocation = routeData => {\n    const {paths, params} = routeData;\n    const urls: string[] = [];\n    const args: {[moduleName: string]: {[key: string]: any}} = {};\n    for (const moduleName in params) {\n      if (params.hasOwnProperty(moduleName)) {\n        args[moduleName] = {...params[moduleName]};\n      }\n    }\n    for (const viewName of paths) {\n      const rule = viewToRule[viewName];\n      const moduleName = viewName.split('.')[0];\n      const toPath = compileToPath(rule.replace(/\\$$/, ''));\n      const url = toPath(params[moduleName]);\n      urls.push(url);\n      const keys = ruleToKeys[rule] || [];\n      keys.forEach(key => {\n        delete args[moduleName][key];\n      });\n    }\n    const searchData = {};\n    const hashData = {};\n    for (const moduleName in args) {\n      if (args.hasOwnProperty(moduleName)) {\n        const data = args[moduleName];\n        const keys = Object.keys(data);\n        if (keys.length > 0) {\n          keys.forEach(key => {\n            if (key.startsWith('_')) {\n              if (!hashData[moduleName]) {\n                hashData[moduleName] = {};\n              }\n              hashData[moduleName][key] = data[key];\n            } else {\n              if (!searchData[moduleName]) {\n                searchData[moduleName] = {};\n              }\n              searchData[moduleName][key] = data[key];\n            }\n          });\n        }\n      }\n    }\n    return {\n      pathname: urls.join(''),\n      search: searchStringify(excludeDefaultData(searchData, defaultRouteParams)),\n      hash: searchStringify(excludeDefaultData(hashData, defaultRouteParams)),\n    };\n  };\n  return {\n    locationToRoute,\n    routeToLocation,\n  };\n}\n\nexport const mergeDefaultParamsMiddleware: Middleware = () => (next: Function) => (action: {type: string; payload: RouteState}) => {\n  if (action.type === ActionTypes.F_ROUTE_CHANGE) {\n    const {data} = action.payload;\n    data.params = mergeDefaultData(data.views, data.params, defaultRouteParams);\n  }\n  return next(action);\n};\n"],"file":"index.js"}