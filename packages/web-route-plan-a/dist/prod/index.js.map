{"version":3,"sources":["../../src/index.ts"],"names":["ActionTypes","VSP","defaultRouteParams","getActionData","compilePath","compileToPath","matchPath","assignDeep","excludeDefaultData","data","def","result","Object","keys","forEach","key","value","defaultValue","Array","isArray","length","mergeDefaultData","views","newData","moduleName","mergeDefaultParamsMiddleware","next","action","type","F_ROUTE_CHANGE","payload","params","getSearch","searchOrHash","reg","RegExp","str","split","ISO_DATE_FORMAT","searchParse","search","JSON","parse","unescape","prop","test","Date","searchStringify","searchData","stringify","escape","pathnameParse","pathname","routeConfig","paths","args","rule","hasOwnProperty","item","viewName","pathConfig","match","path","exact","push","compileConfig","parentAbsoluteViewName","viewToRule","ruleToKeys","end","strict","sensitive","reduce","prev","cur","name","absoluteViewName","fillRouteData","routePayload","extend","getRouteActions","getHistoryActions","replace","go","n","goBack","goForward","buildTransformRoute","locationToRoute","location","hashParams","hash","moduleParams","routeToLocation","routeData","index","toPath","hashData","startsWith"],"mappings":"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","sourcesContent":["import {ActionTypes, VSP, defaultRouteParams, getActionData} from '@medux/core';\nimport {DisplayViews, RouteData, RouteState} from '@medux/core/types/export';\nimport {HistoryActions, LocationToRoute, RouteToLocation, TransformRoute} from '@medux/web';\nimport {compilePath, compileToPath, matchPath} from './matchPath';\n\nimport {Middleware} from 'redux';\nimport assignDeep from 'deep-extend';\n\n// 排除默认路由参数，路由中如果参数值与默认参数相同可省去\nfunction excludeDefaultData(data: any, def: any) {\n  const result: any = {};\n  Object.keys(data).forEach(key => {\n    let value = data[key];\n    const defaultValue = def[key];\n    if (value !== defaultValue) {\n      if (typeof value === typeof defaultValue && typeof value === 'object' && !Array.isArray(value)) {\n        value = excludeDefaultData(value, defaultValue);\n      }\n      if (value !== undefined) {\n        result[key] = value;\n      }\n    }\n  });\n\n  if (Object.keys(result).length === 0) {\n    return undefined;\n  }\n  return result;\n}\n\n// 合并默认路由参数，如果路由中某参数没传，将用默认值替代，与上面方法互逆\nfunction mergeDefaultData(views: {[moduleName: string]: any}, data: any, def: any) {\n  const newData = {...data};\n  Object.keys(views).forEach(moduleName => {\n    if (!newData[moduleName] && def[moduleName]) {\n      newData[moduleName] = {};\n    }\n  });\n  Object.keys(newData).forEach(moduleName => {\n    if (def[moduleName]) {\n      newData[moduleName] = assignDeep({}, def[moduleName], newData[moduleName]);\n    }\n  });\n  return newData;\n}\n\nexport const mergeDefaultParamsMiddleware: Middleware = () => (next: Function) => (action: any) => {\n  if (action.type === ActionTypes.F_ROUTE_CHANGE) {\n    const payload = getActionData<RouteState>(action);\n    const params = mergeDefaultData(payload.data.views, payload.data.params, defaultRouteParams);\n    action = {...action, payload: {...payload, data: {...payload.data, params}}};\n  }\n  return next(action);\n};\nexport interface RouteConfig {\n  [path: string]: string | [string, RouteConfig];\n}\n\nfunction getSearch(searchOrHash: string, key: string): string {\n  if (searchOrHash.length < 4) {\n    return '';\n  }\n  const reg = new RegExp(`[&?]${key}=`);\n  const str = ('#' + searchOrHash).split(reg)[1];\n  if (!str) {\n    return '';\n  }\n  return str.split('&')[0];\n}\n\nconst ISO_DATE_FORMAT = /^\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d(\\.\\d+)?(Z|[+-][01]\\d:[0-5]\\d)$/;\n\n/*\n  将字符串变成 Data，因为 JSON 中没有 Date 类型，所以用正则表达式匹配自动转换\n*/\nfunction searchParse(search: string, key: string = 'q'): undefined | {[moduleName: string]: {[key: string]: any}} {\n  search = getSearch(search, key);\n  if (!search) {\n    return undefined;\n  }\n  return JSON.parse(unescape(search), (prop: any, value: any) => {\n    if (typeof value === 'string' && ISO_DATE_FORMAT.test(value)) {\n      return new Date(value);\n    }\n    return value;\n  });\n}\n\nfunction searchStringify(searchData: any, key: string = 'q'): string {\n  if (!searchData) {\n    return '';\n  }\n  const str = JSON.stringify(searchData);\n  if (!str || str === '{}') {\n    return '';\n  }\n  return `${key}=${escape(str)}`;\n}\nfunction pathnameParse(pathname: string, routeConfig: RouteConfig, paths: string[], args: {[moduleName: string]: {[key: string]: any}}) {\n  for (const rule in routeConfig) {\n    if (routeConfig.hasOwnProperty(rule)) {\n      const item = routeConfig[rule];\n      const [viewName, pathConfig] = typeof item === 'string' ? [item, null] : item;\n      const match = matchPath(pathname, {path: rule, exact: !pathConfig});\n      // const match = matchPath(pathname, {path: rule.replace(/\\$$/, ''), exact: rule.endsWith('$')});\n      if (match) {\n        paths.push(viewName);\n        const moduleName = viewName.split(VSP)[0];\n        const {params} = match;\n        if (params && Object.keys(params).length > 0) {\n          args[moduleName] = {...args[moduleName], ...params};\n        }\n        if (pathConfig) {\n          pathnameParse(pathname, pathConfig, paths, args);\n        }\n        return;\n      }\n    }\n  }\n}\n\nfunction compileConfig(routeConfig: RouteConfig, parentAbsoluteViewName: string = '', viewToRule: {[viewName: string]: string} = {}, ruleToKeys: {[rule: string]: (string | number)[]} = {}) {\n  // ruleToKeys将每条rule中的params key解析出来\n  for (const rule in routeConfig) {\n    if (routeConfig.hasOwnProperty(rule)) {\n      if (!ruleToKeys[rule]) {\n        const {keys} = compilePath(rule, {end: true, strict: false, sensitive: false});\n        ruleToKeys[rule] = keys.reduce((prev: (string | number)[], cur) => {\n          prev.push(cur.name);\n          return prev;\n        }, []);\n      }\n      const item = routeConfig[rule];\n      const [viewName, pathConfig] = typeof item === 'string' ? [item, null] : item;\n      const absoluteViewName = parentAbsoluteViewName + '/' + viewName;\n      viewToRule[absoluteViewName] = rule;\n      if (pathConfig) {\n        compileConfig(pathConfig, absoluteViewName, viewToRule, ruleToKeys);\n      }\n    }\n  }\n  return {viewToRule, ruleToKeys};\n}\n\ntype DeepPartial<T> = {[P in keyof T]?: DeepPartial<T[P]>};\n\ntype Params = RouteData['params'];\nexport interface RoutePayload<P extends Params = Params> {\n  extend?: RouteData;\n  params?: DeepPartial<P>;\n  paths?: string[];\n}\nexport function fillRouteData(routePayload: RoutePayload): RouteData {\n  const extend: RouteData = routePayload.extend || {views: {}, paths: [], params: defaultRouteParams};\n  const paths = routePayload.paths || extend.paths;\n  const views: DisplayViews = paths.reduce((prev: DisplayViews, cur) => {\n    const [moduleName, viewName] = cur.split(VSP);\n    if (viewName) {\n      if (!prev[moduleName]) {\n        prev[moduleName] = {};\n      }\n      prev[moduleName]![viewName] = true;\n    }\n    return prev;\n  }, {});\n  const params = mergeDefaultData(views, routePayload.params, extend.params);\n  return {views, paths, params};\n}\n\nexport function getRouteActions<T extends Params>(getHistoryActions: () => HistoryActions<RouteData>): HistoryActions<RoutePayload<T>> {\n  return {\n    push(data) {\n      let args = data as any;\n      if (typeof data !== 'string' && !data['pathname']) {\n        args = fillRouteData(data as RoutePayload);\n      }\n      getHistoryActions().push(args);\n    },\n    replace(data) {\n      let args = data as any;\n      if (typeof data !== 'string' && !data['pathname']) {\n        args = fillRouteData(data as RoutePayload);\n      }\n      getHistoryActions().replace(args);\n    },\n    go(n) {\n      getHistoryActions().go(n);\n    },\n    goBack() {\n      getHistoryActions().goBack();\n    },\n    goForward() {\n      getHistoryActions().goForward();\n    },\n  };\n}\n\nexport function buildTransformRoute(routeConfig: RouteConfig): TransformRoute {\n  const {viewToRule, ruleToKeys} = compileConfig(routeConfig);\n  const locationToRoute: LocationToRoute = location => {\n    const paths: string[] = [];\n    const params: {[moduleName: string]: {[key: string]: any}} = searchParse(location.search) || {};\n    pathnameParse(location.pathname, routeConfig, paths, params);\n    const views: DisplayViews = paths.reduce((prev: DisplayViews, cur) => {\n      const [moduleName, viewName] = cur.split(VSP);\n      if (viewName) {\n        if (!prev[moduleName]) {\n          prev[moduleName] = {};\n        }\n        prev[moduleName]![viewName] = true;\n      }\n      return prev;\n    }, {});\n    const hashParams: {[moduleName: string]: {[key: string]: any}} = searchParse(location.hash) || {};\n    for (const moduleName in hashParams) {\n      if (hashParams.hasOwnProperty(moduleName)) {\n        const moduleParams = hashParams[moduleName];\n        Object.keys(moduleParams).forEach(key => {\n          params[moduleName][key] = moduleParams[key];\n        });\n      }\n    }\n    return {paths, params, views};\n  };\n  const routeToLocation: RouteToLocation = routeData => {\n    const {paths, params} = routeData;\n    let pathname = '';\n    let args: {[moduleName: string]: {[key: string]: any} | undefined};\n    if (paths.length > 0) {\n      args = {};\n      // 将args二层克隆params，因为后面可能会删除path中使用到的变量\n      for (const moduleName in params) {\n        if (params[moduleName] && params.hasOwnProperty(moduleName)) {\n          args[moduleName] = {...params[moduleName]};\n        }\n      }\n      paths.reduce((parentAbsoluteViewName, viewName, index) => {\n        const absoluteViewName = parentAbsoluteViewName + '/' + viewName;\n        const rule = viewToRule[absoluteViewName];\n        const moduleName = viewName.split(VSP)[0];\n        //最深的一个view可以决定pathname\n        if (index === paths.length - 1) {\n          // const toPath = compileToPath(rule.replace(/\\$$/, ''));\n          const toPath = compileToPath(rule);\n          pathname = toPath(params[moduleName]);\n        }\n        //pathname中传递的值可以不在params中重复传递\n        const keys = ruleToKeys[rule] || [];\n        keys.forEach(key => {\n          if (args[moduleName]) {\n            delete args[moduleName]![key];\n          }\n        });\n        return absoluteViewName;\n      }, '');\n    } else {\n      args = params;\n    }\n    //将带_前缀的变量放到hashData中\n    const searchData = {};\n    const hashData = {};\n    for (const moduleName in args) {\n      if (args[moduleName] && args.hasOwnProperty(moduleName)) {\n        const data = args[moduleName]!;\n        const keys = Object.keys(data);\n        if (keys.length > 0) {\n          keys.forEach(key => {\n            if (key.startsWith('_')) {\n              if (!hashData[moduleName]) {\n                hashData[moduleName] = {};\n              }\n              hashData[moduleName][key] = data[key];\n            } else {\n              if (!searchData[moduleName]) {\n                searchData[moduleName] = {};\n              }\n              searchData[moduleName][key] = data[key];\n            }\n          });\n        }\n      }\n    }\n    return {\n      pathname,\n      search: searchStringify(excludeDefaultData(searchData, defaultRouteParams)),\n      hash: searchStringify(excludeDefaultData(hashData, defaultRouteParams)),\n    };\n  };\n  return {\n    locationToRoute,\n    routeToLocation,\n  };\n}\n"],"file":"index.js"}