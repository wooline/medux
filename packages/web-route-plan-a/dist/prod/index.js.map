{"version":3,"sources":["../../src/index.ts"],"names":["ActionTypes","NSP","defaultRouteParams","getActionData","routeCompleteAction","compilePath","compileToPath","matchPath","assignDeep","excludeDefaultData","data","def","result","key","hasOwnProperty","value","defaultValue","Array","isArray","Object","keys","length","mergeDefaultData","views","newData","forEach","moduleName","mergeDefaultParamsMiddleware","dispatch","getState","next","action","type","F_ROUTE_CHANGE","payload","route","locationInStore","location","pathname","search","hash","params","setTimeout","split","actionName","M_INIT","moduleParams","routeParams","getSearch","searchOrHash","reg","RegExp","str","ISO_DATE_FORMAT","searchParse","JSON","parse","unescape","prop","test","Date","searchStringify","searchData","stringify","escape","pathnameParse","routeConfig","paths","args","rule","match","path","replace","exact","endsWith","item","viewName","pathConfig","push","compileConfig","viewToRule","ruleToKeys","end","strict","sensitive","reduce","prev","cur","name","buildTransformRoute","locationToRoute","hashParams","routeToLocation","routeData","lastViewName","toPath","hashData","startsWith"],"mappings":"wyBAAA,OAAQA,WAAR,CAAqBC,GAArB,CAA0BC,kBAA1B,CAA8CC,aAA9C,CAA6DC,mBAA7D,KAAuF,aAAvF,CAGA,OAAQC,WAAR,CAAqBC,aAArB,CAAoCC,SAApC,KAAoD,aAApD,CAGA,MAAOC,CAAAA,UAAP,KAAuB,aAAvB,CAEA;AACA,QAASC,CAAAA,kBAAT,CAA4BC,CAA5B,CAAuCC,CAAvC,CAAiD,CAC/C,GAAMC,CAAAA,CAAW,CAAG,EAApB,CACA,IAAK,GAAMC,CAAAA,CAAX,GAAkBH,CAAAA,CAAlB,CACE,GAAIA,CAAI,CAACI,cAAL,CAAoBD,CAApB,CAAJ,CAA8B,IACtBE,CAAAA,CAAK,CAAGL,CAAI,CAACG,CAAD,CADU,CAEtBG,CAAY,CAAGL,CAAG,CAACE,CAAD,CAFI,CAGxBE,CAAK,GAAKC,CAHc,GAItB,MAAOD,CAAAA,CAAP,EAAiB,MAAOC,CAAAA,CAAxB,EAAyD,QAAjB,QAAOD,CAAAA,CAA/C,EAAsEE,KAAK,CAACC,OAAN,CAAcH,CAAd,CAJhD,CAOxBH,CAAM,CAACC,CAAD,CAAN,CAAcE,CAPU,CAKxBH,CAAM,CAACC,CAAD,CAAN,CAAcJ,kBAAkB,CAACM,CAAD,CAAQC,CAAR,CALR,CAU7B,CAb4C,MAeZ,EAA/B,GAAAG,MAAM,CAACC,IAAP,CAAYR,CAAZ,EAAoBS,MAfuB,QAkBxCT,CACR,CAED;AACA,QAASU,CAAAA,gBAAT,CAA0BC,CAA1B,CAA8Db,CAA9D,CAAyEC,CAAzE,CAAmF,CACjF,GAAMa,CAAAA,CAAO,kBAAOd,CAAP,CAAb,CAWA,MAVAS,CAAAA,MAAM,CAACC,IAAP,CAAYG,CAAZ,EAAmBE,OAAnB,CAA2B,SAAAC,CAAU,CAAI,CACnC,CAACF,CAAO,CAACE,CAAD,CAAR,EAAwBf,CAAG,CAACe,CAAD,CADQ,GAErCF,CAAO,CAACE,CAAD,CAAP,CAAsB,EAFe,CAIxC,CAJD,CAUA,CALAP,MAAM,CAACC,IAAP,CAAYI,CAAZ,EAAqBC,OAArB,CAA6B,SAAAC,CAAU,CAAI,CACrCf,CAAG,CAACe,CAAD,CADkC,GAEvCF,CAAO,CAACE,CAAD,CAAP,CAAsBlB,UAAU,CAAC,EAAD,CAAKG,CAAG,CAACe,CAAD,CAAR,CAAsBF,CAAO,CAACE,CAAD,CAA7B,CAFO,CAI1C,CAJD,CAKA,CAAOF,CACR,CAED,MAAO,IAAMG,CAAAA,4BAAwC,CAAG,eAAEC,CAAAA,CAAF,GAAEA,QAAF,CAAYC,CAAZ,GAAYA,QAAZ,OAA0B,UAACC,CAAD,QAAoB,UAACC,CAAD,CAAiB,CACrH,GAAIA,CAAM,CAACC,IAAP,GAAgBhC,WAAW,CAACiC,cAAhC,CAAgD,IACxCC,CAAAA,CAAO,CAAG/B,aAAa,CAAa4B,CAAb,CADiB,GAETF,CAAQ,EAFC,CAEvCM,CAFuC,GAEvCA,KAFuC,CAG9C,GAAIA,CAAJ,CAAW,IACHC,CAAAA,CAAe,CAAGD,CAAK,CAACE,QAAN,EAAkB,EADjC,CAEHA,CAAQ,CAAGH,CAAO,CAACG,QAAR,EAAoB,EAF5B,CAGT,GAAID,CAAe,CAACE,QAAhB,GAA6BD,CAAQ,CAACC,QAAtC,EAAkDF,CAAe,CAACG,MAAhB,GAA2BF,CAAQ,CAACE,MAAtF,EAAgGH,CAAe,CAACI,IAAhB,GAAyBH,CAAQ,CAACG,IAAtI,CACE,MAEH,CACD,GAAMC,CAAAA,CAAM,CAAGnB,gBAAgB,CAACY,CAAO,CAACxB,IAAR,CAAaa,KAAd,CAAqBW,CAAO,CAACxB,IAAR,CAAa+B,MAAlC,CAA0CvC,kBAA1C,CAA/B,CAGA,MAFA6B,CAAAA,CAAM,kBAAOA,CAAP,EAAeG,OAAO,kBAAMA,CAAN,EAAexB,IAAI,kBAAMwB,CAAO,CAACxB,IAAd,EAAoB+B,MAAM,CAANA,CAApB,EAAnB,EAAtB,EAEN,CADAC,UAAU,CAAC,iBAAMd,CAAAA,CAAQ,CAACxB,mBAAmB,EAApB,CAAd,CAAD,CAAwC,CAAxC,CACV,CAAO0B,CAAI,CAACC,CAAD,CACZ,CAfoH,MAgBlFA,CAAM,CAACC,IAAP,CAAYW,KAAZ,CAAkB1C,GAAlB,CAhBkF,CAgB5GyB,CAhB4G,MAgBhGkB,CAhBgG,MAiBnH,GAAIlB,CAAU,EAAIkB,CAAU,GAAK5C,WAAW,CAAC6C,MAA7C,CAAqD,SACdhB,CAAQ,EADM,CAC5CM,CAD4C,GAC5CA,KAD4C,CAE7CM,CAAM,CAAGN,CAAK,CAACzB,IAAN,CAAW+B,MAAX,EAAqB,EAFe,CAG7CK,CAAY,CAAGL,CAAM,CAACf,CAAD,CAHwB,CAI7CQ,CAAO,CAAG/B,aAAa,CAAiB4B,CAAjB,CAJsB,CAK7CgB,CAAW,CAAGzB,gBAAgB,SAAGI,CAAH,QAAuBoB,CAAvB,CAAqC5C,kBAArC,CAAhB,CAAyEwB,CAAzE,GAAwF,EALzD,CAQnD,MAFAK,CAAAA,CAAM,kBAAOA,CAAP,EAAeG,OAAO,kBAAMA,CAAN,EAAea,WAAW,CAAXA,CAAf,EAAtB,EAEN,CADAL,UAAU,CAAC,iBAAMd,CAAAA,CAAQ,CAACxB,mBAAmB,EAApB,CAAd,CAAD,CAAwC,CAAxC,CACV,CAAO0B,CAAI,CAACC,CAAD,CACZ,CAEH,MAAOD,CAAAA,CAAI,CAACC,CAAD,CACZ,CA7BiF,CAA1B,CAAjD,CAkCP,QAASiB,CAAAA,SAAT,CAAmBC,CAAnB,CAAyCpC,CAAzC,CAA8D,CAC5D,GAA0B,CAAtB,CAAAoC,CAAY,CAAC5B,MAAjB,CACE,MAAO,EAAP,CAF0D,GAItD6B,CAAAA,CAAG,CAAG,GAAIC,CAAAA,MAAJ,QAAkBtC,CAAlB,KAJgD,CAKtDuC,CAAG,CAAG,CAAC,IAAMH,CAAP,EAAqBN,KAArB,CAA2BO,CAA3B,EAAgC,CAAhC,CALgD,OAMvDE,CAAAA,CANuD,CASrDA,CAAG,CAACT,KAAJ,CAAU,GAAV,EAAe,CAAf,CATqD,CAOnD,EAGV,CAED,GAAMU,CAAAA,eAAe,CAAG,8EAAxB,CAEA;;EAGA,QAASC,CAAAA,WAAT,CAAqBf,CAArB,CAAqC1B,CAArC,CAAkH,iBAA7EA,CAA6E,GAA7EA,CAA6E,CAA/D,GAA+D,EAChH0B,CAAM,CAAGS,SAAS,CAACT,CAAD,CAAS1B,CAAT,CAD8F,CAE3G0B,CAF2G,CAKzGgB,IAAI,CAACC,KAAL,CAAWC,QAAQ,CAAClB,CAAD,CAAnB,CAA6B,SAACmB,CAAD,CAAY3C,CAAZ,CAA2B,OACxC,QAAjB,QAAOA,CAAAA,CAAP,EAA6BsC,eAAe,CAACM,IAAhB,CAAqB5C,CAArB,CAD4B,CAEpD,GAAI6C,CAAAA,IAAJ,CAAS7C,CAAT,CAFoD,CAItDA,CACR,CALM,CALyG,OAWjH,CAED,QAAS8C,CAAAA,eAAT,CAAyBC,CAAzB,CAA0CjD,CAA1C,CAAqE,CACnE,YADwCA,CACxC,GADwCA,CACxC,CADsD,GACtD,EAAI,CAACiD,CAAL,CACE,MAAO,EAAP,CAEF,GAAMV,CAAAA,CAAG,CAAGG,IAAI,CAACQ,SAAL,CAAeD,CAAf,CAAZ,CAJmE,MAK9DV,CAAAA,CAAD,EAAgB,IAAR,GAAAA,CALuD,CAQzDvC,CARyD,KAQlDmD,MAAM,CAACZ,CAAD,CAR4C,CAM1D,EAGV,CACD,QAASa,CAAAA,aAAT,CAAuB3B,CAAvB,CAAyC4B,CAAzC,CAAmEC,CAAnE,CAAoFC,CAApF,CAAwI,CACtI,IAAK,GAAMC,CAAAA,CAAX,GAAmBH,CAAAA,CAAnB,CACE,GAAIA,CAAW,CAACpD,cAAZ,CAA2BuD,CAA3B,CAAJ,CAAsC,CACpC,GAAMC,CAAAA,CAAK,CAAG/D,SAAS,CAAC+B,CAAD,CAAW,CAACiC,IAAI,CAAEF,CAAI,CAACG,OAAL,CAAa,KAAb,CAAoB,EAApB,CAAP,CAAgCC,KAAK,CAAEJ,CAAI,CAACK,QAAL,CAAc,GAAd,CAAvC,CAAX,CAAvB,CACA,GAAIJ,CAAJ,CAAW,IACHK,CAAAA,CAAI,CAAGT,CAAW,CAACG,CAAD,CADf,GAEsC,QAAhB,QAAOM,CAAAA,CAAP,CAA2B,CAACA,CAAD,CAAO,IAAP,CAA3B,CAA0CA,CAFhE,CAEFC,CAFE,MAEQC,CAFR,MAGTV,CAAK,CAACW,IAAN,CAAWF,CAAX,CAHS,IAIHlD,CAAAA,CAAU,CAAGkD,CAAQ,CAACjC,KAAT,CAAe,GAAf,EAAoB,CAApB,CAJV,CAKFF,CALE,CAKQ6B,CALR,CAKF7B,MALE,CAYT,MANIA,CAAAA,CAAM,EAAiC,CAA7B,CAAAtB,MAAM,CAACC,IAAP,CAAYqB,CAAZ,EAAoBpB,MAMlC,GALE+C,CAAI,CAAC1C,CAAD,CAAJ,kBAAuB0C,CAAI,CAAC1C,CAAD,CAA3B,CAA4Ce,CAA5C,CAKF,OAHIoC,CAGJ,EAFEZ,aAAa,CAAC3B,CAAD,CAAWuC,CAAX,CAAuBV,CAAvB,CAA8BC,CAA9B,CAEf,CACD,CACF,CAEJ,CAED,QAASW,CAAAA,aAAT,CAAuBb,CAAvB,CAAiDc,CAAjD,CAAgGC,CAAhG,CAAwJ,CACtJ,IAAK,GAAMZ,CAAAA,CAAX,aAD+CW,CAC/C,GAD+CA,CAC/C,CAD0F,EAC1F,WAD8FC,CAC9F,GAD8FA,CAC9F,CADkJ,EAClJ,EAAmBf,CAAnB,CACE,GAAIA,CAAW,CAACpD,cAAZ,CAA2BuD,CAA3B,CAAJ,CAAsC,CACpC,GAAI,CAACY,CAAU,CAACZ,CAAD,CAAf,CAAuB,OACNhE,WAAW,CAACgE,CAAI,CAACG,OAAL,CAAa,KAAb,CAAoB,EAApB,CAAD,CAA0B,CAACU,GAAG,CAAEb,CAAI,CAACK,QAAL,CAAc,GAAd,CAAN,CAA0BS,MAAM,GAAhC,CAAyCC,SAAS,GAAlD,CAA1B,CADL,CACdhE,CADc,GACdA,IADc,CAErB6D,CAAU,CAACZ,CAAD,CAAV,CAAmBjD,CAAI,CAACiE,MAAL,CAAY,SAACC,CAAD,CAA4BC,CAA5B,CAAoC,CAEjE,MADAD,CAAAA,CAAI,CAACR,IAAL,CAAUS,CAAG,CAACC,IAAd,CACA,CAAOF,CACR,CAHkB,CAGhB,EAHgB,CAIpB,CAPmC,GAQ9BX,CAAAA,CAAI,CAAGT,CAAW,CAACG,CAAD,CARY,GASW,QAAhB,QAAOM,CAAAA,CAAP,CAA2B,CAACA,CAAD,CAAO,IAAP,CAA3B,CAA0CA,CATrC,CAS7BC,CAT6B,MASnBC,CATmB,MAUpCG,CAAU,CAACJ,CAAD,CAAV,CAAuBP,CAVa,CAWhCQ,CAXgC,EAYlCE,aAAa,CAACF,CAAD,CAAaG,CAAb,CAAyBC,CAAzB,CAEhB,CAEH,MAAO,CAACD,UAAU,CAAVA,CAAD,CAAaC,UAAU,CAAVA,CAAb,CACR,CAED,MAAO,SAASQ,CAAAA,mBAAT,CAA6BvB,CAA7B,CAAuE,OAC3Ca,aAAa,CAACb,CAAD,CAD8B,CACrEc,CADqE,GACrEA,UADqE,CACzDC,CADyD,GACzDA,UADyD,CAuF5E,MAAO,CACLS,eAAe,CAtFwB,QAAnCA,CAAAA,eAAmC,CAAArD,CAAQ,CAAI,IAC7C8B,CAAAA,CAAe,CAAG,EAD2B,CAE7C1B,CAAoD,CAAGa,WAAW,CAACjB,CAAQ,CAACE,MAAV,CAAX,EAAgC,EAF1C,CAGnD0B,aAAa,CAAC5B,CAAQ,CAACC,QAAV,CAAoB4B,CAApB,CAAiCC,CAAjC,CAAwC1B,CAAxC,CAHsC,IAI7ClB,CAAAA,CAAmB,CAAG4C,CAAK,CAACkB,MAAN,CAAa,SAACC,CAAD,CAAqBC,CAArB,CAA6B,OACrCA,CAAG,CAAC5C,KAAJ,CAAU,GAAV,CADqC,CAC7DjB,CAD6D,MACjDkD,CADiD,MAQpE,MANIA,CAAAA,CAMJ,GALM,CAACU,CAAI,CAAC5D,CAAD,CAKX,GAJI4D,CAAI,CAAC5D,CAAD,CAAJ,CAAmB,EAIvB,EAFE4D,CAAI,CAAC5D,CAAD,CAAJ,CAAiBkD,CAAjB,IAEF,EAAOU,CACR,CAT2B,CASzB,EATyB,CAJuB,CAc7CK,CAAwD,CAAGrC,WAAW,CAACjB,CAAQ,CAACG,IAAV,CAAX,EAA8B,EAd5C,YAexCd,CAfwC,EAgBjD,GAAIiE,CAAU,CAAC7E,cAAX,CAA0BY,CAA1B,CAAJ,CAA2C,CACzC,GAAMoB,CAAAA,CAAY,CAAG6C,CAAU,CAACjE,CAAD,CAA/B,CACAP,MAAM,CAACC,IAAP,CAAY0B,CAAZ,EAA0BrB,OAA1B,CAAkC,SAAAZ,CAAG,CAAI,CACvC4B,CAAM,CAACf,CAAD,CAAN,CAAmBb,CAAnB,EAA0BiC,CAAY,CAACjC,CAAD,CACvC,CAFD,CAGD,CArBgD,EAenD,IAAK,GAAMa,CAAAA,CAAX,GAAyBiE,CAAAA,CAAzB,GAAWjE,CAAX,EAQA,MAAO,CAACyC,KAAK,CAALA,CAAD,CAAQ1B,MAAM,CAANA,CAAR,CAAgBlB,KAAK,CAALA,CAAhB,CACR,CA6DM,CAELqE,eAAe,CA9DwB,QAAnCA,CAAAA,eAAmC,CAAAC,CAAS,CAAI,IAGhDzB,CAAAA,CAHgD,CAC7CD,CAD6C,CAC5B0B,CAD4B,CAC7C1B,KAD6C,CACtC1B,CADsC,CAC5BoD,CAD4B,CACtCpD,MADsC,CAEhDH,CAAQ,CAAG,EAFqC,CAIpD,GAAmB,CAAf,CAAA6B,CAAK,CAAC9C,MAAV,CAAsB,CAEpB;AACA,IAAK,GAAMK,CAAAA,CAAX,GAFA0C,CAAAA,CAAI,CAAG,EAEP,CAAyB3B,CAAzB,CACMA,CAAM,CAAC3B,cAAP,CAAsBY,CAAtB,CADN,GAEI0C,CAAI,CAAC1C,CAAD,CAAJ,kBAAuBe,CAAM,CAACf,CAAD,CAA7B,CAFJ,EAMA,OADMoE,CAAAA,CAAY,CAAG3B,CAAK,CAACA,CAAK,CAAC9C,MAAN,CAAe,CAAhB,CAC1B,+GAAWuD,CAAAA,CAAX,GACQP,CAAI,CAAGW,CAAU,CAACJ,CAAD,CADzB,CAEQlD,CAAU,CAAGkD,CAAQ,CAACjC,KAAT,CAAe,GAAf,EAAoB,CAApB,CAFrB,CAGE;AACA,GAAIiC,CAAQ,GAAKkB,CAAjB,CAA+B,CAC7B,GAAMC,CAAAA,CAAM,CAAGzF,aAAa,CAAC+D,CAAI,CAACG,OAAL,CAAa,KAAb,CAAoB,EAApB,CAAD,CAA5B,CACAlC,CAAQ,CAAGyD,CAAM,CAACtD,CAAM,CAACf,CAAD,CAAP,CAClB,CACD;AACA,GAAMN,CAAAA,CAAI,CAAG6D,CAAU,CAACZ,CAAD,CAAV,EAAoB,EAAjC,CACAjD,CAAI,CAACK,OAAL,CAAa,SAAAZ,CAAG,CAAI,CAClB,MAAOuD,CAAAA,CAAI,CAAC1C,CAAD,CAAJ,CAAiBb,CAAjB,CACR,CAFD,CAVF,IAAuBsD,CAAvB,qDAA8B,iCAa7B,CACF,CAvBD,IAwBEC,CAAAA,CAAI,CAAG3B,CAxBT,CA0BA;AA9BoD,GA+B9CqB,CAAAA,CAAU,CAAG,EA/BiC,CAgC9CkC,CAAQ,CAAG,EAhCmC,YAiCzCtE,CAjCyC,EAkClD,GAAI0C,CAAI,CAACtD,cAAL,CAAoBY,CAApB,CAAJ,CAAqC,IAC7BhB,CAAAA,CAAI,CAAG0D,CAAI,CAAC1C,CAAD,CADkB,CAE7BN,CAAI,CAAGD,MAAM,CAACC,IAAP,CAAYV,CAAZ,CAFsB,CAGjB,CAAd,CAAAU,CAAI,CAACC,MAH0B,EAIjCD,CAAI,CAACK,OAAL,CAAa,SAAAZ,CAAG,CAAI,CACdA,CAAG,CAACoF,UAAJ,CAAe,GAAf,CADc,EAEZ,CAACD,CAAQ,CAACtE,CAAD,CAFG,GAGdsE,CAAQ,CAACtE,CAAD,CAAR,CAAuB,EAHT,EAKhBsE,CAAQ,CAACtE,CAAD,CAAR,CAAqBb,CAArB,EAA4BH,CAAI,CAACG,CAAD,CALhB,GAOZ,CAACiD,CAAU,CAACpC,CAAD,CAPC,GAQdoC,CAAU,CAACpC,CAAD,CAAV,CAAyB,EARX,EAUhBoC,CAAU,CAACpC,CAAD,CAAV,CAAuBb,CAAvB,EAA8BH,CAAI,CAACG,CAAD,CAVlB,CAYnB,CAZD,CAcH,CApDiD,EAiCpD,IAAK,GAAMa,CAAAA,CAAX,GAAyB0C,CAAAA,CAAzB,GAAW1C,CAAX,EAqBA,MAAO,CACLY,QAAQ,CAARA,CADK,CAELC,MAAM,CAAEsB,eAAe,CAACpD,kBAAkB,CAACqD,CAAD,CAAa5D,kBAAb,CAAnB,CAFlB,CAGLsC,IAAI,CAAEqB,eAAe,CAACpD,kBAAkB,CAACuF,CAAD,CAAW9F,kBAAX,CAAnB,CAHhB,CAKR,CACM,CAIR","sourcesContent":["import {ActionTypes, NSP, defaultRouteParams, getActionData, routeCompleteAction} from '@medux/core';\nimport {BaseModelState, DisplayViews, RouteState} from '@medux/core/types/export';\nimport {LocationToRoute, RouteToLocation, TransformRoute} from '@medux/web';\nimport {compilePath, compileToPath, matchPath} from './matchPath';\n\nimport {Middleware} from 'redux';\nimport assignDeep from 'deep-extend';\n\n// 排除默认路由参数，路由中如果参数值与默认参数相同可省去\nfunction excludeDefaultData(data: any, def: any) {\n  const result: any = {};\n  for (const key in data) {\n    if (data.hasOwnProperty(key)) {\n      const value = data[key];\n      const defaultValue = def[key];\n      if (value !== defaultValue) {\n        if (typeof value === typeof defaultValue && typeof value === 'object' && !Array.isArray(value)) {\n          result[key] = excludeDefaultData(value, defaultValue);\n        } else {\n          result[key] = value;\n        }\n      }\n    }\n  }\n  if (Object.keys(result).length === 0) {\n    return undefined;\n  }\n  return result;\n}\n\n// 合并默认路由参数，如果路由中某参数没传，将用默认值替代，与上面方法互逆\nfunction mergeDefaultData(views: {[moduleName: string]: any}, data: any, def: any) {\n  const newData = {...data};\n  Object.keys(views).forEach(moduleName => {\n    if (!newData[moduleName] && def[moduleName]) {\n      newData[moduleName] = {};\n    }\n  });\n  Object.keys(newData).forEach(moduleName => {\n    if (def[moduleName]) {\n      newData[moduleName] = assignDeep({}, def[moduleName], newData[moduleName]);\n    }\n  });\n  return newData;\n}\n\nexport const mergeDefaultParamsMiddleware: Middleware = ({dispatch, getState}) => (next: Function) => (action: any) => {\n  if (action.type === ActionTypes.F_ROUTE_CHANGE) {\n    const payload = getActionData<RouteState>(action);\n    const {route}: {route: RouteState} = getState();\n    if (route) {\n      const locationInStore = route.location || {};\n      const location = payload.location || {};\n      if (locationInStore.pathname === location.pathname && locationInStore.search === location.search && locationInStore.hash === location.hash) {\n        return;\n      }\n    }\n    const params = mergeDefaultData(payload.data.views, payload.data.params, defaultRouteParams);\n    action = {...action, payload: {...payload, data: {...payload.data, params}}};\n    setTimeout(() => dispatch(routeCompleteAction()), 0);\n    return next(action);\n  } else {\n    const [moduleName, actionName] = action.type.split(NSP);\n    if (moduleName && actionName === ActionTypes.M_INIT) {\n      const {route}: {route: RouteState} = getState();\n      const params = route.data.params || {};\n      const moduleParams = params[moduleName];\n      const payload = getActionData<BaseModelState>(action);\n      const routeParams = mergeDefaultData({[moduleName]: true}, moduleParams, defaultRouteParams)[moduleName] || {};\n      action = {...action, payload: {...payload, routeParams}};\n      setTimeout(() => dispatch(routeCompleteAction()), 0);\n      return next(action);\n    }\n  }\n  return next(action);\n};\nexport interface RouteConfig {\n  [path: string]: string | [string, RouteConfig];\n}\n\nfunction getSearch(searchOrHash: string, key: string): string {\n  if (searchOrHash.length < 4) {\n    return '';\n  }\n  const reg = new RegExp(`[&?]${key}=`);\n  const str = ('#' + searchOrHash).split(reg)[1];\n  if (!str) {\n    return '';\n  }\n  return str.split('&')[0];\n}\n\nconst ISO_DATE_FORMAT = /^\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d(\\.\\d+)?(Z|[+-][01]\\d:[0-5]\\d)$/;\n\n/*\n  将字符串变成 Data，因为 JSON 中没有 Date 类型，所以用正则表达式匹配自动转换\n*/\nfunction searchParse(search: string, key: string = 'q'): undefined | {[moduleName: string]: {[key: string]: any}} {\n  search = getSearch(search, key);\n  if (!search) {\n    return undefined;\n  }\n  return JSON.parse(unescape(search), (prop: any, value: any) => {\n    if (typeof value === 'string' && ISO_DATE_FORMAT.test(value)) {\n      return new Date(value);\n    }\n    return value;\n  });\n}\n\nfunction searchStringify(searchData: any, key: string = 'q'): string {\n  if (!searchData) {\n    return '';\n  }\n  const str = JSON.stringify(searchData);\n  if (!str || str === '{}') {\n    return '';\n  }\n  return `${key}=${escape(str)}`;\n}\nfunction pathnameParse(pathname: string, routeConfig: RouteConfig, paths: string[], args: {[moduleName: string]: {[key: string]: any}}) {\n  for (const rule in routeConfig) {\n    if (routeConfig.hasOwnProperty(rule)) {\n      const match = matchPath(pathname, {path: rule.replace(/\\$$/, ''), exact: rule.endsWith('$')});\n      if (match) {\n        const item = routeConfig[rule];\n        const [viewName, pathConfig] = typeof item === 'string' ? [item, null] : item;\n        paths.push(viewName);\n        const moduleName = viewName.split('.')[0];\n        const {params} = match;\n        if (params && Object.keys(params).length > 0) {\n          args[moduleName] = {...args[moduleName], ...params};\n        }\n        if (pathConfig) {\n          pathnameParse(pathname, pathConfig, paths, args);\n        }\n        return;\n      }\n    }\n  }\n}\n\nfunction compileConfig(routeConfig: RouteConfig, viewToRule: {[viewName: string]: string} = {}, ruleToKeys: {[rule: string]: (string | number)[]} = {}) {\n  for (const rule in routeConfig) {\n    if (routeConfig.hasOwnProperty(rule)) {\n      if (!ruleToKeys[rule]) {\n        const {keys} = compilePath(rule.replace(/\\$$/, ''), {end: rule.endsWith('$'), strict: false, sensitive: false});\n        ruleToKeys[rule] = keys.reduce((prev: (string | number)[], cur) => {\n          prev.push(cur.name);\n          return prev;\n        }, []);\n      }\n      const item = routeConfig[rule];\n      const [viewName, pathConfig] = typeof item === 'string' ? [item, null] : item;\n      viewToRule[viewName] = rule;\n      if (pathConfig) {\n        compileConfig(pathConfig, viewToRule, ruleToKeys);\n      }\n    }\n  }\n  return {viewToRule, ruleToKeys};\n}\n\nexport function buildTransformRoute(routeConfig: RouteConfig): TransformRoute {\n  const {viewToRule, ruleToKeys} = compileConfig(routeConfig);\n  const locationToRoute: LocationToRoute = location => {\n    const paths: string[] = [];\n    const params: {[moduleName: string]: {[key: string]: any}} = searchParse(location.search) || {};\n    pathnameParse(location.pathname, routeConfig, paths, params);\n    const views: DisplayViews = paths.reduce((prev: DisplayViews, cur) => {\n      const [moduleName, viewName] = cur.split('.');\n      if (viewName) {\n        if (!prev[moduleName]) {\n          prev[moduleName] = {};\n        }\n        prev[moduleName][viewName] = true;\n      }\n      return prev;\n    }, {});\n    const hashParams: {[moduleName: string]: {[key: string]: any}} = searchParse(location.hash) || {};\n    for (const moduleName in hashParams) {\n      if (hashParams.hasOwnProperty(moduleName)) {\n        const moduleParams = hashParams[moduleName];\n        Object.keys(moduleParams).forEach(key => {\n          params[moduleName][key] = moduleParams[key];\n        });\n      }\n    }\n    return {paths, params, views};\n  };\n  const routeToLocation: RouteToLocation = routeData => {\n    const {paths, params} = routeData;\n    let pathname = '';\n    let args: {[moduleName: string]: {[key: string]: any}};\n    if (paths.length > 0) {\n      args = {};\n      // 将args二层克隆params，因为后面可能会删除path中使用到的变量\n      for (const moduleName in params) {\n        if (params.hasOwnProperty(moduleName)) {\n          args[moduleName] = {...params[moduleName]};\n        }\n      }\n      const lastViewName = paths[paths.length - 1];\n      for (const viewName of paths) {\n        const rule = viewToRule[viewName];\n        const moduleName = viewName.split('.')[0];\n        //最深的一个view可以决定pathname\n        if (viewName === lastViewName) {\n          const toPath = compileToPath(rule.replace(/\\$$/, ''));\n          pathname = toPath(params[moduleName]);\n        }\n        //pathname中传递的值可以不在params中重复传递\n        const keys = ruleToKeys[rule] || [];\n        keys.forEach(key => {\n          delete args[moduleName][key];\n        });\n      }\n    } else {\n      args = params;\n    }\n    //将带_前缀的变量放到hashData中\n    const searchData = {};\n    const hashData = {};\n    for (const moduleName in args) {\n      if (args.hasOwnProperty(moduleName)) {\n        const data = args[moduleName];\n        const keys = Object.keys(data);\n        if (keys.length > 0) {\n          keys.forEach(key => {\n            if (key.startsWith('_')) {\n              if (!hashData[moduleName]) {\n                hashData[moduleName] = {};\n              }\n              hashData[moduleName][key] = data[key];\n            } else {\n              if (!searchData[moduleName]) {\n                searchData[moduleName] = {};\n              }\n              searchData[moduleName][key] = data[key];\n            }\n          });\n        }\n      }\n    }\n    return {\n      pathname,\n      search: searchStringify(excludeDefaultData(searchData, defaultRouteParams)),\n      hash: searchStringify(excludeDefaultData(hashData, defaultRouteParams)),\n    };\n  };\n  return {\n    locationToRoute,\n    routeToLocation,\n  };\n}\n"],"file":"index.js"}