"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.TaskCounter=exports.PDispatcher=exports.PEvent=exports.LoadingState=exports.TaskCountEvent=void 0;var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),TaskCountEvent="TaskCountEvent";exports.TaskCountEvent=TaskCountEvent;var LoadingState;exports.LoadingState=LoadingState,function(a){a.Start="Start",a.Stop="Stop",a.Depth="Depth"}(LoadingState||(exports.LoadingState=LoadingState={}));var PEvent=/*#__PURE__*/function(){function a(a,b,c){void 0===c&&(c=!1),this.name=a,this.data=b,this.bubbling=c,(0,_defineProperty2.default)(this,"target",null),(0,_defineProperty2.default)(this,"currentTarget",null)}var b=a.prototype;return b.setTarget=function setTarget(a){this.target=a},b.setCurrentTarget=function setCurrentTarget(a){this.currentTarget=a},a}();exports.PEvent=PEvent;var PDispatcher=/*#__PURE__*/function(){function a(a){this.parent=a,(0,_defineProperty2.default)(this,"storeHandlers",{})}var b=a.prototype;return b.addListener=function addListener(a,b){var c=this.storeHandlers[a];return c||(this.storeHandlers[a]=c=[]),c.push(b),this},b.removeListener=function removeListener(a,b){var c=this;if(!a)Object.keys(this.storeHandlers).forEach(function(a){delete c.storeHandlers[a]});else{var d=this.storeHandlers;if(d.propertyIsEnumerable(a)){var e=d[a];if(!b)delete d[a];else{var f=e.indexOf(b);-1<f&&e.splice(f,1),0===e.length&&delete d[a]}}}return this},b.dispatch=function dispatch(a){a.target||a.setTarget(this),a.setCurrentTarget(this);var b=this.storeHandlers[a.name];if(b)for(var c=0,d=b.length;c<d;c++)b[c](a);return this.parent&&a.bubbling&&this.parent.dispatch(a),this},b.setParent=function setParent(a){return this.parent=a,this},a}();exports.PDispatcher=PDispatcher;var TaskCounter=/*#__PURE__*/function(a){function b(b){var c;return c=a.call(this)||this,c.deferSecond=b,(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(c),"list",[]),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(c),"ctimer",0),c}(0,_inheritsLoose2.default)(b,a);var c=b.prototype;return c.addItem=function addItem(a,b){var c=this;return void 0===b&&(b=""),this.list.some(function(b){return b.promise===a})||(this.list.push({promise:a,note:b}),a.then(function(){return c.completeItem(a)},function(){return c.completeItem(a)}),1===this.list.length&&(this.dispatch(new PEvent(TaskCountEvent,LoadingState.Start)),this.ctimer=setTimeout(function(){c.ctimer=0,0<c.list.length&&c.dispatch(new PEvent(TaskCountEvent,LoadingState.Depth))},1e3*this.deferSecond))),a},c.completeItem=function completeItem(a){var b=this.list.findIndex(function(b){return b.promise===a});return-1<b&&(this.list.splice(b,1),0===this.list.length&&(this.ctimer&&(clearTimeout(this.ctimer),this.ctimer=0),this.dispatch(new PEvent(TaskCountEvent,LoadingState.Stop)))),this},b}(PDispatcher);exports.TaskCounter=TaskCounter;
//# sourceMappingURL=sprite.js.map