import"core-js/modules/es.symbol";import"core-js/modules/es.symbol.description";import"core-js/modules/es.symbol.to-primitive";import"core-js/modules/es.symbol.to-string-tag";import"core-js/modules/es.array.filter";import"core-js/modules/es.array.find";import"core-js/modules/es.array.iterator";import"core-js/modules/es.array.map";import"core-js/modules/es.array.splice";import"core-js/modules/es.date.to-primitive";import"core-js/modules/es.json.to-string-tag";import"core-js/modules/es.math.to-string-tag";import"core-js/modules/es.number.constructor";import"core-js/modules/es.object.assign";import"core-js/modules/es.object.keys";import"core-js/modules/es.object.to-string";import"core-js/modules/es.promise";import"core-js/modules/es.string.iterator";import"core-js/modules/web.dom-collections.for-each";import"core-js/modules/web.dom-collections.iterator";import _toArray from"@babel/runtime/helpers/esm/toArray";import _objectSpread from"@babel/runtime/helpers/esm/objectSpread";function _decorate(a,b,c,d){var e=_getDecoratorsApi();if(d)for(var f=0;f<d.length;f++)e=d[f](e);var g=b(function(a){e.initializeInstanceElements(a,h.elements)},c),h=e.decorateClass(_coalesceClassElements(g.d.map(_createElementDescriptor)),a);return e.initializeClassElements(g.F,h.elements),e.runClassFinishers(g.F,h.finishers)}function _getDecoratorsApi(){_getDecoratorsApi=function(){return a};var a={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function initializeInstanceElements(a,b){["method","field"].forEach(function(c){b.forEach(function(b){b.kind===c&&"own"===b.placement&&this.defineClassElement(a,b)},this)},this)},initializeClassElements:function initializeClassElements(a,b){var c=a.prototype;["method","field"].forEach(function(d){b.forEach(function(b){var e=b.placement;if(b.kind===d&&("static"===e||"prototype"===e)){var f="static"===e?a:c;this.defineClassElement(f,b)}},this)},this)},defineClassElement:function defineClassElement(a,b){var c=b.descriptor;if("field"===b.kind){var d=b.initializer;c={enumerable:c.enumerable,writable:c.writable,configurable:c.configurable,value:void 0===d?void 0:d.call(a)}}Object.defineProperty(a,b.key,c)},decorateClass:function decorateClass(a,b){var c=[],d=[],e={static:[],prototype:[],own:[]};if(a.forEach(function(a){this.addElementPlacement(a,e)},this),a.forEach(function(a){if(!_hasDecorators(a))return c.push(a);var b=this.decorateElement(a,e);c.push(b.element),c.push.apply(c,b.extras),d.push.apply(d,b.finishers)},this),!b)return{elements:c,finishers:d};var f=this.decorateConstructor(c,b);return d.push.apply(d,f.finishers),f.finishers=d,f},addElementPlacement:function addElementPlacement(a,b,c){var d=b[a.placement];if(!c&&-1!==d.indexOf(a.key))throw new TypeError("Duplicated element ("+a.key+")");d.push(a.key)},decorateElement:function decorateElement(a,b){for(var c,d=[],e=[],f=a.decorators,g=f.length-1;0<=g;g--){c=b[a.placement],c.splice(c.indexOf(a.key),1);var h=this.fromElementDescriptor(a),k=this.toElementFinisherExtras((0,f[g])(h)||h);a=k.element,this.addElementPlacement(a,b),k.finisher&&e.push(k.finisher);var l=k.extras;if(l){for(var m=0;m<l.length;m++)this.addElementPlacement(l[m],b);d.push.apply(d,l)}}return{element:a,finishers:e,extras:d}},decorateConstructor:function decorateConstructor(a,b){for(var c=[],d=b.length-1;0<=d;d--){var e=this.fromClassDescriptor(a),f=this.toClassDescriptor((0,b[d])(e)||e);if(void 0!==f.finisher&&c.push(f.finisher),void 0!==f.elements){a=f.elements;for(var g=0;g<a.length-1;g++)for(var h=g+1;h<a.length;h++)if(a[g].key===a[h].key&&a[g].placement===a[h].placement)throw new TypeError("Duplicated element ("+a[g].key+")")}}return{elements:a,finishers:c}},fromElementDescriptor:function fromElementDescriptor(a){var b={kind:a.kind,key:a.key,placement:a.placement,descriptor:a.descriptor};return Object.defineProperty(b,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===a.kind&&(b.initializer=a.initializer),b},toElementDescriptors:function toElementDescriptors(a){return void 0===a?void 0:_toArray(a).map(function(a){var b=this.toElementDescriptor(a);return this.disallowProperty(a,"finisher","An element descriptor"),this.disallowProperty(a,"extras","An element descriptor"),b},this)},toElementDescriptor:function toElementDescriptor(a){var b=a.kind+"";if("method"!=b&&"field"!=b)throw new TypeError("An element descriptor's .kind property must be either \"method\" or \"field\", but a decorator created an element descriptor with .kind \""+b+"\"");var c=_toPropertyKey(a.key),d=a.placement+"";if("static"!==d&&"prototype"!==d&&"own"!==d)throw new TypeError("An element descriptor's .placement property must be one of \"static\", \"prototype\" or \"own\", but a decorator created an element descriptor with .placement \""+d+"\"");var e=a.descriptor;this.disallowProperty(a,"elements","An element descriptor");var f={kind:b,key:c,placement:d,descriptor:Object.assign({},e)};return"field"==b?(this.disallowProperty(e,"get","The property descriptor of a field descriptor"),this.disallowProperty(e,"set","The property descriptor of a field descriptor"),this.disallowProperty(e,"value","The property descriptor of a field descriptor"),f.initializer=a.initializer):this.disallowProperty(a,"initializer","A method descriptor"),f},toElementFinisherExtras:function toElementFinisherExtras(a){var b=this.toElementDescriptor(a),c=_optionalCallableProperty(a,"finisher"),d=this.toElementDescriptors(a.extras);return{element:b,finisher:c,extras:d}},fromClassDescriptor:function fromClassDescriptor(a){var b={kind:"class",elements:a.map(this.fromElementDescriptor,this)};return Object.defineProperty(b,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),b},toClassDescriptor:function toClassDescriptor(a){var b=a.kind+"";if("class"!=b)throw new TypeError("A class descriptor's .kind property must be \"class\", but a decorator created a class descriptor with .kind \""+b+"\"");this.disallowProperty(a,"key","A class descriptor"),this.disallowProperty(a,"placement","A class descriptor"),this.disallowProperty(a,"descriptor","A class descriptor"),this.disallowProperty(a,"initializer","A class descriptor"),this.disallowProperty(a,"extras","A class descriptor");var c=_optionalCallableProperty(a,"finisher"),d=this.toElementDescriptors(a.elements);return{elements:d,finisher:c}},runClassFinishers:function runClassFinishers(a,b){for(var c,d=0;d<b.length;d++)if(c=(0,b[d])(a),void 0!==c){if("function"!=typeof c)throw new TypeError("Finishers must return a constructor.");a=c}return a},disallowProperty:function disallowProperty(a,b,c){if(a[b]!==void 0)throw new TypeError(c+" can't have a ."+b+" property.")}};return a}function _createElementDescriptor(a){var b,c=_toPropertyKey(a.key);"method"===a.kind?b={value:a.value,writable:!0,configurable:!0,enumerable:!1}:"get"===a.kind?b={get:a.value,configurable:!0,enumerable:!1}:"set"===a.kind?b={set:a.value,configurable:!0,enumerable:!1}:"field"===a.kind&&(b={configurable:!0,writable:!0,enumerable:!0});var d={kind:"field"===a.kind?"field":"method",key:c,placement:a.static?"static":"field"===a.kind?"own":"prototype",descriptor:b};return a.decorators&&(d.decorators=a.decorators),"field"===a.kind&&(d.initializer=a.value),d}function _coalesceGetterSetter(a,b){a.descriptor.get===void 0?b.descriptor.set=a.descriptor.set:b.descriptor.get=a.descriptor.get}function _coalesceClassElements(a){for(var b=[],c=function(a){return"method"===a.kind&&a.key===f.key&&a.placement===f.placement},d=0;d<a.length;d++){var e,f=a[d];if(!("method"===f.kind&&(e=b.find(c))))b.push(f);else if(_isDataDescriptor(f.descriptor)||_isDataDescriptor(e.descriptor)){if(_hasDecorators(f)||_hasDecorators(e))throw new ReferenceError("Duplicated methods ("+f.key+") can't be decorated.");e.descriptor=f.descriptor}else{if(_hasDecorators(f)){if(_hasDecorators(e))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+f.key+").");e.decorators=f.decorators}_coalesceGetterSetter(f,e)}}return b}function _hasDecorators(a){return a.decorators&&a.decorators.length}function _isDataDescriptor(a){return a!==void 0&&(a.value!==void 0||a.writable!==void 0)}function _optionalCallableProperty(a,b){var c=a[b];if(c!==void 0&&"function"!=typeof c)throw new TypeError("Expected '"+b+"' to be a function");return c}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"==typeof b?b:b+""}function _toPrimitive(a,b){if("object"!=typeof a||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!=typeof d)return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}import{MetaData,defaultRouteParams,injectActions,isPromise,reducer}from"./basic";import{buildStore}from"./store";import{errorAction}from"./actions";export var exportModule=function(a,b,c,d){defaultRouteParams[a]||(defaultRouteParams[a]=b.routeParams);var e=function(d){var e=d._medux_.injectedModules[a];if(!e){d._medux_.injectedModules[a]=!0;var f=d.getState()[a],g=new c(a,d,b,f),h=injectActions(d,a,g);if(g.actions=h,!f){var i=d._medux_.prevState.route.data.params||{},j=h.INIT(_objectSpread({},b,{routeParams:i[a]||defaultRouteParams[a]})),k=d.dispatch(j);if(isPromise(k))return k.catch(function(a){return d.dispatch(errorAction(a))}).then(function(){})}}};e.moduleName=a,e.initState=b;return{moduleName:a,model:e,views:d,actions:{}}};export var BaseModelHandlers=_decorate(null,function(a){return{F:// eslint-disable-next-line @typescript-eslint/no-unused-vars
function(b,c,d){this.moduleName=b,this.store=c,this.initState=d,a(this),d.isModule=!0},d:[{kind:"field",key:"actions",value:function value(){return null}},{kind:"get",key:"state",value:function state(){return this.store._medux_.prevState[this.moduleName]}},{kind:"get",key:"rootState",value:function rootState(){return this.store._medux_.prevState}},{kind:"get",key:"currentState",value:function currentState(){return this.store._medux_.currentState[this.moduleName]}},{kind:"get",key:"currentRootState",value:function currentRootState(){return this.store._medux_.currentState}},{kind:"method",key:"dispatch",value:function dispatch(a){return this.store.dispatch(a)}},{kind:"method",key:"callThisAction",value:function callThisAction(a){var b=MetaData.actionCreatorMap[this.moduleName];return b[a.__actionName__](1>=arguments.length?void 0:arguments[1])}},{kind:"method",key:"updateState",value:function updateState(a){this.dispatch(this.callThisAction(this.UPDATE,_objectSpread({},this.state,a)))}},{kind:"method",decorators:[reducer],key:"INIT",value:function INIT(a){return a}},{kind:"method",decorators:[reducer],key:"UPDATE",value:function UPDATE(a){return a}},{kind:"method",decorators:[reducer],key:"LOADING",value:function LOADING(a){var b=this.state;return b?_objectSpread({},b,{loading:_objectSpread({},b.loading,a)}):b}}]}});export function isPromiseModule(a){return"function"==typeof a.then}export function isPromiseView(a){return"function"==typeof a.then}export function exportActions(a){return MetaData.moduleGetter=a,MetaData.actionCreatorMap=Object.keys(a).reduce(function(a,b){return a[b]="undefined"==typeof Proxy?{}:new Proxy({},{get:function get(a,c){return function(a){return{type:b+"/"+c,payload:a}}},set:function set(){return!0}}),a},{}),MetaData.actionCreatorMap}export function injectModel(a,b,c){var d=c._medux_.injectedModules[b];if(!d){a=MetaData.moduleGetter;var e=a[b]();return isPromiseModule(e)?e.then(function(d){return a[b]=function(){return d},d.default.model(c)}):e.default.model(c)}}export function getView(a,b,c){a=MetaData.moduleGetter;var d=a[b]();if(isPromiseModule(d))return d.then(function(d){a[b]=function(){return d};var e=d.default.views[c];if(MetaData.isServer)return e;var f=d.default.model(MetaData.clientStore);return isPromise(f)?f.then(function(){return e}):e});var e=d.default.views[c];if(MetaData.isServer)return e;var f=d.default.model(MetaData.clientStore);return isPromise(f)?f.then(function(){return e}):e}function getModuleByName(a,b){var c=b[a]();return isPromiseModule(c)?c.then(function(c){return b[a]=function(){return c},c}):c}function getModuleListByNames(a,b){var c=a.map(function(a){var c=getModuleByName(a,b);return isPromiseModule(c)?c:Promise.resolve(c)});return Promise.all(c)}export function renderApp(a,b,c,d,e){void 0===e&&(e={}),MetaData.appModuleName=c;var f=e.ssrInitStoreKey||"meduxInitStore",g={};(e.initData||window[f])&&(g=_objectSpread({},window[f],e.initData));var h=buildStore(d,g,e.reducers,e.middlewares,e.enhancers,e.defaultRouteParams),i=[c];return g&&i.push.apply(i,Object.keys(g).filter(function(a){return a!==c&&g[a].isModule})),getModuleListByNames(i,b).then(function(b){var c=b[0],d=c.default.model(h);return a(h,c.default.model,c.default.views,f),d})}export function renderSSR(a,b,c,d,e){void 0===e&&(e={}),MetaData.appModuleName=c;var f=e.ssrInitStoreKey||"meduxInitStore",g=buildStore(d,e.initData,e.reducers,e.middlewares,e.enhancers,e.defaultRouteParams),h=b[c](),i=h.default.model(g);return isPromise(i)||(i=Promise.resolve()),i.then(function(){return a(g,h.default.model,h.default.views,f)})}
//# sourceMappingURL=module.js.map