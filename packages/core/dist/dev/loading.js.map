{"version":3,"sources":["../../src/loading.ts"],"names":["MetaData","getModuleActionCreatorList","NSP","TaskCounter","TaskCountEvent","ActionTypes","loadings","depthTime","setLoadingDepthTime","second","setLoading","item","moduleName","group","appModuleName","isServer","key","addListener","e","store","clientStore","actions","M_LOADING","action","data","dispatch","addItem"],"mappings":"AAAA,SAAQA,QAAR,EAAkBC,0BAAlB,EAA8CC,GAA9C,QAAwD,SAAxD;AACA,SAAQC,WAAR,EAAqBC,cAArB,QAA0C,UAA1C;AACA,SAAQC,WAAR,QAA0B,WAA1B;AAEA,IAAMC,QAA6C,GAAG,EAAtD;AAEA,IAAIC,SAAS,GAAG,CAAhB;AAEA,OAAO,SAASC,mBAAT,CAA6BC,MAA7B,EAA6C;AAClDF,EAAAA,SAAS,GAAGE,MAAZ;AACD;AACD,OAAO,SAASC,UAAT,CAA4CC,IAA5C,EAAqDC,UAArD,EAAkGC,KAAlG,EAA+H;AAAA,MAA1ED,UAA0E;AAA1EA,IAAAA,UAA0E,GAArDZ,QAAQ,CAACc,aAA4C;AAAA;;AAAA,MAA7BD,KAA6B;AAA7BA,IAAAA,KAA6B,GAAb,QAAa;AAAA;;AACpI,MAAIb,QAAQ,CAACe,QAAb,EAAuB;AACrB,WAAOJ,IAAP;AACD;;AACD,MAAMK,GAAG,GAAGJ,UAAU,GAAGV,GAAb,GAAmBW,KAA/B;;AACA,MAAI,CAACP,QAAQ,CAACU,GAAD,CAAb,EAAoB;AAClBV,IAAAA,QAAQ,CAACU,GAAD,CAAR,GAAgB,IAAIb,WAAJ,CAAgBI,SAAhB,CAAhB;AACAD,IAAAA,QAAQ,CAACU,GAAD,CAAR,CAAcC,WAAd,CAA0Bb,cAA1B,EAA0C,UAAAc,CAAC,EAAI;AAC7C,UAAMC,KAAK,GAAGnB,QAAQ,CAACoB,WAAvB;;AACA,UAAID,KAAJ,EAAW;AAAA;;AACT,YAAME,OAAO,GAAGpB,0BAA0B,CAACW,UAAD,CAA1B,CAAuCP,WAAW,CAACiB,SAAnD,CAAhB;AACA,YAAMC,MAAM,GAAGF,OAAO,0BAAGR,KAAH,IAAWK,CAAC,CAACM,IAAb,YAAtB;AACAL,QAAAA,KAAK,CAACM,QAAN,CAAeF,MAAf;AACD;AACF,KAPD;AAQD;;AACDjB,EAAAA,QAAQ,CAACU,GAAD,CAAR,CAAcU,OAAd,CAAsBf,IAAtB;AACA,SAAOA,IAAP;AACD","sourcesContent":["import {MetaData, getModuleActionCreatorList, NSP} from './basic';\nimport {TaskCounter, TaskCountEvent} from './sprite';\nimport {ActionTypes} from './actions';\n\nconst loadings: {[moduleName: string]: TaskCounter} = {};\n\nlet depthTime = 2;\n\nexport function setLoadingDepthTime(second: number) {\n  depthTime = second;\n}\nexport function setLoading<T extends Promise<any>>(item: T, moduleName: string = MetaData.appModuleName, group: string = 'global'): T {\n  if (MetaData.isServer) {\n    return item;\n  }\n  const key = moduleName + NSP + group;\n  if (!loadings[key]) {\n    loadings[key] = new TaskCounter(depthTime);\n    loadings[key].addListener(TaskCountEvent, e => {\n      const store = MetaData.clientStore;\n      if (store) {\n        const actions = getModuleActionCreatorList(moduleName)[ActionTypes.M_LOADING];\n        const action = actions({[group]: e.data});\n        store.dispatch(action);\n      }\n    });\n  }\n  loadings[key].addItem(item);\n  return item;\n}\n"],"file":"loading.js"}