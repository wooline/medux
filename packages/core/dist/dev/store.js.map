{"version":3,"sources":["../../src/store.ts"],"names":["invalidViewTimer","checkInvalidview","currentViews","MetaData","clientStore","_meta_","views","moduleName","hasOwnProperty","element","viewname","dispatch","invalidview","getActionData","action","arr","key","length","data","simpleEqual","obj1","obj2","keys1","keys2","buildStore","preloadedState","storeReducers","storeMiddlewares","storeEnhancers","Error","store","combineReducers","rootState","meta","prevState","currentState","namespace","type","ActionTypes","F_VIEW_INVALID","handlersCommon","reducerMap","handlersEvery","replace","RegExp","NSP","handlers","handlerModules","orderList","priority","fun","__isHandler__","push","unshift","moduleNameMap","changed","middlewareEnhancer","applyMiddleware","middleware","next","originalAction","isServer","split","M_LOADING","effectMap","promiseResults","effectResult","decorators","__decorators__","results","decorator","index","__decoratorResults__","then","reslove","reject","all","enhancers","enhancer","newCreateStore","newStore","router","injectedModules","isDev","root","__REDUX_DEVTOOLS_EXTENSION__","__REDUX_DEVTOOLS_EXTENSION__OPTIONS","compose","onerror","evt","source","fileno","columnNumber","error","onunhandledrejection","reason"],"mappings":"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","sourcesContent":["import {applyMiddleware, compose, createStore, Middleware, ReducersMapObject, StoreEnhancer} from 'redux';\nimport {Action, CurrentViews, MetaData, ModelStore, NSP, root} from './global';\nimport {isPlainObject} from 'sprite';\nimport {errorAction, viewInvalidAction, ActionTypes} from 'actions';\n\nlet invalidViewTimer: number;\n\nfunction checkInvalidview() {\n  invalidViewTimer = 0;\n  const currentViews = MetaData.clientStore._meta_.currentViews;\n  const views: CurrentViews = {};\n  for (const moduleName in currentViews) {\n    if (currentViews.hasOwnProperty(moduleName)) {\n      const element = currentViews[moduleName];\n      for (const viewname in element) {\n        if (element[viewname]) {\n          if (!views[moduleName]) {\n            views[moduleName] = {};\n          }\n          views[moduleName][viewname] = element[viewname];\n        }\n      }\n    }\n  }\n  MetaData.clientStore.dispatch(viewInvalidAction(views));\n}\n\nexport function invalidview() {\n  if (!invalidViewTimer) {\n    invalidViewTimer = setTimeout(checkInvalidview, 4);\n  }\n}\n\nfunction getActionData(action: Action) {\n  const arr = Object.keys(action).filter(key => key !== 'type' && key !== 'priority' && key !== 'time');\n  if (arr.length === 0) {\n    return undefined;\n  } else if (arr.length === 1) {\n    return action[arr[0]];\n  } else {\n    const data = {...action};\n    delete data['type'];\n    delete data['priority'];\n    delete data['time'];\n    return data;\n  }\n}\n\nfunction simpleEqual(obj1: any, obj2: any): boolean {\n  if (obj1 === obj2) {\n    return true;\n  } else if (typeof obj1 !== typeof obj2 || typeof obj1 !== 'object') {\n    return false;\n  } else {\n    const keys1 = Object.keys(obj1);\n    const keys2 = Object.keys(obj2);\n    if (keys1.length !== keys2.length) {\n      return false;\n    } else {\n      for (const key of keys1) {\n        if (!simpleEqual(obj1[key], obj2[key])) {\n          return false;\n        }\n      }\n      return true;\n    }\n  }\n}\n\nexport function buildStore(preloadedState: any = {}, storeReducers: ReducersMapObject<any, any> = {}, storeMiddlewares: Middleware[] = [], storeEnhancers: StoreEnhancer[] = []): ModelStore {\n  if (!isPlainObject(preloadedState)) {\n    throw new Error('preloadedState must be plain objects!');\n  }\n  if (!isPlainObject(storeReducers)) {\n    throw new Error('storeReducers must be plain objects!');\n  }\n  let store: ModelStore;\n  const combineReducers = (rootState: {[key: string]: any}, action: Action) => {\n    if (!store) {\n      return rootState;\n    }\n    const meta = store._meta_;\n    meta.prevState = rootState;\n    const currentState = {...rootState};\n    meta.currentState = currentState;\n\n    if (!currentState.views) {\n      currentState.views = {};\n    }\n    Object.keys(storeReducers).forEach(namespace => {\n      currentState[namespace] = storeReducers[namespace](currentState[namespace], action);\n    });\n    if (action.type === ActionTypes.F_VIEW_INVALID) {\n      const views: CurrentViews = getActionData(action);\n      if (!simpleEqual(currentState.views, views)) {\n        currentState.views = views;\n      }\n    }\n    const handlersCommon = meta.reducerMap[action.type] || {};\n    // 支持泛监听，形如 */loading\n    const handlersEvery = meta.reducerMap[action.type.replace(new RegExp(`[^${NSP}]+`), '*')] || {};\n    const handlers = {...handlersCommon, ...handlersEvery};\n    const handlerModules = Object.keys(handlers);\n\n    if (handlerModules.length > 0) {\n      const orderList: string[] = action.priority ? [...action.priority] : [];\n      handlerModules.forEach(namespace => {\n        const fun = handlers[namespace];\n        if (fun.__isHandler__) {\n          orderList.push(namespace);\n        } else {\n          orderList.unshift(namespace);\n        }\n      });\n      const moduleNameMap: {[key: string]: boolean} = {};\n      orderList.forEach(namespace => {\n        if (!moduleNameMap[namespace]) {\n          moduleNameMap[namespace] = true;\n          const fun = handlers[namespace];\n          currentState[namespace] = fun(getActionData(action));\n        }\n      });\n    }\n    const changed = Object.keys(rootState).length !== Object.keys(currentState).length || Object.keys(rootState).some(namespace => rootState[namespace] !== currentState[namespace]);\n    meta.prevState = changed ? currentState : rootState;\n    return meta.prevState;\n  };\n\n  const middleware = () => (next: Function) => (originalAction: Action) => {\n    if (MetaData.isServer) {\n      if (originalAction.type.split(NSP)[1] === ActionTypes.M_LOADING) {\n        return originalAction;\n      }\n    }\n    const action: Action = next(originalAction);\n    const handlersCommon = store._meta_.effectMap[action.type] || {};\n    // 支持泛监听，形如 */loading\n    const handlersEvery = store._meta_.effectMap[action.type.replace(new RegExp(`[^${NSP}]+`), '*')] || {};\n    const handlers = {...handlersCommon, ...handlersEvery};\n    const handlerModules = Object.keys(handlers);\n\n    if (handlerModules.length > 0) {\n      const orderList: string[] = action.priority ? [...action.priority] : [];\n      handlerModules.forEach(namespace => {\n        const fun = handlers[namespace];\n        if (fun.__isHandler__) {\n          orderList.push(namespace);\n        } else {\n          orderList.unshift(namespace);\n        }\n      });\n      const moduleNameMap: {[key: string]: boolean} = {};\n      const promiseResults: Promise<any>[] = [];\n      orderList.forEach(namespace => {\n        if (!moduleNameMap[namespace]) {\n          moduleNameMap[namespace] = true;\n          const fun = handlers[namespace];\n          const effectResult = fun(getActionData(action));\n          const decorators = fun.__decorators__;\n          if (decorators) {\n            const results: any[] = [];\n            decorators.forEach((decorator, index) => {\n              results[index] = decorator[0](action, namespace, effectResult);\n            });\n            fun.__decoratorResults__ = results;\n          }\n\n          effectResult.then(\n            (reslove: any) => {\n              if (decorators) {\n                const results = fun.__decoratorResults__ || [];\n                decorators.forEach((decorator, index) => {\n                  if (decorator[1]) {\n                    decorator[1]('Resolved', results[index], reslove);\n                  }\n                });\n                fun.__decoratorResults__ = undefined;\n              }\n              return reslove;\n            },\n            (reject: any) => {\n              if (decorators) {\n                const results = fun.__decoratorResults__ || [];\n                decorators.forEach((decorator, index) => {\n                  if (decorator[1]) {\n                    decorator[1]('Rejected', results[index], reject);\n                  }\n                });\n                fun.__decoratorResults__ = undefined;\n              }\n            }\n          );\n          promiseResults.push(effectResult);\n        }\n      });\n      if (promiseResults.length) {\n        return Promise.all(promiseResults);\n      }\n    }\n    return action;\n  };\n\n  // const enhancers = [applyMiddleware(...[effectMiddleware, routerMiddleware(storeHistory), ...storeMiddlewares]), ...storeEnhancers];\n  // if (MetaData.isBrowser && MetaData.isDev && window[\"__REDUX_DEVTOOLS_EXTENSION__\"]) {\n  //\n  // __REDUX_DEVTOOLS_EXTENSION_COMPOSE__\n  // enhancers.push(window[\"__REDUX_DEVTOOLS_EXTENSION__\"](window[\"__REDUX_DEVTOOLS_EXTENSION__OPTIONS\"]));\n  // }\n  // store = createStore(combineReducers as any, initData, compose(...enhancers));\n\n  const middlewareEnhancer = applyMiddleware(...storeMiddlewares, middleware);\n  const enhancer: StoreEnhancer = newCreateStore => {\n    return (...args) => {\n      const newStore = newCreateStore(...args);\n      const modelStore: ModelStore = newStore as any;\n      modelStore._meta_ = {\n        prevState: {router: null},\n        currentState: {router: null},\n        reducerMap: {},\n        effectMap: {},\n        injectedModules: {},\n        currentViews: {},\n      };\n      return newStore;\n    };\n  };\n  const enhancers = [...storeEnhancers, middlewareEnhancer, enhancer];\n  if (MetaData.isDev && root.__REDUX_DEVTOOLS_EXTENSION__) {\n    enhancers.push(root.__REDUX_DEVTOOLS_EXTENSION__(root.__REDUX_DEVTOOLS_EXTENSION__OPTIONS));\n  }\n  store = createStore(combineReducers as any, preloadedState, compose(...enhancers));\n  MetaData.clientStore = store;\n  if (!MetaData.isServer) {\n    root.onerror = (evt: any, source?: string, fileno?: number, columnNumber?: number, error?: Error) => {\n      store.dispatch(errorAction(error || evt));\n    };\n    if ('onunhandledrejection' in root) {\n      root.onunhandledrejection = (error: any) => {\n        store.dispatch(errorAction(error.reason));\n      };\n    }\n  }\n  return store;\n}\n"],"file":"store.js"}