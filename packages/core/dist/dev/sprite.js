"use strict";var _interopRequireDefault=require("@babel/runtime-corejs3/helpers/interopRequireDefault");var _Object$defineProperty=require("@babel/runtime-corejs3/core-js-stable/object/define-property");require("core-js/modules/es.function.name");_Object$defineProperty(exports,"__esModule",{value:!0}),exports.isPlainObject=isPlainObject,exports.TaskCounter=exports.PDispatcher=exports.PEvent=exports.LoadingState=exports.TaskCountEvent=void 0;var _findIndex=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/find-index")),_setTimeout2=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/set-timeout")),_some=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/some")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/assertThisInitialized")),_inherits2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/inherits")),_splice=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/splice")),_indexOf=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/index-of")),_keys=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/keys")),_forEach=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/for-each")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/createClass")),_defineProperty2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/defineProperty")),_getPrototypeOf3=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/get-prototype-of")),_typeof2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/typeof"));function isPlainObject(a){if("object"!==(0,_typeof2.default)(a)||null===a)return!1;for(var b=a;null!==(0,_getPrototypeOf3.default)(b);)b=(0,_getPrototypeOf3.default)(b);return(0,_getPrototypeOf3.default)(a)===proto}var TaskCountEvent="TaskCountEvent";exports.TaskCountEvent="TaskCountEvent";var LoadingState;exports.LoadingState=LoadingState,function(a){a.Start="Start",a.Stop="Stop",a.Depth="Depth"}(LoadingState||(exports.LoadingState=LoadingState={}));var PEvent=/*#__PURE__*/function(){function a(b,c){var d=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];(0,_classCallCheck2.default)(this,a),this.name=b,this.data=c,this.bubbling=d,(0,_defineProperty2.default)(this,"target",null),(0,_defineProperty2.default)(this,"currentTarget",null)}return(0,_createClass2.default)(a,[{key:"setTarget",value:function setTarget(a){this.target=a}},{key:"setCurrentTarget",value:function setCurrentTarget(a){this.currentTarget=a}}]),a}();exports.PEvent=PEvent;var PDispatcher=/*#__PURE__*/function(){function a(b){(0,_classCallCheck2.default)(this,a),this.parent=b,(0,_defineProperty2.default)(this,"storeHandlers",{})}return(0,_createClass2.default)(a,[{key:"addListener",value:function addListener(a,b){var c=this.storeHandlers[a];return c||(this.storeHandlers[a]=c=[]),c.push(b),this}},{key:"removeListener",value:function removeListener(a,b){var c=this;if(!a){var d;(0,_forEach.default)(d=(0,_keys.default)(this.storeHandlers)).call(d,function(a){delete c.storeHandlers[a]})}else{var e=this.storeHandlers;if(e.propertyIsEnumerable(a)){var f=e[a];if(!b)delete e[a];else{var g=(0,_indexOf.default)(f).call(f,b);-1<g&&(0,_splice.default)(f).call(f,g,1),0===f.length&&delete e[a]}}}return this}},{key:"dispatch",value:function dispatch(a){a.target||a.setTarget(this),a.setCurrentTarget(this);var b=this.storeHandlers[a.name];if(b)for(var c=0,d=b.length;c<d;c++)b[c](a);return this.parent&&a.bubbling&&this.parent.dispatch(a),this}},{key:"setParent",value:function setParent(a){return this.parent=a,this}}]),a}();exports.PDispatcher=PDispatcher;var TaskCounter=/*#__PURE__*/function(a){function b(a){var c;return(0,_classCallCheck2.default)(this,b),c=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(b).call(this)),c.deferSecond=a,(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(c),"list",[]),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(c),"ctimer",0),c}return(0,_inherits2.default)(b,a),(0,_createClass2.default)(b,[{key:"addItem",value:function addItem(a){var b,c=this,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return(0,_some.default)(b=this.list).call(b,function(b){return b.promise===a})||(this.list.push({promise:a,note:d}),a.then(function(){return c.completeItem(a)},function(){return c.completeItem(a)}),1===this.list.length&&(this.dispatch(new PEvent(TaskCountEvent,LoadingState.Start)),this.ctimer=(0,_setTimeout2.default)(function(){c.ctimer=0,0<c.list.length&&c.dispatch(new PEvent(TaskCountEvent,LoadingState.Depth))},1e3*this.deferSecond))),a}},{key:"completeItem",value:function completeItem(a){var b,c=(0,_findIndex.default)(b=this.list).call(b,function(b){return b.promise===a});if(-1<c){var d;(0,_splice.default)(d=this.list).call(d,c,1),0===this.list.length&&(this.ctimer&&(clearTimeout(this.ctimer),this.ctimer=0),this.dispatch(new PEvent(TaskCountEvent,LoadingState.Stop)))}return this}}]),b}(PDispatcher);exports.TaskCounter=TaskCounter;
//# sourceMappingURL=sprite.js.map