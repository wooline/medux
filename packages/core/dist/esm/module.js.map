{"version":3,"sources":["../../src/module.ts"],"names":["MetaData","client","config","injectActions","isPromise","reducer","buildStore","exportModule","moduleName","initState","ActionHandles","views","model","store","options","hasInjected","_medux_","injectedModules","moduleState","getState","handlers","actions","params","prevState","route","data","isModule","initAction","Init","dispatch","BaseModelHandlers","getRootState","getCurrentState","currentState","getCurrentRootState","getBeforeState","beforeState","getBeforeRootState","action","handler","actionCreatorMap","rest","__actionName__","payload","callThisAction","Update","loadModel","preRouteParams","routeParams","state","loading","isPromiseModule","module","isPromiseView","moduleView","exportActions","moduleGetter","Object","keys","reduce","maps","Proxy","get","target","key","type","NSP","set","result","then","default","getView","viewName","view","isServer","initModel","clientStore","getModuleByName","getModuleListByNames","moduleNames","preModules","map","Promise","resolve","all","renderApp","render","appModuleName","history","storeOptions","ssrInitStoreKey","initData","reducers","middlewares","enhancers","reduxStore","preModuleNames","push","filter","appModule","undefined","renderSSR","storeState","paths","length","inited","i","k","split","VSP"],"mappings":"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","sourcesContent":["import {Action, ActionCreatorList, ActionHandler, BaseModelState, MetaData, ModelStore, RouteState, StoreState, client, config, injectActions, isPromise, reducer} from './basic';\nimport {HistoryProxy, buildStore} from './store';\nimport {Middleware, ReducersMapObject, Store, StoreEnhancer} from 'redux';\n\nexport interface Model {\n  moduleName: string;\n  (store: ModelStore, options: any): void | Promise<void>;\n}\n\nexport interface Module<M extends Model = Model, VS extends {[key: string]: any} = {[key: string]: any}, AS extends ActionCreatorList = {}, N extends string = string> {\n  default: {\n    moduleName: N;\n    model: M;\n    views: VS;\n    actions: AS;\n  };\n}\n\nexport interface ModuleGetter {\n  [moduleName: string]: () => Module | Promise<Module>;\n}\n\ntype ReturnModule<T> = T extends () => Promise<infer R> ? R : T extends () => infer R ? R : never;\n// export type ReturnViews<T extends () => any> = T extends () => Promise<Module<Model, infer R>> ? R : T extends () => Module<Model, infer R> ? R : never;\ntype ModuleName<M extends any> = M['default']['moduleName'];\ntype ModuleStates<M extends any> = M['default']['model']['initState'];\ntype ModuleParams<M extends any> = M['default']['model']['initState']['routeParams'];\ntype ModuleViews<M extends any> = M['default']['views'];\ntype ModuleActions<M extends any> = M['default']['actions'];\ntype MountViews<M extends any> = {[key in keyof M['default']['views']]?: boolean};\n\nexport type RootState<G extends ModuleGetter, L> = {\n  route: {\n    location: L;\n    data: {\n      views: {[key in keyof G]?: MountViews<ReturnModule<G[key]>>};\n      params: {[key in keyof G]?: ModuleParams<ReturnModule<G[key]>>};\n      stackParams: {[moduleName: string]: {[key: string]: any} | undefined}[];\n      paths: any;\n    };\n  };\n} & {[key in keyof G]?: ModuleStates<ReturnModule<G[key]>>};\n\nexport type ExportModule<Component> = <S extends BaseModelState, V extends {[key: string]: Component}, T extends BaseModelHandlers<S, any>, N extends string>(\n  moduleName: N,\n  initState: S,\n  ActionHandles: {new (moduleName: string, store: any): T},\n  views: V\n) => Module<Model, V, Actions<T>, N>['default'];\n\nexport const exportModule: ExportModule<any> = (moduleName, initState, ActionHandles, views) => {\n  const model = (store: ModelStore, options: any) => {\n    const hasInjected = store._medux_.injectedModules[moduleName];\n    if (!hasInjected) {\n      store._medux_.injectedModules[moduleName] = true;\n      const moduleState: BaseModelState = store.getState()[moduleName];\n      const handlers = new ActionHandles(moduleName, store);\n      const actions = injectActions(store, moduleName, handlers as any);\n      (handlers as any).actions = actions;\n      if (!moduleState) {\n        const params = store._medux_.prevState.route.data.params;\n        initState.isModule = true;\n        const initAction = actions.Init(initState, params[moduleName], options);\n        return store.dispatch(initAction) as any;\n      }\n    }\n    return void 0;\n  };\n  model.moduleName = moduleName;\n  const actions = {} as any;\n  return {\n    moduleName,\n    model,\n    views,\n    actions,\n  };\n};\n\nexport abstract class BaseModelHandlers<S extends BaseModelState, R extends {route: RouteState}> {\n  protected readonly actions: Actions<this> = null as any;\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public constructor(protected readonly moduleName: string, protected readonly store: ModelStore) {}\n\n  protected get state(): S {\n    return this.getState();\n  }\n  //ie8不支持getter\n  protected getState(): S {\n    return this.store._medux_.prevState[this.moduleName] as S;\n  }\n  protected get rootState(): R {\n    return this.getRootState();\n  }\n  //ie8不支持getter\n  protected getRootState(): R {\n    return this.store._medux_.prevState as any;\n  }\n  protected get currentState(): S {\n    return this.getCurrentState();\n  }\n  //ie8不支持getter\n  protected getCurrentState(): S {\n    return this.store._medux_.currentState[this.moduleName] as S;\n  }\n  protected get currentRootState(): R {\n    return this.getCurrentRootState();\n  }\n  //ie8不支持getter\n  protected getCurrentRootState(): R {\n    return this.store._medux_.currentState as any;\n  }\n  protected get beforeState(): S {\n    return this.getBeforeState();\n  }\n  //ie8不支持getter\n  protected getBeforeState(): S {\n    return this.store._medux_.beforeState[this.moduleName] as S;\n  }\n  protected get beforeRootState(): R {\n    return this.getBeforeRootState();\n  }\n  //ie8不支持getter\n  protected getBeforeRootState(): R {\n    return this.store._medux_.beforeState as any;\n  }\n  protected dispatch(action: Action): Action | Promise<void> {\n    return this.store.dispatch(action) as any;\n  }\n\n  protected callThisAction<T extends any[]>(handler: (...args: T) => any, ...rest: T): {type: string; payload?: any[]} {\n    const actions = MetaData.actionCreatorMap[this.moduleName];\n    return actions[(handler as ActionHandler).__actionName__](...rest);\n  }\n  protected updateState(payload: Partial<S>) {\n    this.dispatch(this.callThisAction(this.Update, {...this.getState(), ...payload}));\n  }\n  protected loadModel(moduleName: Extract<keyof R, string>, options?: any) {\n    return loadModel(moduleName, this.store, options);\n  }\n  @reducer\n  protected Init(initState: S, preRouteParams?: any, options?: any): S {\n    return {...initState, preRouteParams: preRouteParams || initState.preRouteParams, routeParams: initState.routeParams || {}, ...options};\n  }\n\n  @reducer\n  protected Update(payload: S): S {\n    return payload;\n  }\n\n  @reducer\n  public PreRouteParams(payload: {[key: string]: any}): S {\n    const state = this.getState();\n    return {\n      ...state,\n      preRouteParams: payload,\n    };\n  }\n\n  @reducer\n  protected Loading(payload: {[group: string]: string}): S {\n    const state = this.getState();\n    return {\n      ...state,\n      loading: {...state.loading, ...payload},\n    };\n  }\n}\n\ntype Handler<F> = F extends (...args: infer P) => any\n  ? (\n      ...args: P\n    ) => {\n      type: string;\n    }\n  : never;\n\nexport type Actions<Ins> = {[K in keyof Ins]: Ins[K] extends (...args: any[]) => any ? Handler<Ins[K]> : never};\n\nexport function isPromiseModule(module: Module | Promise<Module>): module is Promise<Module> {\n  return typeof module['then'] === 'function';\n}\nexport function isPromiseView<T>(moduleView: T | Promise<T>): moduleView is Promise<T> {\n  return typeof moduleView['then'] === 'function';\n}\n\nexport function exportActions<G extends {[N in keyof G]: N extends ModuleName<ReturnModule<G[N]>> ? G[N] : never}>(moduleGetter: G): {[key in keyof G]: ModuleActions<ReturnModule<G[key]>>} {\n  MetaData.moduleGetter = moduleGetter as any;\n  MetaData.actionCreatorMap = Object.keys(moduleGetter).reduce((maps, moduleName) => {\n    maps[moduleName] =\n      typeof Proxy === 'undefined'\n        ? {}\n        : new Proxy(\n            {},\n            {\n              get: (target: {}, key: string) => {\n                return (...payload: any[]) => ({type: moduleName + config.NSP + key, payload});\n              },\n              set: () => {\n                return true;\n              },\n            }\n          );\n    return maps;\n  }, {});\n  return MetaData.actionCreatorMap as any;\n}\n\nexport function loadModel<MG extends ModuleGetter>(moduleName: Extract<keyof MG, string>, store: ModelStore, options?: any): void | Promise<void> {\n  const hasInjected = store._medux_.injectedModules[moduleName];\n  if (!hasInjected) {\n    const moduleGetter = MetaData.moduleGetter;\n    const result = moduleGetter[moduleName]();\n    if (isPromiseModule(result)) {\n      return result.then(module => {\n        moduleGetter[moduleName] = (() => module) as any;\n        return module.default.model(store, options);\n      });\n    } else {\n      return result.default.model(store, options);\n    }\n  }\n}\n\nexport function getView<T>(moduleName: string, viewName: string, options?: any): T | Promise<T> {\n  const moduleGetter: ModuleGetter = MetaData.moduleGetter;\n  const result = moduleGetter[moduleName]();\n  if (isPromiseModule(result)) {\n    return result.then(module => {\n      moduleGetter[moduleName] = () => module;\n      const view: T = module.default.views[viewName];\n      if (MetaData.isServer) {\n        return view;\n      }\n      const initModel = module.default.model(MetaData.clientStore, options);\n      if (isPromise(initModel)) {\n        return initModel.then(() => view);\n      } else {\n        return view;\n      }\n    });\n  } else {\n    const view: T = result.default.views[viewName];\n    if (MetaData.isServer) {\n      return view;\n    }\n    const initModel = result.default.model(MetaData.clientStore, options);\n    if (isPromise(initModel)) {\n      return initModel.then(() => view);\n    } else {\n      return view;\n    }\n  }\n}\n\nexport type LoadView<MG extends ModuleGetter, OPTS = any> = <M extends Extract<keyof MG, string>, V extends ModuleViews<ReturnModule<MG[M]>>, N extends Extract<keyof V, string>>(\n  moduleName: M,\n  viewName: N,\n  options?: OPTS\n) => V[N];\n\nfunction getModuleByName(moduleName: string, moduleGetter: ModuleGetter): Promise<Module> | Module {\n  const result = moduleGetter[moduleName]();\n  if (isPromiseModule(result)) {\n    return result.then(module => {\n      //在SSR时loadView不能出现异步，否则浏览器初轮渲染不会包括异步组件，从而导致和服务器返回不一致\n      moduleGetter[moduleName] = () => module;\n      return module;\n    });\n  } else {\n    return result;\n  }\n}\nfunction getModuleListByNames(moduleNames: string[], moduleGetter: ModuleGetter): Promise<Module[]> {\n  const preModules = moduleNames.map(moduleName => {\n    const module = getModuleByName(moduleName, moduleGetter);\n    if (isPromiseModule(module)) {\n      return module;\n    } else {\n      return Promise.resolve(module);\n    }\n  });\n  return Promise.all(preModules);\n}\nexport interface StoreOptions {\n  ssrInitStoreKey?: string;\n  reducers?: ReducersMapObject;\n  middlewares?: Middleware[];\n  enhancers?: StoreEnhancer[];\n  initData?: {[key: string]: any};\n}\n\nexport function renderApp<M extends ModuleGetter, A extends Extract<keyof M, string>>(\n  render: (store: Store, appModel: Model, appViews: {[key: string]: any}, ssrInitStoreKey: string) => void,\n  moduleGetter: M,\n  appModuleName: A,\n  history: HistoryProxy,\n  storeOptions: StoreOptions = {}\n): Promise<Store> {\n  MetaData.appModuleName = appModuleName;\n  const ssrInitStoreKey = storeOptions.ssrInitStoreKey || 'meduxInitStore';\n  let initData = {};\n  if (storeOptions.initData || client![ssrInitStoreKey]) {\n    initData = {...client![ssrInitStoreKey], ...storeOptions.initData};\n  }\n  const store = buildStore(history, initData, storeOptions.reducers, storeOptions.middlewares, storeOptions.enhancers);\n  const reduxStore: Store = store as any;\n  const preModuleNames: string[] = [appModuleName];\n  if (initData) {\n    preModuleNames.push(...Object.keys(initData).filter(key => key !== appModuleName && initData[key].isModule));\n  }\n  // 在ssr时，client必须在第一次render周期中完成和ssr一至的输出结构，所以不能出现异步模块\n  return getModuleListByNames(preModuleNames, moduleGetter).then(([appModule]) => {\n    const initModel = appModule.default.model(store, undefined);\n    render(reduxStore, appModule.default.model, appModule.default.views, ssrInitStoreKey);\n    if (isPromise(initModel)) {\n      return initModel.then(() => reduxStore);\n    } else {\n      return reduxStore;\n    }\n  });\n}\n\nexport async function renderSSR<M extends ModuleGetter, A extends Extract<keyof M, string>>(\n  render: (store: Store, appModel: Model, appViews: {[key: string]: any}, ssrInitStoreKey: string) => {html: any; data: any; ssrInitStoreKey: string; store: Store},\n  moduleGetter: M,\n  appModuleName: A,\n  history: HistoryProxy,\n  storeOptions: StoreOptions = {}\n) {\n  MetaData.appModuleName = appModuleName;\n  const ssrInitStoreKey = storeOptions.ssrInitStoreKey || 'meduxInitStore';\n  const store = buildStore(history, storeOptions.initData, storeOptions.reducers, storeOptions.middlewares, storeOptions.enhancers);\n  const storeState = store.getState() as StoreState;\n  const {paths} = storeState.route.data;\n  paths.length === 0 && paths.push(appModuleName);\n  let appModule: Module | undefined = undefined;\n  const inited: {[moduleName: string]: boolean} = {};\n  for (let i = 0, k = paths.length; i < k; i++) {\n    const [moduleName] = paths[i].split(config.VSP);\n    if (!inited[moduleName]) {\n      inited[moduleName] = true;\n      const module = moduleGetter[moduleName]() as Module;\n      await module.default.model(store, undefined);\n      if (i === 0) {\n        appModule = module;\n      }\n    }\n  }\n  return render(store as any, appModule!.default.model, appModule!.default.views, ssrInitStoreKey);\n}\n"],"file":"module.js"}